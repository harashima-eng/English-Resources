<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#007aff">
  <link rel="manifest" href="../../../manifest.json">
  <title>16 名詞・冠詞・代名詞 | Nouns, Articles & Pronouns</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600&family=Noto+Serif+JP:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="dualscope-lesson.css">
  <style>
    :root {
      --bg: #F5F0E6;
      --bg-warm: #EDE8DE;
      --card: #FFFFFF;
      --text: #1C1917;
      --text-secondary: #57534E;
      --text-muted: #7A7672;
      --accent: #3D8BCA;
      --border: rgba(28, 25, 23, 0.08);
      --border-visible: rgba(28, 25, 23, 0.12);
      --shadow-sm: 0 1px 2px rgba(61, 67, 64, 0.05),
                   0 4px 12px rgba(61, 67, 64, 0.08),
                   inset 0 1px 0 rgba(255, 255, 255, 0.5);
      --shadow: 0 2px 4px rgba(61, 67, 64, 0.06),
                0 8px 24px rgba(61, 67, 64, 0.12),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
      --shadow-lg: 0 4px 8px rgba(61, 67, 64, 0.06),
                   0 16px 48px rgba(61, 67, 64, 0.15),
                   inset 0 2px 0 rgba(255, 255, 255, 0.7);
      --radius: 20px;
      --radius-sm: 12px;
      --fs-qtext: clamp(17px, 1.3vw, 19px);
      --fs-base: clamp(15px, 1.1vw, 17px);
      --cat-basic: #5A8F65;
      --cat-basic-light: #EDF5EF;
      --cat-comm: #C28A2E;
      --cat-comm-light: #FBF6ED;
      --cat-advanced: #7E5A9E;
      --cat-advanced-light: #F5F0F8;
      /* Grammar type colors - BLUE/GREEN THEME for Lesson 16 */
      --prep: #3D8BCA;
      --prep-light: #f0f7fc;
      --noun: #5A9A6E;
      --noun-light: #f3f9f5;
      --article: #E8725C;
      --article-light: #fef4f2;
      --pronoun: #9B7FCF;
      --pronoun-light: #f8f5fc;
    }

    [data-theme="dark"] {
      --bg: #141312;
      --bg-warm: #1e1c1a;
      --card: rgba(36, 34, 32, 0.92);
      --card-solid: #242220;
      --text: #F5F3F0;
      --text-secondary: #A3A09C;
      --text-muted: #8A8A8A;
      --accent: #5BA3D9;
      --border: rgba(255, 255, 255, 0.06);
      --border-visible: rgba(255, 255, 255, 0.10);
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.35),
                   0 0 0 1px rgba(255, 255, 255, 0.03),
                   inset 0 1px 0 rgba(255, 255, 255, 0.05);
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(255, 255, 255, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 0.06);
      --shadow-lg: 0 12px 40px rgba(0, 0, 0, 0.6),
                   0 0 0 1px rgba(255, 255, 255, 0.05),
                   inset 0 1px 0 rgba(255, 255, 255, 0.08);
      --cat-basic: #6BA876;
      --cat-basic-light: rgba(90, 143, 101, 0.15);
      --cat-comm: #D9A043;
      --cat-comm-light: rgba(194, 138, 46, 0.15);
      --cat-advanced: #9A72B8;
      --cat-advanced-light: rgba(126, 90, 158, 0.15);
      --prep: #5BA3D9;
      --prep-light: rgba(91, 163, 217, 0.12);
      --noun: #6BAA7E;
      --noun-light: rgba(107, 170, 126, 0.12);
      --article: #F08872;
      --article-light: rgba(240, 136, 114, 0.12);
      --pronoun: #B099DF;
      --pronoun-light: rgba(176, 153, 223, 0.12);
    }

    [data-theme="dark"] body {
      background: var(--bg);
      background-image:
        radial-gradient(ellipse 100% 80% at 50% 0%, rgba(91, 163, 217, 0.06) 0%, transparent 50%),
        radial-gradient(ellipse 80% 60% at 20% 100%, rgba(155, 127, 207, 0.05) 0%, transparent 40%),
        radial-gradient(ellipse 60% 50% at 80% 80%, rgba(107, 170, 126, 0.04) 0%, transparent 40%),
        linear-gradient(135deg, #141312 0%, #1a1816 50%, #121110 100%);
      background-attachment: fixed;
    }

    .home-title em {
      font-style: normal;
      background: linear-gradient(135deg, var(--prep) 0%, var(--noun) 50%, var(--pronoun) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .conj-section.prep .conj-section-icon { background: var(--prep-light); }
    .conj-section.noun .conj-section-icon { background: var(--noun-light); }
    .conj-section.article .conj-section-icon { background: var(--article-light); }
    .conj-section.pronoun .conj-section-icon { background: var(--pronoun-light); }

    .conj-section.prep .conj-card { --card-accent: var(--prep); }
    .conj-section.noun .conj-card { --card-accent: var(--noun); }
    .conj-section.article .conj-card { --card-accent: var(--article); }
    .conj-section.pronoun .conj-card { --card-accent: var(--pronoun); }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--prep), var(--pronoun));
      border-radius: 100px;
      width: 0%;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 4px var(--prep-light);
    }

    .toggle-btn.vocab { background: var(--pronoun); color: white; }
    .toggle-btn.hint { background: var(--prep); color: white; }
    .toggle-btn.answer { background: var(--noun); color: white; }

    .qnum {
      display: inline-block;
      font-weight: 700;
      font-size: 12px;
      color: var(--accent);
      background: var(--prep-light);
      padding: 4px 12px;
      border-radius: 100px;
      margin-bottom: 12px;
    }

    .choices {
      background: var(--pronoun-light);
      border-left: 3px solid var(--pronoun);
    }

    .scramble {
      background: var(--prep-light);
      border-left: 3px solid var(--prep);
      font-family: 'JetBrains Mono', 'SF Mono', Monaco, monospace;
    }

    .vocab-box { background: var(--card); border-left: 3px solid var(--pronoun); }
    .hint-box { background: var(--card); border-left: 3px solid var(--prep); }
    .hint-item { padding: 8px 0; border-bottom: 1px solid rgba(61, 139, 202, 0.15); }
    .ans-box { background: var(--card); border-left: 3px solid var(--noun); }
    .choice-exp { padding: 8px 0; font-size: 16px; line-height: 1.6; border-bottom: 1px solid rgba(90, 154, 110, 0.12); }
    .choice-exp.correct { color: var(--noun); font-weight: 600; }
    .vocab-word { font-weight: 700; color: var(--pronoun); margin-right: 8px; }
    .jp-text { color: var(--text-secondary); margin-top: 12px; padding-bottom: 12px; font-size: 16px; border-bottom: 1px solid rgba(90, 154, 110, 0.15); }
    .grammar-ref { background: var(--prep-light); border-left: 3px solid var(--prep); padding: 12px 14px; border-radius: var(--radius-sm); font-size: 15px; margin-top: 12px; }

    @media (max-width: 768px) {
      .mobile-nav-btn.active { color: var(--accent); background: var(--prep-light); }
    }
  </style>
</head>
<body data-exam-id="ds-lesson16-nouns-articles">

  <!-- ===== TOP NAVIGATION BAR ===== -->
  <nav class="top-nav" id="topNav">
    <div class="top-nav-logo">DUAL SCOPE</div>
    <div class="top-nav-center" role="tablist">
      <button class="top-nav-link active" data-nav="home" onclick="Router.navigate('home')" role="tab" aria-selected="true">Home</button>
      <button class="top-nav-link" data-nav="overview" onclick="Router.navigate('overview')" role="tab" aria-selected="false">Overview</button>
      <button class="top-nav-link" data-nav="question" onclick="Router.navigate('question')" role="tab" aria-selected="false">Question</button>
    </div>
    <div class="top-nav-right">

      <button class="top-nav-theme" onclick="toggleTheme()" title="Toggle theme">
        <span class="theme-icon">&#9728;&#65039;</span>
      </button>
    </div>
  </nav>

  <!-- ===== SUB NAVIGATION (Question view only) ===== -->
  <nav class="sub-nav" id="subNav">
    <div class="sub-nav-categories">
      <button class="sub-nav-cat active" data-cat="basic" onclick="Router.setCategory('basic')">基本問題</button>
      <button class="sub-nav-cat" data-cat="comm" onclick="Router.setCategory('comm')">For Communication</button>
      <button class="sub-nav-cat" data-cat="advanced" onclick="Router.setCategory('advanced')">発展問題</button>
    </div>
    <div class="sub-nav-sections" id="sectionToggles"></div>
  </nav>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="main-content" id="mainContent">

    <!-- HOME VIEW -->
    <section class="view-home active" id="viewHome">
      <div class="home-bg"></div>
      <div class="home-content">
        <p class="home-label">Lesson 16</p>
        <h1 class="home-title">名詞・冠詞・<em>代名詞</em></h1>
        <p class="home-subtitle">Master nouns, articles and pronouns in English grammar.</p>
        <div class="home-cta">
          <button class="btn-primary" onclick="Router.navigate('question')">Start Learning</button>
          <button class="btn-secondary" onclick="Router.navigate('overview')">Overview</button>
        </div>
      </div>
    </section>

    <!-- OVERVIEW VIEW -->
    <section class="view-overview" id="viewOverview">
      <div class="overview-header">
        <p class="overview-label">Reference Guide</p>
        <h2 class="overview-title">Grammar Types</h2>
      </div>

      <!-- Prepositions -->
      <section class="conj-section prep">
        <div class="conj-section-header">
          <div class="conj-section-icon">&#128205;</div>
          <div>
            <h2 class="conj-section-title">Prepositions</h2>
            <p class="conj-section-title-jp">前置詞</p>
          </div>
        </div>
        <div class="conj-grid">
          <div class="conj-card">
            <div class="conj-card-word">on</div>
            <div class="conj-card-meaning">〜の上に（接触）</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">Look at the picture <strong>on</strong> the wall.</p>
              <p class="conj-card-example-jp">壁の絵を見てごらん。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">表面に接触していることを表す。上面だけでなく、側面や下面でも使う</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">until / by</div>
            <div class="conj-card-meaning">〜まで / 〜までには</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">I must stay home <strong>until</strong> eleven.</p>
              <p class="conj-card-example-jp">私は11時まで家にいなければならない。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">until は継続の終点、by は完了の期限を表す</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">from / of</div>
            <div class="conj-card-meaning">〜から作られる</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">Wine is made <strong>from</strong> grapes.</p>
              <p class="conj-card-example-jp">ワインはぶどうから作られる。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">from は原料（質が変化）、of は材料（質が変化しない）</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">in + 時間</div>
            <div class="conj-card-meaning">（今から）〜後に</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">Your pizza will be delivered <strong>in</strong> 30 minutes.</p>
              <p class="conj-card-example-jp">お客様のピザは30分で配達されます。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">未来を表す文で使用。過去では after を使う</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Nouns -->
      <section class="conj-section noun">
        <div class="conj-section-header">
          <div class="conj-section-icon">&#128230;</div>
          <div>
            <h2 class="conj-section-title">Nouns</h2>
            <p class="conj-section-title-jp">名詞</p>
          </div>
        </div>
        <div class="conj-grid">
          <div class="conj-card">
            <div class="conj-card-word">物質名詞</div>
            <div class="conj-card-meaning">juice, bread, coffee など</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">There is some <strong>juice</strong> left.</p>
              <p class="conj-card-example-jp">オレンジジュースが残っている。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">数えられないので常に単数形。a cup of, a slice of などで数を表す</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">集合名詞</div>
            <div class="conj-card-meaning">police, staff, furniture など</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">The <strong>police</strong> are investigating.</p>
              <p class="conj-card-example-jp">警察はその事故を調査している。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">police は常に複数扱い、furniture は常に単数扱い</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">抽象名詞</div>
            <div class="conj-card-meaning">information, advice, news など</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">I gave them two <strong>pieces of advice</strong>.</p>
              <p class="conj-card-example-jp">私は彼らに2つ助言をした。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">a piece of で数を表す。news は形は複数でも単数扱い</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">固有名詞</div>
            <div class="conj-card-meaning">the United States など</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en"><strong>The United States</strong> is one of the largest countries.</p>
              <p class="conj-card-example-jp">アメリカ合衆国は世界で最も大きな国のひとつである。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">複数形の国名・山脈・群島には the をつける。国名は単数扱い</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Articles -->
      <section class="conj-section article">
        <div class="conj-section-header">
          <div class="conj-section-icon">&#128221;</div>
          <div>
            <h2 class="conj-section-title">Articles</h2>
            <p class="conj-section-title-jp">冠詞</p>
          </div>
        </div>
        <div class="conj-grid">
          <div class="conj-card">
            <div class="conj-card-word">a / an</div>
            <div class="conj-card-meaning">不定冠詞</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">There is <strong>an</strong> old church in front of the station.</p>
              <p class="conj-card-example-jp">駅の正面に古い教会がある。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">初めて話題に上る単数の数えられる名詞に使う。母音で始まる語の前は an</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">the</div>
            <div class="conj-card-meaning">定冠詞</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en"><strong>The</strong> moon goes around <strong>the</strong> earth.</p>
              <p class="conj-card-example-jp">ほぼ1か月で月は地球の周りを回っている。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">唯一のもの、特定できるものに使う。the + 形容詞 で「〜の人々」</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">無冠詞</div>
            <div class="conj-card-meaning">冠詞なし</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">Let's play <strong>baseball</strong> after <strong>lunch</strong>.</p>
              <p class="conj-card-example-jp">昼食後に野球をしようよ。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">食事・スポーツ・ゲームを表す名詞には冠詞をつけない</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">by the + 単位</div>
            <div class="conj-card-meaning">〜単位で</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">Pencils are usually sold <strong>by the</strong> dozen.</p>
              <p class="conj-card-example-jp">鉛筆は普通1ダース単位で売られている。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">by the + 単位名詞 で「〜単位で」を表す</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Pronouns -->
      <section class="conj-section pronoun">
        <div class="conj-section-header">
          <div class="conj-section-icon">&#128100;</div>
          <div>
            <h2 class="conj-section-title">Pronouns</h2>
            <p class="conj-section-title-jp">代名詞</p>
          </div>
        </div>
        <div class="conj-grid">
          <div class="conj-card">
            <div class="conj-card-word">所有代名詞</div>
            <div class="conj-card-meaning">mine, yours, hers など</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">An old friend of <strong>mine</strong> came to stay.</p>
              <p class="conj-card-example-jp">昔からの友人の1人が泊まりに来た。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">a/an, the, this, some などと所有格は並べて使えないので所有代名詞を使う</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">再帰代名詞</div>
            <div class="conj-card-meaning">myself, himself など</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">He is not used to traveling <strong>by himself</strong>.</p>
              <p class="conj-card-example-jp">彼は一人旅には慣れていない。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">by oneself = alone（ひとりで）、in itself = 本来、それ自体は</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">another / other</div>
            <div class="conj-card-meaning">別のもの</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">Please show me <strong>another</strong>.</p>
              <p class="conj-card-example-jp">別のを見せてください。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">another = 不特定の別の1つ、the other = 残りの1つ</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">each / both</div>
            <div class="conj-card-meaning">それぞれ / 両方</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en"><strong>Each</strong> of us was asked our name.</p>
              <p class="conj-card-example-jp">私たちは1人1人名前を尋ねられた。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">each は単数扱い、both は複数扱い（2人/2つについて使う）</span>
            </div>
          </div>
        </div>
      </section>
    </section>

    <!-- QUESTION VIEW -->
    <section class="view-question" id="viewQuestion">
      <div class="question-header">
        <div class="question-category-badge basic" id="categoryBadge">
          <span id="categoryIcon" role="img" aria-label="Basic problems">&#128218;</span>
          <span id="categoryName">基本問題</span>
        </div>
        <h2 class="question-title" id="sectionTitle">[1] 基本問題 1</h2>
        <p class="question-subtitle" id="sectionSubtitle">14 questions</p>
      </div>

      <div class="progress-wrap">
        <div class="progress-bar-bg">
          <div class="progress-bar-fill" id="progressBar"></div>
        </div>
        <p class="progress-label" id="progressText">0 / 0 answers revealed</p>
      </div>

      <div class="search-wrap">
        <span class="search-icon">&#128269;</span>
        <input type="text" class="search-input" id="searchInput" placeholder="Search questions, grammar, vocabulary..." oninput="debouncedSearch()">
      </div>

      <div class="questions-list" id="questionsList"></div>
    </section>
  </main>

  <!-- Mobile Navigation -->
  <nav class="mobile-nav">
    <button class="mobile-nav-btn active" data-nav="home" onclick="Router.navigate('home')">
      <span class="mobile-nav-btn-icon">&#127968;</span>
      Home
    </button>
    <button class="mobile-nav-btn" data-nav="overview" onclick="Router.navigate('overview')">
      <span class="mobile-nav-btn-icon">&#128218;</span>
      Overview
    </button>
    <button class="mobile-nav-btn" data-nav="question" onclick="Router.navigate('question')">
      <span class="mobile-nav-btn-icon">&#10067;</span>
      Question
    </button>
  </nav>

  <footer>DUAL SCOPE English Grammar — Lesson 16: 名詞・冠詞・代名詞</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
<script>
// ===== GSAP SETUP =====
if (typeof gsap !== 'undefined') {
  gsap.registerPlugin(ScrollTrigger);
}
let UV_REDUCED = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
window.matchMedia('(prefers-reduced-motion: reduce)').addEventListener('change', e => { UV_REDUCED = e.matches; });

const GSAP_CONFIG = {
  ease: {
    default: 'power3.out',
    smooth: 'power2.inOut',
    spring: 'back.out(1.7)',
    gentle: 'power1.out',
    nav: 'power2.out',
    elastic: 'elastic.out(1, 0.3)',
  },
  duration: {
    micro: 0.1,
    fast: 0.25,
    normal: 0.5,
    slow: 0.8,
    nav: 0.3,
    view: 0.4,
  },
  stagger: {
    tight: 0.03,
    normal: 0.08,
    relaxed: 0.15,
  },
  scroll: {
    start: 'top 85%',
    toggleActions: 'play none none none',
  },
  hover: {
    lift: -3,
    liftLarge: -4,
    scaleSmall: 1.05,
    scaleMedium: 1.08,
  },
};

// ===== GRAMMAR DATA =====
const grammarData = {
  sections: [
    {
      title: "[1] 基本問題 1｜語句選択 (1)～(14)",
      open: true,
      questions: [
        {
          num: "(1)", type: "choice", correctAnswer: "c",
          text: "Look at the picture ( at, in, on ) the wall.",
          choices: "a. at　b. in　c. on",
          vocab: [["picture", "絵、写真"], ["wall", "壁"]],
          hint: ["壁に絵が「くっついている」状態を表す前置詞は？", "表面との接触を表す前置詞を考えよう", "at は地点、in は内部、on は？"]},
        {
          num: "(2)", type: "choice", correctAnswer: "b",
          text: "I have to stay at home ( by, until, for ) eleven.",
          choices: "a. by　b. until　c. for",
          vocab: [["stay at home", "家にいる"], ["have to", "～しなければならない"]],
          hint: ["「11時まで家にいなければならない」— 継続？期限？", "「ずっと家にいる」という状態が続くなら…", "by は期限（その時までに完了）、until は継続の終点"]},
        {
          num: "(3)", type: "choice", correctAnswer: "a",
          text: "Wine is made ( from, into, of ) grapes.",
          choices: "a. from　b. into　c. of",
          vocab: [["wine", "ワイン"], ["grape", "ぶどう"]],
          hint: ["ワインを見て「これはぶどうだ」とわかる？", "原料が変化して元の姿がわからなくなる場合と、わかる場合で前置詞が違う", "be made ___：質が変化するか、しないかがポイント"]},
        {
          num: "(4)", type: "choice", correctAnswer: "b",
          text: "The train ( in, for, at ) Osaka will come soon.",
          choices: "a. in　b. for　c. at",
          vocab: [["train", "電車"], ["soon", "まもなく"]],
          hint: ["「大阪行きの電車」— 行き先を表す前置詞は？", "目的地や方向を表す前置詞を考えよう", "leave for, depart for のように「～行き」を表す前置詞は？"]},
        {
          num: "(5)", type: "choice", correctAnswer: "b",
          text: "I woke up several times ( for, during, while ) the night.",
          choices: "a. for　b. during　c. while",
          vocab: [["wake up", "目を覚ます"], ["several times", "数回"]],
          hint: ["the night は名詞。後ろに名詞が来るのは前置詞？接続詞？", "while は接続詞 — 後ろに主語+動詞が必要", "「その夜の間に」を表す前置詞は？"]},
        {
          num: "(6)", type: "choice", correctAnswer: "c",
          text: "Your pizza will be delivered ( after, by, in ) 30 minutes.",
          choices: "a. after　b. by　c. in",
          vocab: [["deliver", "配達する"], ["minute", "分"]],
          hint: ["「30分で届きます」— 未来の文で「～後に」を表す前置詞は？", "未来を表す文で「今から～後に」と言うときの前置詞", "after は過去の文で「～後に」を表す場合が多い"]},
        {
          num: "(7)", type: "pair", correctAnswer: "is",
          text: "There ( is, are ) some orange juice left in the refrigerator.",
          choices: "選択肢: is, are",
          vocab: [["orange juice", "オレンジジュース"], ["refrigerator", "冷蔵庫"], ["left", "残っている"]],
          hint: ["orange juice は数えられる名詞？数えられない名詞？", "液体は一般に不可算名詞", "不可算名詞の動詞は単数形？複数形？"]},
        {
          num: "(8)", type: "pair", correctAnswer: "is",
          text: "The United States ( is, are ) one of the largest countries in the world.",
          choices: "選択肢: is, are",
          vocab: [["the United States", "アメリカ合衆国"], ["one of the largest", "最も大きい～のひとつ"]],
          hint: ["States は複数形だけど、1つの国を指している", "国名は形が複数でも、1つの国なら…？", "The Philippines, The Netherlands なども同じルール"]},
        {
          num: "(9)", type: "pair", correctAnswer: "much",
          text: "There is too ( many, much ) furniture in her house.",
          choices: "選択肢: many, much",
          vocab: [["furniture", "家具"], ["too", "～すぎる"]],
          hint: ["furniture は数えられる名詞？数えられない名詞？", "不可算名詞の量を表すのは many？ much？", "many は可算名詞、much は不可算名詞に使う"]},
        {
          num: "(10)", type: "pair", correctAnswer: "are",
          text: "The police ( is, are ) investigating the traffic accident.",
          choices: "選択肢: is, are",
          vocab: [["investigate", "調査する"], ["traffic accident", "交通事故"]],
          hint: ["police は「警察官たち」を表す集合名詞", "常に複数扱いの名詞がある — people, police, cattle など", "動詞は単数形？複数形？"]},
        {
          num: "(11)", type: "pair", correctAnswer: "information",
          text: "Where can I get ( information, informations ) about the museum?",
          choices: "選択肢: information, informations",
          vocab: [["museum", "博物館、美術館"], ["get", "得る、手に入れる"]],
          hint: ["information は数えられる名詞？数えられない名詞？", "不可算名詞は複数形にできるかどうか考えよう", "数えたいときは a piece of information のように言う"]},
        {
          num: "(12)", type: "pair", correctAnswer: "two pieces of advice",
          text: "I gave ( two advices, two pieces of advice ) to them.",
          choices: "選択肢: two advices, two pieces of advice",
          vocab: [["gave", "give（与える）の過去形"]],
          hint: ["advice は数えられる名詞？数えられない名詞？", "不可算名詞を数えるときはどう表現する？", "a piece of ___：information, advice, news, furniture に使うパターン"]},
        {
          num: "(13)", type: "pair", correctAnswer: "are",
          text: "My staff ( is, are ) all very positive people.",
          choices: "選択肢: is, are",
          vocab: [["staff", "スタッフ、職員"], ["positive", "前向きな、積極的な"]],
          hint: ["staff は集合名詞 — 単数扱いにも複数扱いにもなる", "all very positive people と言っている — 個々の人々を意識している？", "集合名詞 + all → メンバー1人1人を意識するなら…"]},
        {
          num: "(14)", type: "pair", correctAnswer: "travels",
          text: "Bad news ( travel, travels ) quickly.",
          choices: "選択肢: travel, travels",
          vocab: [["bad", "悪い"], ["quickly", "素早く"]],
          hint: ["news は -s で終わるけど、数えられる名詞？数えられない名詞？", "news は形は複数でも常に単数扱い", "単数扱いなら動詞は三人称単数形の…？"]}
      ]
    },
    {
      title: "[2] 基本問題 2｜冠詞 (1)～(6)",
      open: false,
      questions: [
        {
          num: "(1)", type: "fillin", correctAnswer: ["an"],
          text: "There is (   ) old church in front of the station.",
          choices: "空欄に冠詞を入れなさい",
          vocab: [["church", "教会"], ["in front of", "～の前に"], ["station", "駅"]],
          hint: ["初めて話題に出る名詞には不定冠詞を使う", "old の最初の音は母音？子音？", "母音で始まる語の前の不定冠詞の形は？"]},
        {
          num: "(2)", type: "fillin", correctAnswer: ["×", "×"],
          text: "Let's play (   ) baseball after (   ) lunch.",
          choices: "空欄に冠詞を入れなさい（不要なら×）",
          vocab: [["baseball", "野球"], ["after", "～の後に"]],
          hint: ["スポーツ名には冠詞をつける？つけない？", "食事名には冠詞をつける？つけない？", "play + スポーツ、have + 食事のパターンを思い出そう"]},
        {
          num: "(3)", type: "fillin", correctAnswer: ["The", "the", "a"],
          text: "(   ) moon goes around (   ) earth about once (   ) month.",
          choices: "空欄に冠詞を入れなさい",
          vocab: [["moon", "月"], ["earth", "地球"], ["go around", "周りを回る"], ["once", "1回"]],
          hint: ["月や地球は宇宙に1つしかない — 唯一のものには？", "「1ヶ月に1回」の「1ヶ月に」はどう表現する？", "once ___ month：「～につき」を表す冠詞は？"]},
        {
          num: "(4)", type: "fillin", correctAnswer: ["an"],
          text: "He will arrive here in about half (   ) hour.",
          choices: "空欄に冠詞を入れなさい",
          vocab: [["arrive", "到着する"], ["about", "約、およそ"], ["half", "半分の"]],
          hint: ["half an hour で「30分」— hour の最初の音は？", "hour の h は発音する？しない？", "発音されない h → 最初の音は母音"]},
        {
          num: "(5)", type: "fillin", correctAnswer: ["the"],
          text: "Pencils are usually sold by (   ) dozen.",
          choices: "空欄に冠詞を入れなさい",
          vocab: [["pencil", "鉛筆"], ["usually", "普通は"], ["sell", "売る"], ["dozen", "ダース（12個）"]],
          hint: ["「1ダース単位で売られる」— 単位を表す表現", "by ___ + 単位名詞：計量・単位の表現", "by the hour（1時間単位で）、by the pound（1ポンド単位で）と同じ形"]},
        {
          num: "(6)", type: "fillin", correctAnswer: ["the"],
          text: "Mother Teresa devoted her life to helping (   ) poor.",
          choices: "空欄に冠詞を入れなさい",
          vocab: [["devote", "捧げる"], ["Mother Teresa", "マザー・テレサ"]],
          hint: ["poor は形容詞 — でもここでは名詞的に使われている", "「the + 形容詞」で特定の人々を表す用法がある", "the young（若者たち）、the elderly（高齢者たち）と同じパターン"]}
      ]
    },
    {
      title: "[3] 基本問題 3｜代名詞 (1)～(7)",
      open: false,
      questions: [
        {
          num: "(1)", type: "choice", correctAnswer: "c",
          text: "An old friend of ( my, me, mine ) came to stay with us yesterday.",
          choices: "a. my　b. me　c. mine",
          vocab: [["an old friend of", "～の昔からの友人"], ["come to stay", "泊まりに来る"], ["yesterday", "昨日"]],
          hint: ["「a/an + 名詞 + of + ?」の形で所有を表したい", "a my friend とは言える？ a と所有格は一緒に使える？", "所有格の代わりに使える「所有代名詞」を考えよう"]},
        {
          num: "(2)", type: "choice", correctAnswer: "b",
          text: "( All, Both, Some ) my parents are working.",
          choices: "a. All　b. Both　c. Some",
          vocab: [["parents", "両親"], ["working", "働いている"]],
          hint: ["parents（両親）は何人？ → 2人", "2人を表すのに適切な語は？", "all は3つ以上、some は一部、both は…？"]},
        {
          num: "(3)", type: "choice", correctAnswer: "c",
          text: "He isn't used to traveling by ( him, his, himself ).",
          choices: "a. him　b. his　c. himself",
          vocab: [["be used to", "～に慣れている"], ["travel", "旅行する"]],
          hint: ["「ひとりで旅行する」— by ___ で「ひとりで」", "by oneself = alone（ひとりで）", "主語が he なら oneself の部分は？"]},
        {
          num: "(4)", type: "choice", correctAnswer: "b",
          text: "John gave me a nice cup, but I broke ( one, it, this ).",
          choices: "a. one　b. it　c. this",
          vocab: [["gave", "give（与える）の過去形"], ["nice", "すてきな"], ["cup", "カップ"], ["broke", "break（壊す）の過去形"]],
          hint: ["John がくれた「その」カップを壊した — 特定のもの？", "it は前に出た特定のものを指す", "one は同じ種類の不特定のものを指す"]},
        {
          num: "(5)", type: "choice", correctAnswer: "c",
          text: "This sweater is too big. Please show me ( one, other, another ).",
          choices: "a. one　b. other　c. another",
          vocab: [["sweater", "セーター"], ["too big", "大きすぎる"], ["show", "見せる"]],
          hint: ["「別のを見せてください」— 不特定の別の1つ", "another = an + other（もう1つの別の）", "other だけでは代名詞として使えるか？"]},
        {
          num: "(6)", type: "choice", correctAnswer: "a",
          text: "( Each, Every, Both ) of us was asked our name by the interviewer.",
          choices: "a. Each　b. Every　c. Both",
          vocab: [["interviewer", "面接官"], ["ask", "尋ねる"]],
          hint: ["動詞が was — 単数扱いの主語を選ぶ", "___ of us の形をとれるのは？", "every は of ～ の形では使えないことに注意"]},
        {
          num: "(7)", type: "choice", correctAnswer: "c",
          text: "I have two cats; one is white and ( another, other, the other ) is black.",
          choices: "a. another　b. other　c. the other",
          vocab: [["cat", "猫"], ["white", "白い"], ["black", "黒い"]],
          hint: ["猫は2匹 — 1匹は白、「もう1匹」は黒", "2つのうち「残りの1つ」を指す表現は？", "one ... the other のペアを思い出そう"]}
      ]
    },
    {
      title: "[4] 基本問題 4｜穴埋め (1)～(5)",
      open: false,
      questions: [
        {
          num: "(1)", type: "fillin", correctAnswer: ["slice", "of", "cups", "of"],
          text: "彼は朝食にパン1枚とコーヒー2杯をとった。<br>He had a (   ) (   ) bread and two (   ) (   ) coffee for breakfast.",
          vocab: [["had", "have（食べる・とる）の過去形"], ["bread", "パン（不可算名詞）"], ["coffee", "コーヒー（不可算名詞）"], ["breakfast", "朝食"]],
          hint: ["bread も coffee も不可算名詞 — 数えるには？", "パン「1枚」は a ___ of bread（薄く切った1切れ）", "コーヒー「2杯」は two ___ of coffee"]},
        {
          num: "(2)", type: "fillin", correctAnswer: ["in", "in"],
          text: "太陽は東から昇り西に沈む。<br>The sun rises (   ) the east and sets (   ) the west.",
          vocab: [["sun", "太陽"], ["rise", "昇る"], ["set", "沈む"], ["east", "東"], ["west", "西"]],
          hint: ["「東に」「西に」— 方角を表す前置詞は？", "in the east で「東に（東の方に）」", "方角には in を使う（at でも to でもなく）"]},
        {
          num: "(3)", type: "fillin", correctAnswer: ["church", "by", "bus"],
          text: "祖母はたいていバスで礼拝に行きます。<br>My grandmother usually goes to (   ) (   ) (   ).",
          vocab: [["grandmother", "祖母"], ["usually", "たいてい"]],
          hint: ["「礼拝に行く」= go to church — 冠詞はつける？", "go to school, go to bed のように「本来の目的」で行く場合は無冠詞", "「バスで」= by bus — 交通手段も無冠詞"]},
        {
          num: "(4)", type: "fillin", correctAnswer: ["in", "itself"],
          text: "あなたの理論自体は間違っていない。<br>Your theory is not wrong (   ) (   ).",
          vocab: [["theory", "理論"], ["wrong", "間違っている"]],
          hint: ["「～自体は」を英語でどう表現する？", "in itself で「それ自体は」という慣用表現", "再帰代名詞を使った慣用句"]},
        {
          num: "(5)", type: "fillin", correctAnswer: ["Some", "others"],
          text: "UFOの存在を信じる人もいれば、信じない人もいる。<br>(   ) people believe in UFOs, but (   ) don't.",
          vocab: [["believe in", "～の存在を信じる"], ["UFO", "未確認飛行物体"]],
          hint: ["「ある人々は...別の人々は」のパターン", "不特定の一部を表す語と、残りの一部を表す語", "some ... others のペアを思い出そう"]}
      ]
    },
    {
      title: "[5] 基本問題 5｜並べかえ (1)～(3)",
      open: false,
      questions: [
        {
          num: "(1)", type: "scramble", correctAnswer: "data was of no value to",
          text: "そのデータは私たちにとってはまったく価値のないものだった。",
          scramble: "The [ to, of, was, value, no, data ] us.",
          vocab: [["data", "データ"], ["value", "価値"], ["of no value", "価値がない"]],
          hint: ["「価値がない」= of no value という表現", "be of + 名詞 で性質・価値を表す（= be + 形容詞）", "to us は「私たちにとって」— 文末に置く"]},
        {
          num: "(2)", type: "scramble", correctAnswer: "have I seen so beautiful a sunset",
          text: "こんなに美しい日没は今までに見たことがなかった。",
          scramble: "Never [ a, beautiful, have, I, seen, so, sunset ].",
          vocab: [["never", "一度も～ない"], ["sunset", "日没、夕焼け"], ["seen", "see（見る）の過去分詞"]],
          hint: ["Never で文が始まる → 何が起きる？", "否定語が文頭に来ると倒置が起きる（疑問文の語順）", "「so + 形容詞 + a + 名詞」の語順にも注意"]},
        {
          num: "(3)", type: "scramble", correctAnswer: "take it for granted that you are",
          text: "あなたが戦争に反対するのは当然のことだと思う。",
          scramble: "I [ are, for, granted, it, take, that, you ] against war.",
          vocab: [["take ... for granted", "～を当然のことと思う"], ["against", "～に反対して"], ["war", "戦争"]],
          hint: ["take it for granted that ～ = ～を当然と思う", "it は仮目的語で、that 以下が真の目的語", "語順：take it for granted that you are"]}
      ]
    },
    {
      title: "[6] FOR COMMUNICATION (1)～(3)",
      open: false,
      questions: [
        {
          num: "(1)", type: "choice", correctAnswer: "c",
          text: "A: How often does Ann have lunch with her friend Susie?<br>B: (   ).",
          choices: "a. At twelve o'clock　b. She eats pasta　c. Twice a week　d. Yes, she does",
          vocab: [["how often", "どのくらいの頻度で"], ["have lunch", "昼食をとる"]],
          hint: ["How often は頻度を聞いている質問", "「何時に？」や「何を？」ではなく「どのくらいの頻度で？」", "頻度を表す答えはどれ？"]},
        {
          num: "(2)", type: "choice", correctAnswer: "c",
          text: "A: Do you remember that coffee shop?<br>B: Yes. We would often chat there (   ) a cup of coffee.",
          choices: "a. in　b. on　c. over　d. with",
          vocab: [["remember", "覚えている"], ["coffee shop", "喫茶店"], ["chat", "おしゃべりする"]],
          hint: ["「コーヒーを飲みながらおしゃべりした」— 飲食しながら何かする表現", "「～をしながら」「～を前にして」を表す前置詞", "over には「～をしながら（食事・飲み物）」の意味がある"]},
        {
          num: "(3)", type: "choice", correctAnswer: "c",
          text: "A: Would it be all right if I visit you on Saturday or on Sunday?<br>B: Sure. (   ) day is OK.",
          choices: "a. Both　b. Each　c. Either　d. All",
          vocab: [["Would it be all right if", "～してもいいですか"], ["visit", "訪ねる"]],
          hint: ["「土曜日か日曜日に」— 2つの選択肢のどちらか", "「どちらの日でもOK」— 2つのうちどちらでもいい場合", "either は「2つのうちどちらでも」"]}
      ]
    },
    {
      title: "[発展1] 語句選択 (1)～(5)",
      open: false,
      questions: [
        {
          num: "(1)", type: "choice", correctAnswer: "a",
          text: "She thinks that falling in love is one thing but getting married is quite (   ).【専修大】",
          choices: "a. another　b. other　c. others　d. the others",
          vocab: [["fall in love", "恋に落ちる"], ["get married", "結婚する"], ["quite", "まったく"]],
          hint: ["「恋愛と結婚はまったく別のことだ」— one thing ... another のペア", "one thing と対になる表現は？", "one ... another で「1つは...別のものは」"]},
        {
          num: "(2)", type: "choice", correctAnswer: "c",
          text: "(   ) my surprise, I had a lot in common with my new friend.【拓殖大】",
          choices: "a. For　b. In　c. To　d. With",
          vocab: [["surprise", "驚き"], ["have ... in common", "共通点がある"]],
          hint: ["「驚いたことに」を英語で言う慣用表現", "___ my surprise = 「驚いたことに」", "to one's surprise / to one's joy のパターン"]},
        {
          num: "(3)", type: "choice", correctAnswer: "d",
          text: "These mysterious incidents happened one after (   ).【東洋大】",
          choices: "a. one　b. none　c. other　d. another",
          vocab: [["mysterious", "不思議な"], ["incident", "出来事"], ["happen", "起こる"]],
          hint: ["one after ___ = 「次々と」「相次いで」", "「1つの後にまた1つ」を表す慣用表現", "one after another のイディオムを思い出そう"]},
        {
          num: "(4)", type: "choice", correctAnswer: "a",
          text: "Our point of view on this issue is quite different from (   ).【中央大】",
          choices: "a. theirs　b. their　c. them　d. they",
          vocab: [["point of view", "見方、視点"], ["issue", "問題、論点"], ["quite", "かなり"], ["different from", "～とは異なる"]],
          hint: ["「彼らの（見方）とは異なる」— 何を省略している？", "their point of view の代わりに使える1語は？", "所有代名詞（～のもの）を使って言い換えよう"]},
        {
          num: "(5)", type: "choice", correctAnswer: "c",
          text: "I usually eat two (   ) of bread and a salad for breakfast.【京都産業大】",
          choices: "a. cakes　b. leaves　c. slices　d. sheets",
          vocab: [["usually", "普通は"], ["salad", "サラダ"], ["breakfast", "朝食"]],
          hint: ["bread（パン）は不可算名詞 — 数えるには「容器・形状」を使う", "パンを「薄く切った1枚」は英語で何と言う？", "a ___ of bread：薄切りの1枚を表す単語"]}
      ]
    },
    {
      title: "[発展2] 並べかえ (1)～(3)",
      open: false,
      questions: [
        {
          num: "(1)", type: "scramble", correctAnswer: "caught her by the arm before",
          text: "彼女が倒れかけたとき、私は彼女の腕をつかんだ。【中央大】",
          scramble: "I [ arm, before, by, caught, the, her ] she fell down.",
          vocab: [["catch", "つかむ（caught は過去形）"], ["fell down", "倒れた"], ["arm", "腕"]],
          hint: ["「体の部分をつかむ」= catch + 人 + by the + 体の部分", "catch her by the arm = 彼女の腕をつかむ", "before she fell down = 彼女が倒れる前に"]},
        {
          num: "(2)", type: "scramble", correctAnswer: "Those present at the meeting",
          text: "そのミーティングに出席した人は、ほとんどが女性だった。【東洋大】",
          scramble: "[ the, at, meeting, present, those ] were almost all women.",
          vocab: [["present", "出席している"], ["almost all", "ほとんどすべて"], ["women", "woman（女性）の複数形"]],
          hint: ["those present = 出席した人々（分詞の後置修飾）", "those = 「人々」を表す代名詞", "present at the meeting = そのミーティングに出席した"]},
        {
          num: "(3)", type: "scramble", correctAnswer: "about half as large as that of",
          text: "韓国の人口は日本の人口の約半分だ。【愛知学院大】",
          scramble: "The population of South Korea is [ about half, Japan, as large, that, as, of ].",
          vocab: [["population", "人口"], ["South Korea", "韓国"], ["about half", "約半分"]],
          hint: ["「～の約半分の大きさ」= about half as large as ～", "倍数表現：half as ... as ～ = ～の半分", "that of Japan = Japan's population（繰り返しを避ける代名詞 that）"]}
      ]
    },
    {
      title: "[発展3] 誤り訂正 (1)～(2)",
      open: false,
      questions: [
        {
          num: "(1)", type: "error", correctAnswer: "b", correctText: "butcher's",
          text: "Kate stopped <u>a. by</u> at the <u>b. butcher</u> for some <u>c. steak</u> on the way <u>d. home</u>.",
          choices: "下線部 a～d の中から誤りを1つ選び、正しく直しなさい。",
          vocab: [["stop by", "立ち寄る"], ["steak", "ステーキ（肉）"], ["on the way home", "帰り道に"]],
          hint: ["「肉屋さんに立ち寄った」— butcher（肉屋）の表現は正しい？", "お店の名前は所有格で表すことがある — the baker's, the barber's", "「肉屋さん（の店）」= the butcher's（shop が省略されている）"]},
        {
          num: "(2)", type: "error", correctAnswer: "a", correctText: "None",
          text: "<u>a. No</u> of these <u>b. computers</u> <u>c. are</u> connected <u>d. to</u> the Internet.",
          choices: "下線部 a～d の中から誤りを1つ選び、正しく直しなさい。",
          vocab: [["connected to", "～に接続されている"], ["the Internet", "インターネット"]],
          hint: ["No of these ～ という形は正しい？", "「～のうちどれも～ない」= None of ～ / No + 名詞", "No は形容詞として名詞を直接修飾する（No computers）。of ～ の形では？"]}
      ]
    },
    {
      title: "[発展4] 英作文 (1)～(2)",
      open: false,
      questions: [
        {
          num: "(1)", type: "compose", correctAnswer: "It is difficult for me to understand his intention.",
          text: "私が彼の意図を理解するのは難しい。<br>It is ... .",
          vocab: [["意図", "intention"], ["理解する", "understand"], ["難しい", "difficult / hard"]],
          hint: ["It is + 形容詞 + for + 人 + to do の形式主語構文", "「私にとって」= for me", "「彼の意図を理解する」= to understand his intention"]},
        {
          num: "(2)", type: "compose", correctAnswer: "Please help yourself to the food and drinks.",
          text: "どうぞご自由に食べ物と飲み物を召し上がってください。",
          vocab: [["ご自由にどうぞ", "please help yourself"], ["食べ物", "food"], ["飲み物", "drinks / beverages"]],
          hint: ["「ご自由にどうぞ」= Help yourself to ～", "help oneself to ～ = ～を自由にとって食べる/飲む", "相手に言うので yourself を使う"]}
      ]
    }
  ]
};

// ===== NAVIGATION STATE =====
const NavState = {
  view: 'home',        // 'home' | 'overview' | 'question'
  category: 'basic',   // 'basic' | 'comm' | 'advanced'
  section: 0,          // 0-9 section index
  categoryMap: {
    basic: [0, 1, 2, 3, 4],    // 5 sections: 語句選択、冠詞、代名詞、穴埋め、並べかえ
    comm: [5],                  // 1 section: FOR COMMUNICATION
    advanced: [6, 7, 8, 9]      // 4 sections: 語句選択、並べかえ、誤り訂正、英作文
  }
};

// Category display info
const categoryInfo = {
  basic: { name: '基本問題', iconText: '\u{1F4DA}', iconLabel: 'Basic problems', class: 'basic' },
  comm: { name: 'For Communication', iconText: '\u{1F4AC}', iconLabel: 'Communication', class: 'comm' },
  advanced: { name: '発展問題', iconText: '\u{1F680}', iconLabel: 'Advanced problems', class: 'advanced' }
};

// ===== ROUTER =====
const Router = {
  navigate(view, category = null, section = null) {
    NavState.view = view;

    if (view === 'question') {
      if (category) NavState.category = category;
      if (section !== null) {
        NavState.section = section;
      } else {
        NavState.section = NavState.categoryMap[NavState.category][0];
      }
    }

    this.updateHash();
    this.render();
  },

  setCategory(category) {
    NavState.category = category;
    NavState.section = NavState.categoryMap[category][0];
    this.updateHash();
    this.render();
  },

  setSection(section) {
    NavState.section = section;
    this.updateHash();
    this.render();
  },

  updateHash() {
    let hash = '#' + NavState.view;
    if (NavState.view === 'question') {
      const localIndex = NavState.categoryMap[NavState.category].indexOf(NavState.section);
      hash += '/' + NavState.category + '/' + (localIndex + 1);
    }
    history.pushState(null, '', hash);
  },

  parseHash() {
    const hash = window.location.hash.slice(1) || 'home';
    const parts = hash.split('/');

    NavState.view = parts[0] || 'home';
    if (!['home', 'overview', 'question'].includes(NavState.view)) NavState.view = 'home';

    if (NavState.view === 'question' && parts.length >= 3) {
      NavState.category = parts[1] || 'basic';
      if (!NavState.categoryMap[NavState.category]) NavState.category = 'basic';
      const localIndex = parseInt(parts[2], 10) - 1 || 0;
      const sections = NavState.categoryMap[NavState.category] || [0];
      NavState.section = sections[Math.min(localIndex, sections.length - 1)] || 0;
    }
  },

  render() {
    const prevView = this._currentView || null;
    this._currentView = NavState.view;
    if (prevView === 'home' && NavState.view !== 'home') {
      document._homeEntrancePlayed = false;
    }

    // -- Animation: Update nav active states --
    document.querySelectorAll('.top-nav-link').forEach(link => {
      const isActive = link.dataset.nav === NavState.view;
      link.classList.toggle('active', isActive);
      link.setAttribute('aria-selected', isActive ? 'true' : 'false');
    });
    document.querySelectorAll('.mobile-nav-btn').forEach(btn => {
      const isActive = btn.dataset.nav === NavState.view;
      btn.classList.toggle('active', isActive);
      // -- Animation: C11 Mobile nav bounce --
      if (isActive && prevView && prevView !== NavState.view && typeof gsap !== 'undefined' && !UV_REDUCED) {
        gsap.fromTo(btn, { scale: 0.9 }, { scale: 1, duration: 0.3, ease: GSAP_CONFIG.ease.elastic });
      }
    });

    const viewMap = { home: 'viewHome', overview: 'viewOverview', question: 'viewQuestion' };
    const mainContent = document.getElementById('mainContent');
    const subNav = document.getElementById('subNav');

    // -- Animation: C1 View transition --
    const oldViewEl = prevView ? document.getElementById(viewMap[prevView]) : null;
    const newViewEl = document.getElementById(viewMap[NavState.view]);

    if (typeof gsap !== 'undefined' && prevView && prevView !== NavState.view && !UV_REDUCED) {
      // Animate old view out
      if (oldViewEl) {
        gsap.to(oldViewEl, {
          opacity: 0, y: -20,
          duration: GSAP_CONFIG.duration.fast,
          ease: GSAP_CONFIG.ease.default,
          onComplete: () => { oldViewEl.classList.remove('active'); gsap.set(oldViewEl, { clearProps: 'all' }); }
        });
      }
      // Show new view with entrance
      setTimeout(() => {
        document.querySelectorAll('.view-home, .view-overview, .view-question').forEach(v => {
          if (v !== oldViewEl) v.classList.remove('active');
        });
        // Pre-hide entrance elements to prevent flash
        if (NavState.view === 'home') {
          gsap.set('.home-label, .home-title, .home-subtitle, .home-cta', { opacity: 0, y: 24 });
        } else if (NavState.view === 'overview') {
          gsap.set('.conj-section-header, .conj-card', { opacity: 0 });
        }
        newViewEl.classList.add('active');
        gsap.fromTo(newViewEl, { opacity: 0, y: 20 }, {
          opacity: 1, y: 0,
          duration: GSAP_CONFIG.duration.view,
          ease: GSAP_CONFIG.ease.default,
          onComplete: () => this._postRender(NavState.view, mainContent, subNav)
        });
      }, UV_REDUCED ? 0 : 200);
    } else {
      // First render or reduced motion: instant
      document.querySelectorAll('.view-home, .view-overview, .view-question').forEach(v => v.classList.remove('active'));
      newViewEl.classList.add('active');
      this._postRender(NavState.view, mainContent, subNav);
    }

    invalidateCaches();
  },

  _postRender(view, mainContent, subNav) {
    window.scrollTo(0, 0);
    if (view === 'home') {
      mainContent.classList.remove('has-subnav');
      initHomeEntrance();
    } else if (view === 'overview') {
      mainContent.classList.remove('has-subnav');
      setTimeout(() => { initTypeCardTilt(); initOverviewScrollReveals(); }, 50);
    } else if (view === 'question') {
      if (navVisible) {
        gsap.to('#subNav', { y: 0, opacity: 1, pointerEvents: 'auto', visibility: 'visible', duration: GSAP_CONFIG.duration.nav, ease: GSAP_CONFIG.ease.nav });
      }
      mainContent.classList.add('has-subnav');
      this.renderQuestionView();
    }
    // Re-init hover after view change
    setTimeout(initHoverAnimations, 100);
  },

  renderQuestionView() {
    // Update sub-nav categories
    document.querySelectorAll('.sub-nav-cat').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.cat === NavState.category);
    });

    // Render section toggles
    const sections = NavState.categoryMap[NavState.category];
    const togglesContainer = document.getElementById('sectionToggles');
    togglesContainer.textContent = '';
    sections.forEach((sectionIndex, i) => {
      const isActive = NavState.section === sectionIndex;
      const btn = document.createElement('button');
      btn.className = 'sub-nav-section' + (isActive ? ' active' : '');
      btn.onclick = () => Router.setSection(sectionIndex);
      btn.textContent = i + 1;
      togglesContainer.appendChild(btn);
    });

    // -- Animation: C10 Section number stagger --
    if (typeof gsap !== 'undefined' && !UV_REDUCED) {
      gsap.from('.sub-nav-section', { scale: 0, opacity: 0, stagger: 0.04, duration: 0.3, ease: GSAP_CONFIG.ease.spring });
    }

    // Update header
    const info = categoryInfo[NavState.category];
    const badge = document.getElementById('categoryBadge');
    badge.className = 'question-category-badge ' + info.class;
    const iconEl = document.getElementById('categoryIcon');
    iconEl.textContent = info.iconText || '';
    iconEl.setAttribute('aria-label', info.iconLabel || '');
    document.getElementById('categoryName').textContent = info.name;

    const sectionData = grammarData.sections[NavState.section];
    document.getElementById('sectionTitle').textContent = sectionData.title;
    document.getElementById('sectionSubtitle').textContent =
      sectionData.questions.length + ' questions';

    // -- Animation: C9 Badge entrance --
    if (typeof gsap !== 'undefined' && !UV_REDUCED) {
      gsap.from('#categoryBadge', { scale: 0.8, opacity: 0, duration: 0.4, ease: GSAP_CONFIG.ease.spring });
      gsap.from('#sectionTitle', { opacity: 0, y: 10, duration: 0.4, delay: 0.1, ease: GSAP_CONFIG.ease.default });
    }

    // Render questions
    renderQuestions(NavState.section);
    if (window.prefetchAnswers) window.prefetchAnswers(NavState.section);

    // Initialize card reveal
    initCardReveal();

    // Reset search
    const searchInput = document.getElementById('searchInput');
    if (searchInput) searchInput.value = '';

    // Update progress
    updateProgress();
  }
};

// ===== B6: COLLAPSIBLE TOGGLE (GSAP) + C4: CHILD STAGGER + C5: ANSWER CELEBRATION =====
function toggle(btn, type) {
  const card = btn.closest('.qcard');
  if (!card) return;
  const block = card.querySelector(`.collapsible[data-type="${type}"]`);
  if (!block) return;
  if (typeof gsap !== 'undefined') gsap.killTweensOf(block);
  btn.setAttribute('aria-expanded', block.classList.contains('open') ? 'false' : 'true');

  const isOpen = block.classList.contains('open');

  if (typeof gsap !== 'undefined' && !UV_REDUCED) {
    if (isOpen) {
      gsap.to(block, {
        opacity: 0, y: -10,
        duration: GSAP_CONFIG.duration.fast,
        ease: GSAP_CONFIG.ease.default,
        onComplete: () => { block.classList.remove('open'); gsap.set(block, { clearProps: 'all' }); }
      });
    } else {
      block.classList.add('open');
      gsap.fromTo(block, { opacity: 0, y: -10 }, {
        opacity: 1, y: 0,
        duration: 0.35,
        ease: 'power2.out'
      });

      // -- C4: Stagger child elements --
      const items = block.querySelectorAll('.vocab-item, .hint-item, .ans-box > *');
      if (items.length > 1) {
        gsap.from(items, { opacity: 0, x: -10, stagger: 0.05, duration: 0.3, ease: 'power2.out', delay: 0.1 });
      }

      // -- C5: Answer celebration --
      if (type === 'answer') {
        const ansBox = block.querySelector('.ans-box');
        if (ansBox) {
          gsap.fromTo(ansBox, { scale: 0.97 }, { scale: 1, duration: 0.4, ease: 'elastic.out(1, 0.5)' });
        }
      }
    }
  } else {
    block.classList.toggle('open');
  }

  updateProgress();
}

// ===== RENDER FUNCTIONS =====
function renderQuestion(q, si, qi) {
  let questionHtml = `<div class="qcard-question">
    <span class="qnum">${q.num}</span>
    <div class="qtext">${q.text}</div>`;
  if (q.choices) questionHtml += `<div class="choices">${q.choices}</div>`;
  if (q.scramble) questionHtml += `<div class="scramble">${q.scramble}</div>`;
  questionHtml += `</div>`;

  let leftHtml = `<div class="qcard-left">
    <div class="toggle-btn-row">
      <button class="toggle-btn vocab" onclick="toggle(this,'vocab')" aria-expanded="false">Words</button>`;
  if (q.hint) leftHtml += `<button class="toggle-btn hint" onclick="toggle(this,'hint')" aria-expanded="false">Hint</button>`;
  leftHtml += `</div>`;
  if (q.vocab) {
    leftHtml += `<div class="collapsible" data-type="vocab"><div class="box vocab-box">`;
    q.vocab.forEach(v => leftHtml += `<div class="vocab-item"><span class="vocab-word">${v[0]}</span>${v[1]}</div>`);
    leftHtml += `</div></div>`;
  }
  if (q.hint) {
    leftHtml += `<div class="collapsible" data-type="hint"><div class="box hint-box"><span class="box-label">Solution</span>`;
    q.hint.forEach(h => leftHtml += `<div class="hint-item">&#8594; ${h}</div>`);
    leftHtml += `</div></div>`;
  }
  leftHtml += `</div>`;

  let rightHtml = `<div class="qcard-right">
    <div class="toggle-btn-row">
      <button class="toggle-btn answer" onclick="toggle(this,'answer')" aria-expanded="false">Answer</button>
    </div>
    <div class="collapsible" data-type="answer"><div class="box ans-box">
    </div></div></div>`;

  return `<div class="qcard" data-si="${si}" data-qi="${qi}">${questionHtml}${leftHtml}${rightHtml}</div>`;
}

function renderQuestions(sectionIndex) {
  const section = grammarData.sections[sectionIndex];
  const container = document.getElementById('questionsList');
  container.innerHTML = section.questions.map((q, qi) => renderQuestion(q, sectionIndex, qi)).join('');
}

// ===== B4: CARD REVEAL (GSAP + IntersectionObserver) =====
let revealObserver = null;

function initCardReveal() {
  if (revealObserver) revealObserver.disconnect();
  if (typeof gsap === 'undefined') return;

  const cards = document.querySelectorAll('.qcard');
  if (!cards.length) return;

  if (UV_REDUCED) {
    gsap.set(cards, { opacity: 1, y: 0 });
    return;
  }

  gsap.set(cards, { opacity: 0, y: 20 });

  revealObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        gsap.to(entry.target, {
          opacity: 1, y: 0,
          duration: GSAP_CONFIG.duration.normal,
          ease: GSAP_CONFIG.ease.default
        });
        revealObserver.unobserve(entry.target);
      }
    });
  }, { root: null, rootMargin: '50px', threshold: 0.1 });

  cards.forEach(card => revealObserver.observe(card));
}

// ===== B7: PROGRESS BAR (GSAP) + C6: GLOW ON 100% =====
let progressBarEl = null;
let progressTextEl = null;

function updateProgress() {
  if (!progressBarEl) progressBarEl = document.getElementById('progressBar');
  if (!progressTextEl) progressTextEl = document.getElementById('progressText');

  const total = document.querySelectorAll('.collapsible[data-type="answer"]').length;
  const revealed = document.querySelectorAll('.collapsible[data-type="answer"].open').length;
  const pct = total > 0 ? Math.round((revealed / total) * 100) : 0;

  if (progressBarEl) {
    if (typeof gsap !== 'undefined') {
      gsap.to(progressBarEl, { width: pct + '%', duration: GSAP_CONFIG.duration.nav, ease: GSAP_CONFIG.ease.default });
      // -- C6: Glow on 100% --
      if (pct === 100 && !UV_REDUCED) {
        gsap.fromTo(progressBarEl,
          { boxShadow: '0 0 0px var(--accent)' },
          { boxShadow: '0 0 20px var(--accent)', duration: 0.6, yoyo: true, repeat: 1, ease: 'power2.inOut' }
        );
      }
    } else {
      progressBarEl.style.width = pct + '%';
    }
  }
  if (progressTextEl) progressTextEl.textContent = `${revealed} / ${total} answers revealed`;
}

// ===== SEARCH =====
let searchTimeout = null;
let searchIndex = null;

function invalidateCaches() {
  searchIndex = null;
  progressBarEl = null;
  progressTextEl = null;
}

function buildSearchIndex() {
  const section = grammarData.sections[NavState.section];
  searchIndex = section.questions.map((q, qi) => ({
    questionIndex: qi,
    searchText: [
      q.text || '',
      q.choices || '',
      q.scramble || '',
      q.answer || '',
      q.translation || '',
      q.grammar || '',
      (q.vocab || []).flat().join(' '),
      (q.hint || []).join(' ')
    ].join(' ').toLowerCase()
  }));
}

function debouncedSearch() {
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(handleSearch, 150);
}

function handleSearch() {
  const searchInput = document.getElementById('searchInput');
  if (!searchIndex) buildSearchIndex();

  const query = searchInput.value.toLowerCase().trim();
  const cards = document.querySelectorAll('.qcard');

  if (!query) {
    cards.forEach(card => card.classList.remove('no-match'));
    return;
  }

  searchIndex.forEach((q, qi) => {
    const card = cards[qi];
    if (!card) return;
    card.classList.toggle('no-match', !q.searchText.includes(query));
  });
}

// ===== C7: THEME TOGGLE WITH ICON SPIN =====
function toggleTheme() {
  const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
  const icon = document.querySelector('.theme-icon');

  document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
  try { localStorage.setItem('theme', isDark ? 'light' : 'dark'); } catch(e) {}

  if (typeof gsap !== 'undefined' && !UV_REDUCED) {
    gsap.to(icon, {
      rotation: 180, scale: 0.5, opacity: 0, duration: 0.2,
      onComplete: () => {
        icon.textContent = isDark ? '\u2600\uFE0F' : '\u{1F319}';
        gsap.fromTo(icon,
          { rotation: -180, scale: 0.5, opacity: 0 },
          { rotation: 0, scale: 1, opacity: 1, duration: 0.3, ease: GSAP_CONFIG.ease.spring }
        );
      }
    });
  } else {
    icon.textContent = isDark ? '\u2600\uFE0F' : '\u{1F319}';
  }
}

// ===== B3: 3D TILT EFFECT (GSAP quickTo) =====
function initTypeCardTilt() {
  if (typeof gsap === 'undefined' || UV_REDUCED) return;
  const cards = document.querySelectorAll('.conj-card');
  if (!cards.length || 'ontouchstart' in window) return;

  cards.forEach(card => {
    if (card._tiltInit) return;
    card._tiltInit = true;

    gsap.set(card, { transformPerspective: 1000 });

    const xTo = gsap.quickTo(card, 'rotationX', { duration: GSAP_CONFIG.duration.fast, ease: GSAP_CONFIG.ease.gentle });
    const yTo = gsap.quickTo(card, 'rotationY', { duration: GSAP_CONFIG.duration.fast, ease: GSAP_CONFIG.ease.gentle });

    let cachedRect = null;
    let tiltRafId = 0;

    card.addEventListener('mouseenter', () => {
      cachedRect = card.getBoundingClientRect();
      gsap.to(card, { y: GSAP_CONFIG.hover.liftLarge, boxShadow: 'var(--shadow-lg)', duration: 0.3 });
    });

    card.addEventListener('mousemove', (e) => {
      if (!cachedRect || tiltRafId) return;
      tiltRafId = requestAnimationFrame(() => {
        tiltRafId = 0;
        xTo((e.clientY - cachedRect.top - cachedRect.height / 2) / 80);
        yTo((cachedRect.width / 2 - (e.clientX - cachedRect.left)) / 80);
      });
    });

    card.addEventListener('mouseleave', () => {
      cachedRect = null;
      if (tiltRafId) { cancelAnimationFrame(tiltRafId); tiltRafId = 0; }
      xTo(0);
      yTo(0);
      gsap.to(card, { y: 0, boxShadow: '', duration: 0.4, ease: GSAP_CONFIG.ease.default });
    });
  });
}

// ===== B1: HOME ENTRANCE (GSAP timeline) =====
function initHomeEntrance() {
  if (typeof gsap === 'undefined') return;
  if (document._homeEntrancePlayed) return;
  document._homeEntrancePlayed = true;
  const els = ['.home-label', '.home-title', '.home-subtitle', '.home-cta'];

  if (UV_REDUCED) {
    gsap.set(els.join(','), { opacity: 1, y: 0 });
    return;
  }

  const tl = gsap.timeline({ defaults: { ease: GSAP_CONFIG.ease.default, duration: GSAP_CONFIG.duration.slow } });
  tl.fromTo('.home-label', { opacity: 0, y: 24 }, { opacity: 1, y: 0 })
    .fromTo('.home-title', { opacity: 0, y: 24 }, { opacity: 1, y: 0 }, '-=0.4')
    .fromTo('.home-subtitle', { opacity: 0, y: 24 }, { opacity: 1, y: 0 }, '-=0.3')
    .fromTo('.home-cta', { opacity: 0, y: 24 }, { opacity: 1, y: 0 }, '-=0.2');
}

// ===== C2: OVERVIEW SECTION SCROLL REVEALS + C3: CARD CONTENT STAGGER =====
function initOverviewScrollReveals() {
  if (typeof gsap === 'undefined' || UV_REDUCED) return;

  // Kill previous overview ScrollTriggers to prevent accumulation
  ScrollTrigger.getAll().forEach(t => {
    if (t.vars.id && t.vars.id.startsWith('overview-')) t.kill();
  });

  gsap.utils.toArray('.conj-section').forEach((section, si) => {
    const header = section.querySelector('.conj-section-header');
    const cards = section.querySelectorAll('.conj-card');

    if (!header || !cards.length) return;

    const tl = gsap.timeline({
      scrollTrigger: {
        id: `overview-${si}`,
        trigger: section,
        start: GSAP_CONFIG.scroll.start,
        toggleActions: GSAP_CONFIG.scroll.toggleActions
      }
    });

    tl.fromTo(header, { opacity: 0, x: -20 }, { opacity: 1, x: 0, duration: 0.4, ease: GSAP_CONFIG.ease.default });

    cards.forEach((card, i) => {
      tl.fromTo(card, { opacity: 0, y: 10 }, { opacity: 1, y: 0, duration: 0.3, ease: GSAP_CONFIG.ease.default }, i === 0 ? '-=0.2' : '-=0.25');
    });
  });
}

// ===== B8: HOVER ANIMATIONS (GSAP) =====
function initHoverAnimations() {
  if (typeof gsap === 'undefined' || UV_REDUCED || 'ontouchstart' in window) return;
  if (document._hoverDelegateInit) return;
  document._hoverDelegateInit = true;

  const hoverRules = [
    { sel: '.top-nav-link:not(.active)', enter: { y: -1, color: 'var(--text)' }, leave: { y: 0, clearProps: 'color' } },
    { sel: '.top-nav-theme', enter: { scale: GSAP_CONFIG.hover.scaleSmall, boxShadow: 'var(--shadow-sm)' }, leave: { scale: 1, boxShadow: '' } },
    { sel: '.sub-nav-cat', enter: { y: -2, borderColor: 'var(--cat-color)', color: 'var(--cat-color)' }, leave: { y: 0, clearProps: 'borderColor,color' } },
    { sel: '.sub-nav-section:not(.active)', enter: { scale: GSAP_CONFIG.hover.scaleMedium, borderColor: 'var(--text)', color: 'var(--text)' }, leave: { scale: 1, clearProps: 'borderColor,color' } },
    { sel: '.btn-primary', enter: { y: GSAP_CONFIG.hover.lift, boxShadow: 'var(--shadow-lg)' }, leave: { y: 0, boxShadow: '' }, dur: GSAP_CONFIG.duration.fast, ease: GSAP_CONFIG.ease.spring },
    { sel: '.btn-secondary', enter: { borderColor: 'var(--text)', backgroundColor: 'var(--card)', boxShadow: 'var(--shadow)' }, leave: { clearProps: 'borderColor,backgroundColor,boxShadow' } },
    { sel: '.box', enter: { y: -2, boxShadow: 'var(--shadow)', borderColor: 'var(--border-visible)' }, leave: { y: 0, boxShadow: 'var(--shadow-sm)', clearProps: 'borderColor' } },
    { sel: '.toggle-btn', enter: { y: GSAP_CONFIG.hover.lift, boxShadow: '0 6px 20px rgba(0,0,0,0.15)' }, leave: { y: 0, scale: 1, boxShadow: '0 2px 8px rgba(0,0,0,0.12), 0 4px 12px rgba(0,0,0,0.08)' }, ease: GSAP_CONFIG.ease.spring },
    { sel: '.qcard', enter: { y: GSAP_CONFIG.hover.lift, boxShadow: 'var(--shadow-lg)' }, leave: { y: 0, boxShadow: 'var(--shadow)' } },
  ];

  function findRule(el) {
    if (!el.matches) return null;
    for (const r of hoverRules) { if (el.matches(r.sel)) return r; }
    return null;
  }

  document.addEventListener('mouseenter', (e) => {
    const r = findRule(e.target);
    if (!r) return;
    gsap.to(e.target, { ...r.enter, duration: r.dur || GSAP_CONFIG.duration.micro, ease: r.ease, overwrite: true });
  }, true);

  document.addEventListener('mouseleave', (e) => {
    const r = findRule(e.target);
    if (!r) return;
    gsap.to(e.target, { ...r.leave, duration: r.dur || GSAP_CONFIG.duration.micro, overwrite: true });
  }, true);

  document.addEventListener('mousedown', (e) => {
    if (e.target.matches && e.target.matches('.toggle-btn')) gsap.to(e.target, { y: 0, scale: 0.96, duration: 0.1 });
  }, true);
  document.addEventListener('mouseup', (e) => {
    if (e.target.matches && e.target.matches('.toggle-btn')) gsap.to(e.target, { scale: 1, duration: 0.15, ease: GSAP_CONFIG.ease.spring });
  }, true);
}

// ===== C8: SEARCH FOCUS ANIMATION =====
function initSearchFocus() {
  if (typeof gsap === 'undefined' || UV_REDUCED) return;
  const input = document.getElementById('searchInput');
  if (!input || input._focusInit) return;
  input._focusInit = true;

  input.addEventListener('focus', () => {
    gsap.to(input, { scale: 1.02, boxShadow: '0 0 0 4px var(--prep-light)', duration: GSAP_CONFIG.duration.fast });
  });
  input.addEventListener('blur', () => {
    gsap.to(input, { scale: 1, boxShadow: 'none', duration: 0.2 });
  });
}

// ===== B5: AUTO-HIDE NAVIGATION (GSAP) =====
let navVisible = true;
let hideTimeout = null;
let hasScrolled = false;

function showNav() {
  clearTimeout(hideTimeout);
  navVisible = true;
  if (typeof gsap !== 'undefined') {
    gsap.to('.top-nav', { y: 0, visibility: 'visible', duration: GSAP_CONFIG.duration.nav, ease: GSAP_CONFIG.ease.nav });
    gsap.to('.mobile-nav', { y: 0, visibility: 'visible', duration: GSAP_CONFIG.duration.nav, ease: GSAP_CONFIG.ease.nav });
    if (NavState.view === 'question') {
      gsap.to('#subNav', { y: 0, opacity: 1, pointerEvents: 'auto', visibility: 'visible', duration: GSAP_CONFIG.duration.nav, ease: GSAP_CONFIG.ease.nav });
    }
  }
}

function hideNav() {
  hideTimeout = setTimeout(() => {
    navVisible = false;
    if (typeof gsap !== 'undefined') {
      gsap.to('.top-nav', { y: '-100%', visibility: 'hidden', duration: GSAP_CONFIG.duration.nav, ease: GSAP_CONFIG.ease.nav });
      gsap.to('#subNav', { y: '-100%', opacity: 0, pointerEvents: 'none', visibility: 'hidden', duration: GSAP_CONFIG.duration.nav, ease: GSAP_CONFIG.ease.nav });
      gsap.to('.mobile-nav', { y: '100%', visibility: 'hidden', duration: GSAP_CONFIG.duration.nav, ease: GSAP_CONFIG.ease.nav });
    }
  }, 300);
}

function initAutoHideNav() {
  const topNav = document.querySelector('.top-nav');
  const subNav = document.getElementById('subNav');

  showNav();

  window.addEventListener('scroll', () => {
    if (!hasScrolled && window.scrollY > 50) {
      hasScrolled = true;
      hideNav();
    }
  }, { passive: true });

  let navRafId = 0;
  document.addEventListener('mousemove', (e) => {
    if (!hasScrolled) return;
    if (e.target.closest && e.target.closest('.iq-progress-panel, .iq-progress-backdrop')) return;
    if (navRafId) return;
    const clientY = e.clientY;
    const clientX = e.clientX;
    navRafId = requestAnimationFrame(() => {
      navRafId = 0;
      var vw = window.innerWidth;
      var inCenter = clientX > vw * 0.35 && clientX < vw * 0.65;
      if (clientY < 80 && inCenter) {
        if (!navVisible) showNav();
      } else if (clientY > 200 && navVisible) {
        hideNav();
      }
    });
  }, { passive: true });

  topNav.addEventListener('mouseenter', () => clearTimeout(hideTimeout));
  subNav.addEventListener('mouseenter', () => clearTimeout(hideTimeout));
  topNav.addEventListener('mouseleave', () => { if (hasScrolled) hideNav(); });
  subNav.addEventListener('mouseleave', () => { if (hasScrolled) hideNav(); });

  document.addEventListener('touchstart', (e) => {
    const touch = e.touches[0];
    if (touch.clientY < 100) {
      if (navVisible && hasScrolled) hideNav();
      else showNav();
    } else if (touch.clientY > 200 && navVisible && hasScrolled) {
      hideNav();
    }
  }, { passive: true });
}

// ===== INIT =====
window.addEventListener('DOMContentLoaded', () => {
  // Load saved preferences
  try {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
      document.documentElement.setAttribute('data-theme', 'dark');
      document.querySelector('.theme-icon').textContent = '\u{1F319}';
    }

  } catch(e) {}

  // Parse initial hash and render
  Router.parseHash();
  Router.render();

  // Initialize GSAP-powered features
  initAutoHideNav();
  initHoverAnimations();
  initSearchFocus();
});

// Handle browser back/forward
window.addEventListener('popstate', () => {
  Router.parseHash();
  Router.render();
});
</script>
<link rel="stylesheet" href="../../../teacher-reveal.css">
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js" defer></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth-compat.js" defer></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database-compat.js" defer></script>
<script src="../../../firebase-config.js" defer></script>
<script src="../../../answer-fetch.js" defer></script>
<script src="../../../teacher-reveal.js" defer></script>
<link rel="stylesheet" href="../../../interactive-quiz.css">
<script src="https://cdn.jsdelivr.net/gh/snd-lib/snd-lib@v1.2.4/dist/browser/snd.js" defer></script>
<script src="../../../ui-sounds.js" defer></script>
<script src="../../../interactive-quiz.js" defer></script>
<script src="../../../student-responses.js" defer></script>
<script src="../../../spaced-review.js" defer></script>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('../../../sw.js', { scope: '/English-Resources/' })
    .catch(function() {});
}
</script>
</body>
</html>
