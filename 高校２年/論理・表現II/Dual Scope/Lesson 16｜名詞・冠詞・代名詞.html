<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>16 名詞・冠詞・代名詞 | Nouns, Articles & Pronouns</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600&family=Noto+Serif+JP:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Core palette - Nordic warm kinari */
      --bg: #F5F0E6;
      --bg-warm: #EDE8DE;
      --card: #FFFFFF;
      --text: #1C1917;
      --text-secondary: #57534E;
      --text-muted: #A3A09C;
      --accent: #3D8BCA;
      --border: rgba(28, 25, 23, 0.08);
      --border-visible: rgba(28, 25, 23, 0.12);
      /* Enhanced Nordic shadows with soft inset glow */
      --shadow-sm: 0 1px 2px rgba(61, 67, 64, 0.05),
                   0 4px 12px rgba(61, 67, 64, 0.08),
                   inset 0 1px 0 rgba(255, 255, 255, 0.5);
      --shadow: 0 2px 4px rgba(61, 67, 64, 0.06),
                0 8px 24px rgba(61, 67, 64, 0.12),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
      --shadow-lg: 0 4px 8px rgba(61, 67, 64, 0.06),
                   0 16px 48px rgba(61, 67, 64, 0.15),
                   inset 0 2px 0 rgba(255, 255, 255, 0.7);
      --radius: 20px;
      --radius-sm: 12px;
      /* Fluid typography */
      --fs-qtext: clamp(17px, 1.3vw, 19px);
      --fs-base: clamp(15px, 1.1vw, 17px);

      /* Category Colors - distinctive and memorable */
      --cat-basic: #5A8F65;
      --cat-basic-light: #EDF5EF;
      --cat-comm: #C28A2E;
      --cat-comm-light: #FBF6ED;
      --cat-advanced: #7E5A9E;
      --cat-advanced-light: #F5F0F8;

      /* Grammar type colors - BLUE/GREEN THEME for Lesson 16 */
      --prep: #3D8BCA;         /* Blue (Primary accent) */
      --prep-light: #f0f7fc;   /* Very light blue tint */
      --noun: #5A9A6E;         /* Green - muted */
      --noun-light: #f3f9f5;   /* Almost white, hint of green */
      --article: #E8725C;      /* Coral - warm accent */
      --article-light: #fef4f2; /* Almost white, hint of coral */
      --pronoun: #9B7FCF;      /* Purple - distinguishing */
      --pronoun-light: #f8f5fc; /* Almost white, hint of purple */
    }

    [data-theme="dark"] {
      /* Gradient glassy background - gray-beige with depth */
      --bg: #141312;
      --bg-warm: #1e1c1a;
      --card: rgba(36, 34, 32, 0.92);
      --card-solid: #242220;
      --text: #F5F3F0;
      --text-secondary: #A3A09C;
      --text-muted: #666666;
      --accent: #5BA3D9;
      --border: rgba(255, 255, 255, 0.06);
      --border-visible: rgba(255, 255, 255, 0.10);
      /* Enhanced dark mode shadows - more visible on dark backgrounds */
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.35),
                   0 0 0 1px rgba(255, 255, 255, 0.03),
                   inset 0 1px 0 rgba(255, 255, 255, 0.05);
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(255, 255, 255, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 0.06);
      --shadow-lg: 0 12px 40px rgba(0, 0, 0, 0.6),
                   0 0 0 1px rgba(255, 255, 255, 0.05),
                   inset 0 1px 0 rgba(255, 255, 255, 0.08);

      --cat-basic: #6BA876;
      --cat-basic-light: rgba(90, 143, 101, 0.15);
      --cat-comm: #D9A043;
      --cat-comm-light: rgba(194, 138, 46, 0.15);
      --cat-advanced: #9A72B8;
      --cat-advanced-light: rgba(126, 90, 158, 0.15);

      --prep: #5BA3D9;         /* Muted blue for dark bg */
      --prep-light: rgba(91, 163, 217, 0.12);
      --noun: #6BAA7E;         /* Muted green for dark bg */
      --noun-light: rgba(107, 170, 126, 0.12);
      --article: #F08872;      /* Muted coral for dark bg */
      --article-light: rgba(240, 136, 114, 0.12);
      --pronoun: #B099DF;      /* Muted purple for dark bg */
      --pronoun-light: rgba(176, 153, 223, 0.12);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', 'Noto Sans JP', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
    }

    /* Dark mode gradient glassy background */
    [data-theme="dark"] body {
      background: var(--bg);
      background-image:
        radial-gradient(ellipse 100% 80% at 50% 0%, rgba(91, 163, 217, 0.06) 0%, transparent 50%),
        radial-gradient(ellipse 80% 60% at 20% 100%, rgba(155, 127, 207, 0.05) 0%, transparent 40%),
        radial-gradient(ellipse 60% 50% at 80% 80%, rgba(107, 170, 126, 0.04) 0%, transparent 40%),
        linear-gradient(135deg, #141312 0%, #1a1816 50%, #121110 100%);
      background-attachment: fixed;
    }

    /* ===== TOP NAVIGATION BAR - Auto-Hide with Glassmorphism ===== */
    .top-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      padding: 0 24px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      /* Auto-hide: slide up when hidden */
      transform: translateY(-100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      /* Glassmorphism effect */
      background: rgba(250, 248, 245, 0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(28, 25, 23, 0.08);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
    }

    .top-nav.visible {
      transform: translateY(0);
    }

    [data-theme="dark"] .top-nav {
      background: rgba(15, 14, 13, 0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
    }

    .top-nav-logo {
      font-family: 'New York', 'Georgia', serif;
      font-size: 15px;
      font-weight: 400;
      letter-spacing: 0.02em;
      color: var(--text-secondary);
    }

    .top-nav-center {
      display: flex;
      gap: 4px;
      background: var(--bg-warm);
      padding: 4px;
      border-radius: 100px;
    }

    .top-nav-link {
      padding: 10px 24px;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      text-decoration: none;
      border-radius: 100px;
      transition: color 0.2s ease, background-color 0.2s ease, transform 0.15s ease;
      cursor: pointer;
      border: none;
      background: transparent;
      font-family: inherit;
    }

    .top-nav-link:hover {
      color: var(--text);
      transform: translateY(-1px);
    }

    .top-nav-link.active {
      color: var(--text);
      background: var(--card);
      box-shadow: var(--shadow-sm);
    }

    .top-nav-right {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .view-toggle-nav {
      display: flex;
      background: var(--bg-warm);
      border-radius: 100px;
      padding: 4px;
    }

    .view-btn-nav {
      padding: 8px 16px;
      border: none;
      border-radius: 100px;
      background: transparent;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
    }

    .view-btn-nav.active {
      background: var(--card);
      color: var(--text);
      box-shadow: var(--shadow-sm);
    }

    .top-nav-theme {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid var(--border);
      background: var(--card);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .top-nav-theme:hover {
      transform: scale(1.05);
      box-shadow: var(--shadow-sm);
    }

    /* ===== SUB NAVIGATION - Auto-Hide with Glassmorphism ===== */
    .sub-nav {
      position: fixed;
      top: 60px;
      left: 0;
      right: 0;
      z-index: 999;
      padding: 12px 24px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
      /* Auto-hide: slide up when hidden */
      transform: translateY(-100%);
      opacity: 0;
      pointer-events: none;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                  opacity 0.3s ease;
      /* Glassmorphism effect */
      background: rgba(250, 248, 245, 0.9);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-bottom: 1px solid rgba(28, 25, 23, 0.08);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
    }

    .sub-nav.visible {
      transform: translateY(0);
      opacity: 1;
      pointer-events: auto;
    }

    [data-theme="dark"] .sub-nav {
      background: rgba(15, 14, 13, 0.9);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .sub-nav-categories {
      display: flex;
      gap: 8px;
    }

    .sub-nav-cat {
      padding: 10px 24px;
      border: 2px solid var(--border);
      border-radius: 100px;
      background: transparent;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: background-color 0.2s ease,
                  transform 0.2s ease,
                  box-shadow 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .sub-nav-cat::before {
      content: '';
      position: absolute;
      inset: 0;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .sub-nav-cat[data-cat="basic"] { --cat-color: var(--cat-basic); --cat-bg: var(--cat-basic-light); }
    .sub-nav-cat[data-cat="comm"] { --cat-color: var(--cat-comm); --cat-bg: var(--cat-comm-light); }
    .sub-nav-cat[data-cat="advanced"] { --cat-color: var(--cat-advanced); --cat-bg: var(--cat-advanced-light); }

    .sub-nav-cat:hover {
      border-color: var(--cat-color);
      color: var(--cat-color);
      transform: translateY(-2px);
    }

    .sub-nav-cat.active {
      border-color: var(--cat-color);
      background: var(--cat-bg);
      color: var(--cat-color);
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    }

    .sub-nav-sections {
      display: flex;
      gap: 6px;
    }

    .sub-nav-section {
      width: 36px;
      height: 36px;
      border: 2px solid var(--border);
      border-radius: 10px;
      background: transparent;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 700;
      font-family: 'Space Grotesk', monospace;
      cursor: pointer;
      transition: border-color 0.2s ease, color 0.2s ease, background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .sub-nav-section:hover {
      border-color: var(--text);
      color: var(--text);
      transform: scale(1.08);
    }

    .sub-nav-section.active {
      background: var(--text);
      border-color: var(--text);
      color: var(--bg);
      box-shadow: var(--shadow-sm);
    }

    /* ===== MAIN CONTENT AREA ===== */
    .main-content {
      padding-top: 60px;
      min-height: 100vh;
    }

    .main-content.has-subnav {
      padding-top: 152px;
    }

    /* ===== HOME VIEW ===== */
    .view-home {
      min-height: calc(100vh - 60px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 40px;
      position: relative;
      overflow: hidden;
    }

    .home-bg {
      position: absolute;
      inset: 0;
      background:
        radial-gradient(ellipse 80% 60% at 50% 20%, var(--cat-basic-light) 0%, transparent 50%),
        radial-gradient(ellipse 60% 50% at 20% 80%, var(--cat-comm-light) 0%, transparent 40%),
        radial-gradient(ellipse 50% 40% at 80% 70%, var(--cat-advanced-light) 0%, transparent 40%);
      opacity: 0.6;
    }

    .home-content {
      position: relative;
      z-index: 1;
      max-width: 800px;
    }

    .home-label {
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 24px;
      animation: fadeInUp 0.6s ease-out 0.1s both;
    }

    .home-title {
      font-family: 'New York', 'Georgia', serif;
      font-size: clamp(48px, 10vw, 120px);
      font-weight: 400;
      line-height: 1.1;
      letter-spacing: -0.03em;
      margin-bottom: 24px;
      animation: fadeInUp 0.6s ease-out 0.2s both;
    }

    .home-title em {
      font-style: normal;
      background: linear-gradient(135deg, var(--prep) 0%, var(--noun) 50%, var(--pronoun) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .home-subtitle {
      font-size: 20px;
      color: var(--text-secondary);
      max-width: 500px;
      margin: 0 auto 48px;
      line-height: 1.7;
      animation: fadeInUp 0.6s ease-out 0.3s both;
    }

    .home-cta {
      display: flex;
      gap: 16px;
      justify-content: center;
      animation: fadeInUp 0.6s ease-out 0.4s both;
    }

    .btn-primary {
      padding: 18px 40px;
      background: var(--text);
      color: var(--bg);
      border: none;
      border-radius: 100px;
      font-size: 16px;
      font-weight: 700;
      font-family: inherit;
      cursor: pointer;
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;
    }

    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }

    .btn-secondary {
      padding: 18px 40px;
      background: transparent;
      color: var(--text);
      border: 2px solid var(--border);
      border-radius: 100px;
      font-size: 16px;
      font-weight: 700;
      font-family: inherit;
      cursor: pointer;
      transition: border-color 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
    }

    .btn-secondary:hover {
      border-color: var(--text);
      background: var(--card);
      box-shadow: var(--shadow);
    }

    /* ===== OVERVIEW VIEW ===== */
    .view-overview {
      padding: 60px 48px 100px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .overview-header {
      text-align: center;
      margin-bottom: 60px;
    }

    .overview-label {
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 16px;
    }

    .overview-title {
      font-family: 'New York', 'Georgia', serif;
      font-size: clamp(32px, 5vw, 48px);
      font-weight: 400;
      letter-spacing: -0.02em;
    }

    /* Grammar Reference Sections */
    .conj-section {
      margin-bottom: 80px;
    }

    .conj-section-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 32px;
    }

    .conj-section-icon {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      flex-shrink: 0;
    }

    .conj-section.prep .conj-section-icon { background: var(--prep-light); }
    .conj-section.noun .conj-section-icon { background: var(--noun-light); }
    .conj-section.article .conj-section-icon { background: var(--article-light); }
    .conj-section.pronoun .conj-section-icon { background: var(--pronoun-light); }

    .conj-section-title {
      font-family: 'New York', 'Georgia', serif;
      font-size: clamp(24px, 4vw, 32px);
      font-weight: 400;
    }

    .conj-section-title-jp {
      font-family: 'Noto Serif JP', 'Yu Mincho', serif;
      font-size: 14px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .conj-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px;
    }

    .conj-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 28px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border-visible);
      border-left: 4px solid var(--card-accent);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      animation: fadeIn 0.4s ease backwards;
      transform-style: preserve-3d;
    }

    .conj-card:hover {
      transform: translateY(-4px) rotateX(2deg) rotateY(-1deg);
      box-shadow: var(--shadow-lg);
    }

    .conj-card:nth-child(1) { animation-delay: 0s; }
    .conj-card:nth-child(2) { animation-delay: 0.05s; }
    .conj-card:nth-child(3) { animation-delay: 0.1s; }
    .conj-card:nth-child(4) { animation-delay: 0.15s; }
    .conj-card:nth-child(5) { animation-delay: 0.2s; }
    .conj-card:nth-child(6) { animation-delay: 0.25s; }
    .conj-card:nth-child(7) { animation-delay: 0.3s; }
    .conj-card:nth-child(8) { animation-delay: 0.35s; }

    .conj-section.prep .conj-card { --card-accent: var(--prep); }
    .conj-section.noun .conj-card { --card-accent: var(--noun); }
    .conj-section.article .conj-card { --card-accent: var(--article); }
    .conj-section.pronoun .conj-card { --card-accent: var(--pronoun); }

    .conj-card-word {
      font-family: 'New York', 'Georgia', serif;
      font-size: 26px;
      font-weight: 400;
      color: var(--card-accent);
      margin-bottom: 4px;
    }

    .conj-card-meaning {
      font-size: 15px;
      color: var(--text-secondary);
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    .conj-card-example {
      margin-bottom: 16px;
    }

    .conj-card-example-en {
      font-size: 17px;
      line-height: 1.7;
      margin-bottom: 6px;
    }

    .conj-card-example-en strong {
      color: var(--card-accent);
      font-weight: 700;
    }

    .conj-card-example-jp {
      font-size: 15px;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .conj-card-tip {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 14px 16px;
      background: var(--bg-warm);
      border-radius: var(--radius-sm);
      margin-top: 16px;
    }

    [data-theme="dark"] .conj-card-tip {
      background: var(--bg);
    }

    .conj-card-tip-icon {
      font-size: 16px;
      flex-shrink: 0;
      margin-top: 1px;
    }

    .conj-card-tip-text {
      font-size: 13px;
      line-height: 1.6;
      color: var(--text-secondary);
    }

    /* ===== QUESTION VIEW ===== */
    .view-question {
      padding: 40px 48px 100px;
      max-width: 1000px;
      margin: 0 auto;
    }

    .question-header {
      margin-bottom: 32px;
    }

    .question-category-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      border-radius: 100px;
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .question-category-badge.basic {
      background: var(--cat-basic-light);
      color: var(--cat-basic);
    }

    .question-category-badge.comm {
      background: var(--cat-comm-light);
      color: var(--cat-comm);
    }

    .question-category-badge.advanced {
      background: var(--cat-advanced-light);
      color: var(--cat-advanced);
    }

    .question-title {
      font-family: 'New York', 'Georgia', serif;
      font-size: clamp(24px, 4vw, 32px);
      font-weight: 400;
      margin-bottom: 8px;
    }

    .question-subtitle {
      font-size: 15px;
      color: var(--text-secondary);
    }

    /* Progress */
    .progress-wrap {
      margin-bottom: 32px;
    }

    .progress-bar-bg {
      height: 6px;
      background: var(--bg-warm);
      border-radius: 100px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--prep), var(--pronoun));
      border-radius: 100px;
      width: 0%;
      transition: width 0.3s ease;
    }

    .progress-label {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 8px;
      text-align: right;
    }

    /* Search */
    .search-wrap {
      position: relative;
      margin-bottom: 32px;
    }

    .search-input {
      width: 100%;
      padding: 16px 20px 16px 52px;
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      background: var(--card);
      font-size: 15px;
      font-family: inherit;
      color: var(--text);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 4px var(--prep-light);
    }

    .search-input::placeholder {
      color: var(--text-muted);
    }

    .search-icon {
      position: absolute;
      left: 18px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      font-size: 18px;
    }

    /* Questions List */
    .questions-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
      contain: content;
    }

    /* Question Card */
    .qcard {
      background: var(--card);
      border-radius: var(--radius);
      border: 1px solid var(--border-visible);
      box-shadow: var(--shadow);
      overflow: hidden;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease,
                  transform 0.5s ease,
                  box-shadow 0.3s ease;
    }

    .qcard.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .qcard.visible:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }

    .qcard:nth-child(1) { transition-delay: 0s; }
    .qcard:nth-child(2) { transition-delay: 0.05s; }
    .qcard:nth-child(3) { transition-delay: 0.1s; }
    .qcard:nth-child(4) { transition-delay: 0.15s; }
    .qcard:nth-child(5) { transition-delay: 0.2s; }

    [data-theme="dark"] .qcard {
      background: var(--card);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid var(--border-visible);
      box-shadow: var(--shadow);
      contain: layout style;
    }

    .qcard-question, .qcard-buttons, .qcard-left, .qcard-right {
      box-sizing: border-box;
    }

    .qcard-buttons, .toggle-btn-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .qcard-buttons {
      padding: 0 24px 20px;
    }

    /* Dual/Split view */
    [data-view="dual"] .qcard {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto auto;
      grid-template-areas:
        "question question"
        "left right";
    }

    [data-view="dual"] .qcard-buttons {
      display: none;
    }

    [data-view="dual"] .qcard-question {
      grid-area: question;
      padding: 24px;
      border-bottom: 1px solid var(--border);
    }

    [data-view="dual"] .qcard-left {
      grid-area: left;
      padding: 24px;
      border-right: 1px solid var(--border);
    }

    [data-view="dual"] .qcard-right {
      grid-area: right;
      padding: 24px;
      background: var(--card);
    }

    [data-view="dual"] .collapsible {
      display: none;
    }

    [data-view="dual"] .collapsible.open {
      display: block;
      margin-top: 16px;
    }

    /* Single view */
    [data-view="single"] .qcard {
      display: block;
    }

    [data-view="single"] .qcard-buttons {
      display: flex;
    }

    [data-view="single"] .toggle-btn-row {
      display: none;
    }

    [data-view="single"] .qcard-question {
      padding: 24px 24px 16px;
    }

    [data-view="single"] .qcard-left {
      padding: 0 24px 0;
      border-right: none;
    }

    [data-view="single"] .qcard-right {
      padding: 0 24px 24px;
      background: transparent;
    }

    [data-view="single"] .collapsible {
      display: none;
    }

    [data-view="single"] .collapsible.open {
      display: block;
      margin-top: 16px;
    }

    @media (max-width: 800px) {
      [data-view="dual"] .qcard {
        grid-template-columns: 1fr;
        grid-template-areas:
          "question"
          "left"
          "right";
      }
      [data-view="dual"] .qcard-left {
        border-right: none;
        border-bottom: 1px solid var(--border);
      }
    }

    .qnum {
      display: inline-block;
      font-weight: 700;
      font-size: 12px;
      color: var(--accent);
      background: var(--prep-light);
      padding: 4px 12px;
      border-radius: 100px;
      margin-bottom: 12px;
    }

    .qtext {
      font-size: var(--fs-qtext);
      line-height: 1.8;
      margin-bottom: 12px;
    }

    .choices, .scramble {
      padding: 14px 16px;
      border-radius: var(--radius-sm);
      font-size: 17px;
    }

    .qcard-question .choices:last-child,
    .qcard-question .scramble:last-child {
      margin-bottom: 0;
    }

    .choices {
      background: var(--pronoun-light);
      border-left: 3px solid var(--pronoun);
    }

    .scramble {
      background: var(--prep-light);
      border-left: 3px solid var(--prep);
      font-family: 'JetBrains Mono', 'SF Mono', Monaco, monospace;
    }

    .toggle-btn {
      flex: 1;
      min-width: 80px;
      min-height: 44px;
      padding: 12px 24px;
      border: none;
      border-radius: 100px;
      font-size: 13px;
      font-weight: 700;
      font-family: inherit;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12),
                  0 4px 12px rgba(0, 0, 0, 0.08);
      transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1),
                  box-shadow 0.2s ease,
                  background-color 0.2s ease;
    }

    .toggle-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .toggle-btn:active {
      transform: translateY(0) scale(0.96);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .toggle-btn.vocab { background: var(--pronoun); color: white; }
    .toggle-btn.hint { background: var(--prep); color: white; }
    .toggle-btn.answer { background: var(--noun); color: white; }

    @media (max-width: 768px) {
      .toggle-btn {
        min-height: 48px;
        padding: 14px 28px;
        font-size: 14px;
      }
    }

    .box {
      border-radius: var(--radius-sm);
      padding: 16px;
      font-size: 17px;
      line-height: 1.7;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border);
      transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
    }

    .box:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
      border-color: var(--border-visible);
    }

    .vocab-box {
      background: var(--card);
      border-left: 3px solid var(--pronoun);
    }

    .hint-box {
      background: var(--card);
      border-left: 3px solid var(--prep);
    }

    .hint-item {
      padding: 8px 0;
      border-bottom: 1px solid rgba(61, 139, 202, 0.15);
    }

    .hint-item:last-child {
      border-bottom: none;
    }

    .ans-box {
      background: var(--card);
      border-left: 3px solid var(--noun);
    }

    [data-theme="dark"] .box {
      background: var(--card);
      border-color: var(--border-visible);
      box-shadow: var(--shadow-sm);
    }

    [data-theme="dark"] .box:hover {
      box-shadow: var(--shadow);
    }

    .choice-explanations {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(90, 154, 110, 0.2);
    }

    .choice-exp {
      padding: 8px 0;
      font-size: 16px;
      line-height: 1.6;
      border-bottom: 1px solid rgba(90, 154, 110, 0.12);
    }

    .choice-exp:last-child {
      border-bottom: none;
    }

    .choice-exp.correct {
      color: var(--noun);
      font-weight: 600;
    }

    .choice-exp.wrong {
      color: var(--text-secondary);
    }

    .vocab-item {
      padding: 6px 0;
      border-bottom: 1px solid rgba(155,127,207,0.15);
    }

    .vocab-item:last-child { border-bottom: none; }

    .vocab-word {
      font-weight: 700;
      color: var(--pronoun);
      margin-right: 8px;
    }

    .box-label {
      font-weight: 700;
      font-size: 18px;
      margin-bottom: 12px;
      display: block;
    }

    .jp-text {
      color: var(--text-secondary);
      margin-top: 12px;
      padding-bottom: 12px;
      font-size: 16px;
      border-bottom: 1px solid rgba(90, 154, 110, 0.15);
    }

    .jp-text:last-child {
      border-bottom: none;
    }

    .grammar-ref {
      background: var(--prep-light);
      border-left: 3px solid var(--prep);
      padding: 12px 14px;
      border-radius: var(--radius-sm);
      font-size: 15px;
      margin-top: 12px;
    }

    .no-match { display: none !important; }

    /* Footer */
    footer {
      text-align: center;
      padding: 40px;
      color: var(--text-muted);
      font-size: 13px;
      border-top: 1px solid var(--border);
    }

    /* ===== VIEW VISIBILITY ===== */
    .view-home,
    .view-overview,
    .view-question {
      display: none;
    }

    .view-home.active { display: flex; }
    .view-overview.active { display: block; }
    .view-question.active { display: block; }

    /* ===== CSS ANIMATIONS ===== */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(24px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .collapsible.open {
      animation: slideInSmooth 0.35s cubic-bezier(0.22, 1, 0.36, 1);
    }

    @keyframes slideInSmooth {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Reduced motion support for accessibility */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
      html {
        scroll-behavior: auto;
      }
    }

    /* Responsive */
    @media (max-width: 900px) {
      .conj-grid { grid-template-columns: 1fr; }
    }

    @media (max-width: 768px) {
      .top-nav {
        padding: 0 16px;
        height: 56px;
      }

      .top-nav-logo {
        font-size: 13px;
      }

      .top-nav-center {
        display: none;
      }

      .top-nav-right {
        gap: 6px;
      }

      .view-toggle-nav {
        display: none;
      }

      .sub-nav {
        padding: 12px 16px;
        gap: 10px;
      }

      .sub-nav-categories {
        flex-wrap: wrap;
        justify-content: center;
        gap: 6px;
      }

      .sub-nav-cat {
        padding: 8px 16px;
        font-size: 13px;
      }

      .sub-nav-sections {
        gap: 4px;
      }

      .sub-nav-section {
        width: 32px;
        height: 32px;
        font-size: 13px;
      }

      .main-content {
        padding-top: 56px;
      }

      .main-content.has-subnav {
        padding-top: 140px;
      }

      .view-home {
        padding: 24px;
      }

      .home-title {
        font-size: clamp(40px, 12vw, 80px);
      }

      .home-cta {
        flex-direction: column;
        width: 100%;
      }

      .btn-primary, .btn-secondary {
        width: 100%;
        padding: 16px 32px;
      }

      .view-overview,
      .view-question {
        padding: 32px 20px 80px;
      }
    }

    /* Mobile nav drawer */
    @media (max-width: 768px) {
      .mobile-nav-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border: 1px solid var(--border);
        border-radius: 10px;
        background: var(--card);
        cursor: pointer;
        font-size: 20px;
      }

      .mobile-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--card);
        border-top: 1px solid var(--border);
        padding: 12px 16px;
        display: flex;
        justify-content: space-around;
        z-index: 1001;
        box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
      }

      .mobile-nav-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        padding: 8px 16px;
        border: none;
        background: transparent;
        color: var(--text-secondary);
        font-size: 11px;
        font-weight: 600;
        font-family: inherit;
        cursor: pointer;
        border-radius: 12px;
        transition: color 0.2s ease, background-color 0.2s ease;
      }

      .mobile-nav-btn.active {
        color: var(--accent);
        background: var(--prep-light);
      }

      .mobile-nav-btn-icon {
        font-size: 20px;
      }

      footer {
        padding-bottom: 100px;
      }
    }

    @media (min-width: 769px) {
      .mobile-nav {
        display: none;
      }
    }

    /* ===== LARGE SCREEN OPTIMIZATION ===== */
    @media (min-width: 1200px) {
      .view-question {
        max-width: 1100px;
      }
    }

    @media (min-width: 1440px) {
      .view-question {
        max-width: 1250px;
        padding: 48px 56px 100px;
      }
      .view-overview {
        max-width: 1500px;
      }
    }

    @media (min-width: 1728px) {
      .view-question {
        max-width: 1400px;
        padding: 56px 64px 100px;
      }
      .view-overview {
        max-width: 1600px;
      }
      .qtext {
        font-size: 20px;
      }
    }
  </style>
</head>
<body data-view="single">

  <!-- ===== TOP NAVIGATION BAR ===== -->
  <nav class="top-nav" id="topNav">
    <div class="top-nav-logo">DUAL SCOPE</div>
    <div class="top-nav-center">
      <button class="top-nav-link active" data-nav="home" onclick="Router.navigate('home')">Home</button>
      <button class="top-nav-link" data-nav="overview" onclick="Router.navigate('overview')">Overview</button>
      <button class="top-nav-link" data-nav="question" onclick="Router.navigate('question')">Question</button>
    </div>
    <div class="top-nav-right">
      <div class="view-toggle-nav">
        <button class="view-btn-nav active" data-view="single" onclick="setView('single')">Single</button>
        <button class="view-btn-nav" data-view="dual" onclick="setView('dual')">Split</button>
      </div>
      <button class="top-nav-theme" onclick="toggleTheme()" title="Toggle theme">
        <span class="theme-icon">&#9728;&#65039;</span>
      </button>
    </div>
  </nav>

  <!-- ===== SUB NAVIGATION (Question view only) ===== -->
  <nav class="sub-nav" id="subNav">
    <div class="sub-nav-categories">
      <button class="sub-nav-cat active" data-cat="basic" onclick="Router.setCategory('basic')">基本問題</button>
      <button class="sub-nav-cat" data-cat="comm" onclick="Router.setCategory('comm')">For Communication</button>
      <button class="sub-nav-cat" data-cat="advanced" onclick="Router.setCategory('advanced')">発展問題</button>
    </div>
    <div class="sub-nav-sections" id="sectionToggles"></div>
  </nav>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="main-content" id="mainContent">

    <!-- HOME VIEW -->
    <section class="view-home active" id="viewHome">
      <div class="home-bg"></div>
      <div class="home-content">
        <p class="home-label">Lesson 16</p>
        <h1 class="home-title">名詞・冠詞・<em>代名詞</em></h1>
        <p class="home-subtitle">Master nouns, articles and pronouns in English grammar.</p>
        <div class="home-cta">
          <button class="btn-primary" onclick="Router.navigate('question')">Start Learning</button>
          <button class="btn-secondary" onclick="Router.navigate('overview')">Overview</button>
        </div>
      </div>
    </section>

    <!-- OVERVIEW VIEW -->
    <section class="view-overview" id="viewOverview">
      <div class="overview-header">
        <p class="overview-label">Reference Guide</p>
        <h2 class="overview-title">Grammar Types</h2>
      </div>

      <!-- Prepositions -->
      <section class="conj-section prep">
        <div class="conj-section-header">
          <div class="conj-section-icon">&#128205;</div>
          <div>
            <h2 class="conj-section-title">Prepositions</h2>
            <p class="conj-section-title-jp">前置詞</p>
          </div>
        </div>
        <div class="conj-grid">
          <div class="conj-card">
            <div class="conj-card-word">on</div>
            <div class="conj-card-meaning">〜の上に（接触）</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">Look at the picture <strong>on</strong> the wall.</p>
              <p class="conj-card-example-jp">壁の絵を見てごらん。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">表面に接触していることを表す。上面だけでなく、側面や下面でも使う</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">until / by</div>
            <div class="conj-card-meaning">〜まで / 〜までには</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">I must stay home <strong>until</strong> eleven.</p>
              <p class="conj-card-example-jp">私は11時まで家にいなければならない。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">until は継続の終点、by は完了の期限を表す</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">from / of</div>
            <div class="conj-card-meaning">〜から作られる</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">Wine is made <strong>from</strong> grapes.</p>
              <p class="conj-card-example-jp">ワインはぶどうから作られる。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">from は原料（質が変化）、of は材料（質が変化しない）</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">in + 時間</div>
            <div class="conj-card-meaning">（今から）〜後に</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">Your pizza will be delivered <strong>in</strong> 30 minutes.</p>
              <p class="conj-card-example-jp">お客様のピザは30分で配達されます。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">未来を表す文で使用。過去では after を使う</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Nouns -->
      <section class="conj-section noun">
        <div class="conj-section-header">
          <div class="conj-section-icon">&#128230;</div>
          <div>
            <h2 class="conj-section-title">Nouns</h2>
            <p class="conj-section-title-jp">名詞</p>
          </div>
        </div>
        <div class="conj-grid">
          <div class="conj-card">
            <div class="conj-card-word">物質名詞</div>
            <div class="conj-card-meaning">juice, bread, coffee など</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">There is some <strong>juice</strong> left.</p>
              <p class="conj-card-example-jp">オレンジジュースが残っている。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">数えられないので常に単数形。a cup of, a slice of などで数を表す</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">集合名詞</div>
            <div class="conj-card-meaning">police, staff, furniture など</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">The <strong>police</strong> are investigating.</p>
              <p class="conj-card-example-jp">警察はその事故を調査している。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">police は常に複数扱い、furniture は常に単数扱い</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">抽象名詞</div>
            <div class="conj-card-meaning">information, advice, news など</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">I gave them two <strong>pieces of advice</strong>.</p>
              <p class="conj-card-example-jp">私は彼らに2つ助言をした。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">a piece of で数を表す。news は形は複数でも単数扱い</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">固有名詞</div>
            <div class="conj-card-meaning">the United States など</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en"><strong>The United States</strong> is one of the largest countries.</p>
              <p class="conj-card-example-jp">アメリカ合衆国は世界で最も大きな国のひとつである。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">複数形の国名・山脈・群島には the をつける。国名は単数扱い</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Articles -->
      <section class="conj-section article">
        <div class="conj-section-header">
          <div class="conj-section-icon">&#128221;</div>
          <div>
            <h2 class="conj-section-title">Articles</h2>
            <p class="conj-section-title-jp">冠詞</p>
          </div>
        </div>
        <div class="conj-grid">
          <div class="conj-card">
            <div class="conj-card-word">a / an</div>
            <div class="conj-card-meaning">不定冠詞</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">There is <strong>an</strong> old church in front of the station.</p>
              <p class="conj-card-example-jp">駅の正面に古い教会がある。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">初めて話題に上る単数の数えられる名詞に使う。母音で始まる語の前は an</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">the</div>
            <div class="conj-card-meaning">定冠詞</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en"><strong>The</strong> moon goes around <strong>the</strong> earth.</p>
              <p class="conj-card-example-jp">ほぼ1か月で月は地球の周りを回っている。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">唯一のもの、特定できるものに使う。the + 形容詞 で「〜の人々」</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">無冠詞</div>
            <div class="conj-card-meaning">冠詞なし</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">Let's play <strong>baseball</strong> after <strong>lunch</strong>.</p>
              <p class="conj-card-example-jp">昼食後に野球をしようよ。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">食事・スポーツ・ゲームを表す名詞には冠詞をつけない</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">by the + 単位</div>
            <div class="conj-card-meaning">〜単位で</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">Pencils are usually sold <strong>by the</strong> dozen.</p>
              <p class="conj-card-example-jp">鉛筆は普通1ダース単位で売られている。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">by the + 単位名詞 で「〜単位で」を表す</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Pronouns -->
      <section class="conj-section pronoun">
        <div class="conj-section-header">
          <div class="conj-section-icon">&#128100;</div>
          <div>
            <h2 class="conj-section-title">Pronouns</h2>
            <p class="conj-section-title-jp">代名詞</p>
          </div>
        </div>
        <div class="conj-grid">
          <div class="conj-card">
            <div class="conj-card-word">所有代名詞</div>
            <div class="conj-card-meaning">mine, yours, hers など</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">An old friend of <strong>mine</strong> came to stay.</p>
              <p class="conj-card-example-jp">昔からの友人の1人が泊まりに来た。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">a/an, the, this, some などと所有格は並べて使えないので所有代名詞を使う</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">再帰代名詞</div>
            <div class="conj-card-meaning">myself, himself など</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">He is not used to traveling <strong>by himself</strong>.</p>
              <p class="conj-card-example-jp">彼は一人旅には慣れていない。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">by oneself = alone（ひとりで）、in itself = 本来、それ自体は</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">another / other</div>
            <div class="conj-card-meaning">別のもの</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">Please show me <strong>another</strong>.</p>
              <p class="conj-card-example-jp">別のを見せてください。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">another = 不特定の別の1つ、the other = 残りの1つ</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">each / both</div>
            <div class="conj-card-meaning">それぞれ / 両方</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en"><strong>Each</strong> of us was asked our name.</p>
              <p class="conj-card-example-jp">私たちは1人1人名前を尋ねられた。</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">&#128161;</span>
              <span class="conj-card-tip-text">each は単数扱い、both は複数扱い（2人/2つについて使う）</span>
            </div>
          </div>
        </div>
      </section>
    </section>

    <!-- QUESTION VIEW -->
    <section class="view-question" id="viewQuestion">
      <div class="question-header">
        <div class="question-category-badge basic" id="categoryBadge">
          <span id="categoryIcon">&#128218;</span>
          <span id="categoryName">基本問題</span>
        </div>
        <h2 class="question-title" id="sectionTitle">[1] 基本問題 1</h2>
        <p class="question-subtitle" id="sectionSubtitle">14 questions</p>
      </div>

      <div class="progress-wrap">
        <div class="progress-bar-bg">
          <div class="progress-bar-fill" id="progressBar"></div>
        </div>
        <p class="progress-label" id="progressText">0 / 0 answers revealed</p>
      </div>

      <div class="search-wrap">
        <span class="search-icon">&#128269;</span>
        <input type="text" class="search-input" id="searchInput" placeholder="Search questions, grammar, vocabulary..." oninput="debouncedSearch()">
      </div>

      <div class="questions-list" id="questionsList"></div>
    </section>
  </main>

  <!-- Mobile Navigation -->
  <nav class="mobile-nav">
    <button class="mobile-nav-btn active" data-nav="home" onclick="Router.navigate('home')">
      <span class="mobile-nav-btn-icon">&#127968;</span>
      Home
    </button>
    <button class="mobile-nav-btn" data-nav="overview" onclick="Router.navigate('overview')">
      <span class="mobile-nav-btn-icon">&#128218;</span>
      Overview
    </button>
    <button class="mobile-nav-btn" data-nav="question" onclick="Router.navigate('question')">
      <span class="mobile-nav-btn-icon">&#10067;</span>
      Question
    </button>
  </nav>

  <footer>DUAL SCOPE English Grammar — Lesson 16: 名詞・冠詞・代名詞</footer>

<script>
// ===== GRAMMAR DATA =====
const grammarData = {
  sections: [
    {
      title: "[1] 基本問題 1｜前置詞 (1)～(5)",
      open: true,
      questions: [
        {
          num: "(1)",
          text: "Look at the picture (   ) the wall.",
          choices: "選択肢: on, in, at",
          vocab: [["picture", "絵、写真"], ["wall", "壁"]],
          hint: ["壁に掛かっている絵は「接触」を表す", "表面に接触している状態を表す前置詞を選ぶ", "「on」は接触を表す"],
          answer: "on",
          translation: "壁の絵を見てごらん。",
          explanation: "onは表面への接触を表します。壁に掛かっている絵は壁に接触しているのでonを使います。",
          grammar: "on = 接触（上面だけでなく側面・下面も含む）",
          choiceExplanations: {
            "on": "○ 正解。壁に接触している状態を表す。",
            "in": "× 「中に」という意味で、壁の中には絵は入らない。",
            "at": "× 場所の一点を表すが、接触の意味はない。"
          }
        },
        {
          num: "(2)",
          text: "I must stay home (   ) eleven.",
          choices: "選択肢: until, by, for",
          vocab: [["stay home", "家にいる"], ["until", "～まで（継続）"], ["by", "～までに（期限）"]],
          hint: ["「11時まで家にいなければならない」という継続を表す", "untilは継続の終点、byは完了の期限", "行動が継続するか、一度で完了するかを考える"],
          answer: "until",
          translation: "私は11時まで家にいなければならない。",
          explanation: "untilは動作の継続の終点を表します。「ずっと家にいる」という継続状態なのでuntilが正解です。",
          grammar: "until = 継続の終点 / by = 完了の期限",
          choiceExplanations: {
            "until": "○ 正解。「11時まで（ずっと）家にいる」という継続を表す。",
            "by": "× 「～までに」は一回の動作の期限。継続動作には不適切。",
            "for": "× 「～の間」で期間の長さを表す。時刻を表すuntilとは違う。"
          }
        },
        {
          num: "(3)",
          text: "Wine is made (   ) grapes.",
          choices: "選択肢: from, of, by",
          vocab: [["wine", "ワイン"], ["grape", "ぶどう"], ["be made from", "～から作られる（原料）"]],
          hint: ["ワインはぶどうから作られるが、見た目でぶどうとわからない", "原料が変化する場合はfrom、見た目でわかる場合はof", "質が変化するかどうかがポイント"],
          answer: "from",
          translation: "ワインはぶどうから作られる。",
          explanation: "be made fromは原料が変化して元の形がわからなくなる場合に使います。ワインはぶどうの形がわからないのでfromを使います。",
          grammar: "made from = 原料（質が変化）/ made of = 材料（質が変化しない）",
          choiceExplanations: {
            "from": "○ 正解。ぶどうがワインに変化し、原形がわからないのでfromを使う。",
            "of": "× 「材料」を表すが、原形がわかる場合（木のテーブルなど）に使う。",
            "by": "× 「～によって」で動作主を表す。材料・原料には使わない。"
          }
        },
        {
          num: "(4)",
          text: "Your pizza will be delivered (   ) 30 minutes.",
          choices: "選択肢: in, after, within",
          vocab: [["deliver", "配達する"], ["in + 時間", "（今から）～後に"]],
          hint: ["「30分で配達される」という未来の表現", "未来を表す文で「～後に」を表す前置詞", "「in + 時間」は未来を表す文で使う"],
          answer: "in",
          translation: "お客様のピザは30分で配達されます。",
          explanation: "「in + 時間」は未来を表す文で「今から～後に」という意味になります。過去の文ではafterを使います。",
          grammar: "in + 時間 = （今から）～後に（未来の文で使用）",
          choiceExplanations: {
            "in": "○ 正解。未来を表す文で「～後に」を表す。",
            "after": "× 過去の文で「～後に」を表すが、未来の文ではinを使う。",
            "within": "× 「～以内に」で期限を表す。30分以内なら正しいが、文意と合わない。"
          }
        },
        {
          num: "(5)",
          text: "The train left five minutes (   ) schedule.",
          choices: "選択肢: behind, after, late",
          vocab: [["leave", "出発する"], ["schedule", "予定"], ["behind schedule", "予定より遅れて"]],
          hint: ["「予定より5分遅れて」という表現", "「behind schedule」という慣用句", "behindは「～より後ろに」という意味"],
          answer: "behind",
          translation: "電車は予定より5分遅れて出発した。",
          explanation: "behind scheduleは「予定より遅れて」という意味の慣用句です。ahead of scheduleは「予定より早く」となります。",
          grammar: "behind schedule = 予定より遅れて / ahead of schedule = 予定より早く",
          choiceExplanations: {
            "behind": "○ 正解。behind scheduleで「予定より遅れて」のイディオム。",
            "after": "× afterは時間の順序を表すが、schedule とは結びつかない。",
            "late": "× lateは形容詞・副詞で、前置詞として使えない。"
          }
        }
      ]
    },
    {
      title: "[2] 基本問題 2｜名詞 (1)～(5)",
      open: false,
      questions: [
        {
          num: "(1)",
          text: "There is some (   ) left in the glass.",
          choices: "選択肢: juice, juices, a juice",
          vocab: [["juice", "ジュース（不可算名詞）"], ["left", "残っている"]],
          hint: ["juiceは数えられない名詞（物質名詞）", "someの後に来る不可算名詞の形", "物質名詞は常に単数形で使う"],
          answer: "juice",
          translation: "グラスにジュースが残っている。",
          explanation: "juiceは物質名詞で数えられないため、常に単数形で使います。「a glass of juice」のように数える場合は容器で表現します。",
          grammar: "物質名詞 = 数えられない → 常に単数形",
          choiceExplanations: {
            "juice": "○ 正解。物質名詞は単数形で使う。",
            "juices": "× 物質名詞は複数形にしない（種類を表す場合を除く）。",
            "a juice": "× 物質名詞に不定冠詞aはつけない。"
          }
        },
        {
          num: "(2)",
          text: "The police (   ) investigating the accident.",
          choices: "選択肢: are, is, was",
          vocab: [["police", "警察（常に複数扱い）"], ["investigate", "調査する"], ["accident", "事故"]],
          hint: ["policeは集合名詞で常に複数扱い", "動詞は複数形に合わせる", "「警察官たち」を表す集合名詞"],
          answer: "are",
          translation: "警察はその事故を調査している。",
          explanation: "policeは常に複数扱いの集合名詞です。「警察官たち」という意味なので、動詞は複数形を使います。",
          grammar: "police = 常に複数扱い（the police are）",
          choiceExplanations: {
            "are": "○ 正解。policeは常に複数扱いなのでareを使う。",
            "is": "× policeは複数扱いなので単数形のisは使わない。",
            "was": "× 単数の過去形。policeには使えない。"
          }
        },
        {
          num: "(3)",
          text: "I gave them two pieces of (   ).",
          choices: "選択肢: advice, advices, an advice",
          vocab: [["advice", "助言（不可算名詞）"], ["a piece of advice", "助言1つ"]],
          hint: ["adviceは不可算名詞（抽象名詞）", "数える場合は「a piece of」を使う", "「two pieces of」の後は不可算名詞の単数形"],
          answer: "advice",
          translation: "私は彼らに2つ助言をした。",
          explanation: "adviceは不可算名詞なので、数える場合は「a piece of advice」のように表現します。pieces ofの後は単数形です。",
          grammar: "a piece of advice / information / news = 助言/情報/ニュース1つ",
          choiceExplanations: {
            "advice": "○ 正解。不可算名詞は単数形で使う。",
            "advices": "× adviceは不可算名詞なので複数形にしない。",
            "an advice": "× 不可算名詞に不定冠詞はつけない。"
          }
        },
        {
          num: "(4)",
          text: "The United States (   ) one of the largest countries in the world.",
          choices: "選択肢: is, are, were",
          vocab: [["the United States", "アメリカ合衆国"], ["one of the largest", "最も大きい～のひとつ"]],
          hint: ["国名は複数形でも単数扱い", "「アメリカ合衆国」は1つの国", "Statesは形は複数でも単数扱い"],
          answer: "is",
          translation: "アメリカ合衆国は世界で最も大きな国のひとつである。",
          explanation: "The United Statesは形は複数ですが、1つの国を表すので単数扱いです。同様に、The Philippines（フィリピン）なども単数扱いです。",
          grammar: "国名は複数形でも単数扱い（The United States is...）",
          choiceExplanations: {
            "is": "○ 正解。国名は複数形でも単数扱い。",
            "are": "× 形は複数だが、国名なので単数扱い。",
            "were": "× 過去形かつ複数形で、両方とも不適切。"
          }
        },
        {
          num: "(5)",
          text: "I bought some new (   ) for the living room.",
          choices: "選択肢: furniture, furnitures, a furniture",
          vocab: [["furniture", "家具（不可算名詞）"], ["living room", "居間"]],
          hint: ["furnitureは不可算名詞（集合名詞）", "家具全体をひとまとまりとして捉える", "someの後は不可算名詞の単数形"],
          answer: "furniture",
          translation: "私は居間用に新しい家具をいくつか買った。",
          explanation: "furnitureは不可算名詞で、家具全体をひとまとまりとして捉えます。数える場合は「a piece of furniture」を使います。",
          grammar: "furniture = 不可算名詞（a piece of furniture で数える）",
          choiceExplanations: {
            "furniture": "○ 正解。不可算名詞は単数形で使う。",
            "furnitures": "× furnitureは不可算名詞なので複数形にしない。",
            "a furniture": "× 不可算名詞に不定冠詞はつけない。"
          }
        }
      ]
    },
    {
      title: "[3] 基本問題 3｜冠詞 (1)～(5)",
      open: false,
      questions: [
        {
          num: "(1)",
          text: "There is (   ) old church in front of the station.",
          choices: "選択肢: an, a, the",
          vocab: [["church", "教会"], ["in front of", "～の前に"], ["station", "駅"]],
          hint: ["初めて話題に上る名詞には不定冠詞", "oldは母音で始まる", "母音で始まる語の前はan"],
          answer: "an",
          translation: "駅の正面に古い教会がある。",
          explanation: "初めて話題に上る単数の数えられる名詞には不定冠詞を使います。oldは母音で始まるのでanを使います。",
          grammar: "an + 母音で始まる語 / a + 子音で始まる語",
          choiceExplanations: {
            "an": "○ 正解。oldは母音で始まるのでanを使う。",
            "a": "× 母音で始まる語の前はaではなくanを使う。",
            "the": "× 初出の名詞に定冠詞は使わない。"
          }
        },
        {
          num: "(2)",
          text: "(   ) moon goes around (   ) earth.",
          choices: "選択肢: The, the / A, an / The, an",
          vocab: [["moon", "月"], ["earth", "地球"], ["go around", "周りを回る"]],
          hint: ["唯一のものにはtheをつける", "月も地球も宇宙に1つしかない", "天体には定冠詞theを使う"],
          answer: "The, the",
          translation: "月は地球の周りを回っている。",
          explanation: "sun, moon, earth, sky, worldなど、唯一のものには定冠詞theをつけます。",
          grammar: "the + 唯一のもの（the sun, the moon, the earth）",
          choiceExplanations: {
            "The, the": "○ 正解。唯一のものには定冠詞theを使う。",
            "A, an": "× 唯一のものに不定冠詞は使わない。",
            "The, an": "× earthも唯一なのでtheを使う。"
          }
        },
        {
          num: "(3)",
          text: "Let's play (   ) after (   ).",
          choices: "選択肢: baseball, lunch（無冠詞）/ a baseball, a lunch / the baseball, the lunch",
          vocab: [["play baseball", "野球をする"], ["after lunch", "昼食後に"]],
          hint: ["スポーツ名には冠詞をつけない", "食事名には冠詞をつけない", "play + 球技、have + 食事は無冠詞"],
          answer: "baseball, lunch（無冠詞）",
          translation: "昼食後に野球をしようよ。",
          explanation: "スポーツ・ゲーム名や食事名には冠詞をつけません。play baseball, have breakfastなど。",
          grammar: "play + スポーツ（無冠詞）/ have + 食事（無冠詞）",
          choiceExplanations: {
            "baseball, lunch（無冠詞）": "○ 正解。スポーツと食事は無冠詞。",
            "a baseball, a lunch": "× スポーツ名・食事名には不定冠詞をつけない。",
            "the baseball, the lunch": "× スポーツ名・食事名には定冠詞をつけない。"
          }
        },
        {
          num: "(4)",
          text: "Pencils are usually sold by (   ) dozen.",
          choices: "選択肢: the, a, （無冠詞）",
          vocab: [["sell", "売る"], ["by the dozen", "1ダース単位で"], ["dozen", "ダース（12個）"]],
          hint: ["「～単位で」という表現", "by the + 単位名詞", "計量の単位にはtheをつける"],
          answer: "the",
          translation: "鉛筆は普通1ダース単位で売られている。",
          explanation: "「by the + 単位名詞」で「～単位で」という意味を表します。by the hour（1時間単位で）、by the pound（1ポンド単位で）なども同様です。",
          grammar: "by the + 単位 = ～単位で",
          choiceExplanations: {
            "the": "○ 正解。by the + 単位で「～単位で」を表す。",
            "a": "× a dozenは「12個」という数を表すだけ。単位の意味にならない。",
            "（無冠詞）": "× by dozenという表現は使わない。"
          }
        },
        {
          num: "(5)",
          text: "(   ) rich are not always happy.",
          choices: "選択肢: The, A, （無冠詞）",
          vocab: [["the rich", "金持ちの人々"], ["not always", "必ずしも～ない"]],
          hint: ["「the + 形容詞」で「～の人々」", "richは形容詞だが「金持ちの人々」を表す", "定冠詞theをつけると複数の人々を表す"],
          answer: "The",
          translation: "金持ちの人々が必ずしも幸せとは限らない。",
          explanation: "「the + 形容詞」で「～の人々」という意味になります。the young（若者たち）、the elderly（高齢者たち）なども同様です。",
          grammar: "the + 形容詞 = ～の人々（複数扱い）",
          choiceExplanations: {
            "The": "○ 正解。the + 形容詞で「～の人々」を表す。",
            "A": "× 形容詞だけでは名詞として使えない。",
            "（無冠詞）": "× 「～の人々」を表すにはtheが必要。"
          }
        }
      ]
    },
    {
      title: "[4] 基本問題 4｜代名詞 (1)～(5)",
      open: false,
      questions: [
        {
          num: "(1)",
          text: "An old friend of (   ) came to stay.",
          choices: "選択肢: mine, my, me",
          vocab: [["an old friend of mine", "昔からの友人の1人"], ["come to stay", "泊まりに来る"]],
          hint: ["「a/an + 名詞 + of + 所有代名詞」の形", "myとa/anは並べて使えない", "所有格の代わりに所有代名詞を使う"],
          answer: "mine",
          translation: "昔からの友人の1人が泊まりに来た。",
          explanation: "a/an, the, this, someなどと所有格は並べて使えないので、「a friend of mine」のように所有代名詞を使います。",
          grammar: "a/an + 名詞 + of + 所有代名詞（a friend of mine）",
          choiceExplanations: {
            "mine": "○ 正解。所有代名詞でa/anと所有の意味を両立させる。",
            "my": "× a/anと所有格myは並べて使えない（× a my friend）。",
            "me": "× meは目的格で、所有の意味を表せない。"
          }
        },
        {
          num: "(2)",
          text: "He is not used to traveling by (   ).",
          choices: "選択肢: himself, him, his",
          vocab: [["be used to", "～に慣れている"], ["by oneself", "ひとりで"]],
          hint: ["「ひとりで」を表す表現", "by oneself = alone", "再帰代名詞を使う"],
          answer: "himself",
          translation: "彼は一人旅には慣れていない。",
          explanation: "by oneselfは「ひとりで」という意味で、aloneと同じ意味です。主語がheなのでhimselfを使います。",
          grammar: "by oneself = alone（ひとりで）",
          choiceExplanations: {
            "himself": "○ 正解。by oneselfで「ひとりで」を表す。",
            "him": "× by himという表現はない。",
            "his": "× by hisという表現はない。"
          }
        },
        {
          num: "(3)",
          text: "Please show me (   ).",
          choices: "選択肢: another, other, the other",
          vocab: [["show", "見せる"], ["another", "別の1つ（不特定）"], ["the other", "残りの1つ（特定）"]],
          hint: ["「別のを見せてください」という不特定の依頼", "anotherは「不特定の別の1つ」", "特定のものを指すならthe other"],
          answer: "another",
          translation: "別のを見せてください。",
          explanation: "anotherは「不特定の別の1つ」を表します。複数あるうちの「どれでもいいから別の1つ」という意味です。",
          grammar: "another = 不特定の別の1つ / the other = 残りの1つ（特定）",
          choiceExplanations: {
            "another": "○ 正解。不特定の別の1つを表す。",
            "other": "× otherだけでは代名詞として使えない（others か the other）。",
            "the other": "× 2つしかないうちの「もう1つ」を表す。不特定の依頼には不適切。"
          }
        },
        {
          num: "(4)",
          text: "(   ) of us was asked our name.",
          choices: "選択肢: Each, Both, All",
          vocab: [["each", "それぞれ（単数扱い）"], ["both", "両方（複数扱い）"], ["ask", "尋ねる"]],
          hint: ["動詞がwasなので単数扱いの主語", "「1人1人」という個別の意味", "eachは単数扱い、bothは複数扱い"],
          answer: "Each",
          translation: "私たちは1人1人名前を尋ねられた。",
          explanation: "eachは「それぞれ」という意味で単数扱いです。bothは「両方」で複数扱いなので、動詞はwereになります。",
          grammar: "each = 単数扱い / both = 複数扱い",
          choiceExplanations: {
            "Each": "○ 正解。eachは単数扱いなのでwasと合う。",
            "Both": "× bothは複数扱いなのでwereを使う。wasとは合わない。",
            "All": "× allは複数扱いなのでwereを使う。wasとは合わない。"
          }
        },
        {
          num: "(5)",
          text: "I have two dogs. One is black, and (   ) is white.",
          choices: "選択肢: the other, another, other",
          vocab: [["one ... the other", "（2つのうち）1つは...もう1つは"]],
          hint: ["2匹の犬のうち「もう1匹」", "2つのうちの残りの1つはthe other", "one ... the otherの構文"],
          answer: "the other",
          translation: "私は犬を2匹飼っている。1匹は黒で、もう1匹は白だ。",
          explanation: "2つのものについて「1つは...もう1つは」と言う場合、「one ... the other」を使います。",
          grammar: "one ... the other = （2つのうち）1つは...もう1つは",
          choiceExplanations: {
            "the other": "○ 正解。2つのうちの残りの1つを表す。",
            "another": "× anotherは3つ以上あるうちの「別の1つ」。2つには使わない。",
            "other": "× otherだけでは代名詞として使えない。"
          }
        }
      ]
    },
    {
      title: "[5] 基本問題 5｜並べかえ (1)～(3)",
      open: false,
      questions: [
        {
          num: "(1)",
          text: "誰がその情報を漏らしたか知りたい。",
          scramble: "I want to know [ the information, who, leaked ].",
          vocab: [["leak", "漏らす"], ["information", "情報（不可算名詞）"]],
          hint: ["「誰が～したか」という間接疑問文", "語順：疑問詞 + 主語 + 動詞", "whoが主語になる場合は語順は変わらない"],
          answer: "who leaked the information",
          explanation: "間接疑問文で疑問詞が主語になる場合、語順は「疑問詞 + 動詞」のままです。",
          grammar: "間接疑問文（疑問詞が主語）= 疑問詞 + 動詞 + 目的語"
        },
        {
          num: "(2)",
          text: "彼女の弟は私の弟より3歳年下です。",
          scramble: "Her brother [ than, three years, is, younger, mine ].",
          vocab: [["younger", "より若い"], ["three years younger", "3歳年下"]],
          hint: ["「～より○歳年下」という表現", "数詞 + 比較級 + than", "mineは所有代名詞で「my brother」を表す"],
          answer: "is three years younger than mine",
          explanation: "「数詞 + 比較級」で「○だけより～」を表します。mineはmy brotherの代わりです。",
          grammar: "数詞 + 比較級 + than = ～より○だけ..."
        },
        {
          num: "(3)",
          text: "その問題は、私が最初に考えていたよりはるかに難しかった。",
          scramble: "The problem was [ than, more, I, much, difficult, had expected ].",
          vocab: [["much more", "はるかに"], ["at first", "最初に"], ["expect", "予想する"]],
          hint: ["「はるかに～」という比較の強調", "much + 比較級", "過去完了形で「最初に考えていた」を表す"],
          answer: "much more difficult than I had expected",
          explanation: "比較級を強調するにはmuchを使います。「much + 比較級」で「はるかに～」という意味になります。",
          grammar: "much + 比較級 = はるかに～"
        }
      ]
    },
    {
      title: "[6] FOR COMMUNICATION (1)～(3)",
      open: false,
      questions: [
        {
          num: "(1)",
          text: "A: What's the matter?<br>B: I cut (   ) while cooking.",
          choices: "a. me　b. my　c. mine　d. myself",
          vocab: [["cut oneself", "自分を切る（けがをする）"], ["while cooking", "料理中に"]],
          hint: ["「自分自身を」切ったという意味", "主語と目的語が同じ場合は再帰代名詞", "myselfは再帰代名詞"],
          answer: "d. myself",
          translation: "A「どうしたの？」B「料理中に（手を）切っちゃったんだ」",
          explanation: "主語と目的語が同一人物の場合、目的語には再帰代名詞を使います。cut myselfで「自分（の指など）を切る」という意味です。",
          grammar: "cut oneself = 自分を切る（けがをする）",
          choiceExplanations: {
            "d. myself": "○ 正解。主語と目的語が同じなので再帰代名詞を使う。",
            "a. me": "× meは目的格だが、主語と同一人物なので再帰代名詞を使う。",
            "b. my": "× 所有格は目的語にならない。",
            "c. mine": "× 所有代名詞は目的語にならない。"
          }
        },
        {
          num: "(2)",
          text: "A: Which is your umbrella?<br>B: (   ) is mine. The blue one.",
          choices: "a. That　b. Those　c. It　d. They",
          vocab: [["umbrella", "傘"], ["the blue one", "青いやつ"]],
          hint: ["傘は単数形なので単数形の代名詞", "離れた場所にあるものを指すときはthat", "itは既出のものを指す"],
          answer: "a. That",
          translation: "A「どれが君の傘？」B「あれが私のだよ。青いやつ。」",
          explanation: "離れた場所にあるものを指すときはthatを使います。itは既出のものを指すので、初めて指す場合は不適切です。",
          grammar: "that = 離れたものを指す / it = 既出のものを指す",
          choiceExplanations: {
            "a. That": "○ 正解。離れた場所の傘を指している。",
            "b. Those": "× 傘は単数なので複数形は不適切。",
            "c. It": "× まだ話題に出ていない傘を初めて指すのでitは不適切。",
            "d. They": "× 傘は単数なので複数形は不適切。"
          }
        },
        {
          num: "(3)",
          text: "A: I heard you bought a new car.<br>B: Yes, but I don't like (   ) color.",
          choices: "a. it's　b. its　c. it　d. their",
          vocab: [["I heard", "～と聞いた"], ["buy", "買う"]],
          hint: ["「その車の色」という所有の意味", "carは単数なので単数形の所有格", "itsはitの所有格"],
          answer: "b. its",
          translation: "A「新しい車を買ったんだって？」B「うん、でも色が気に入らないんだ」",
          explanation: "「その車の色」という意味なので、itの所有格itsを使います。it'sは「it is」の短縮形です。",
          grammar: "its = itの所有格 / it's = it is の短縮形",
          choiceExplanations: {
            "b. its": "○ 正解。「その（車の）色」という所有を表す。",
            "a. it's": "× it'sはit isの短縮形で、所有格ではない。",
            "c. it": "× itは主格または目的格で、所有の意味はない。",
            "d. their": "× theirは複数形の所有格。車は1台なので不適切。"
          }
        }
      ]
    },
    {
      title: "[発展1] 語句選択 (1)～(5)",
      open: false,
      questions: [
        {
          num: "(1)",
          text: "We have (   ) rain this year than usual.【センター試験】",
          choices: "a. less　b. fewer　c. little　d. small",
          vocab: [["rain", "雨（不可算名詞）"], ["than usual", "例年より"], ["less", "より少ない（不可算名詞用）"]],
          hint: ["rainは不可算名詞", "不可算名詞の比較級には「less」を使う", "fewerは可算名詞に使う"],
          answer: "a. less",
          translation: "今年は例年より雨が少ない。",
          explanation: "rainは不可算名詞なので、比較級にはlessを使います。fewerは可算名詞に使います。",
          grammar: "less + 不可算名詞 / fewer + 可算名詞（複数形）",
          choiceExplanations: {
            "a. less": "○ 正解。不可算名詞rainの比較級にはlessを使う。",
            "b. fewer": "× fewerは可算名詞に使う。rainは不可算名詞。",
            "c. little": "× littleは原級。比較を表すにはlessを使う。",
            "d. small": "× smallは大きさを表す形容詞で、量には使わない。"
          }
        },
        {
          num: "(2)",
          text: "The news (   ) surprising to everyone.【関西大】",
          choices: "a. was　b. were　c. have been　d. are",
          vocab: [["news", "ニュース（単数扱い）"], ["surprising", "驚くべき"]],
          hint: ["newsは形は複数でも単数扱い", "「-s」で終わるが不可算名詞", "動詞は単数形を使う"],
          answer: "a. was",
          translation: "そのニュースは誰にとっても驚きだった。",
          explanation: "newsは形は複数（-s）ですが、不可算名詞で常に単数扱いです。同様に、mathematics, physicsなども単数扱いです。",
          grammar: "news = 常に単数扱い（The news is/was...）",
          choiceExplanations: {
            "a. was": "○ 正解。newsは単数扱いなのでwasを使う。",
            "b. were": "× newsは単数扱いなのでwereは使わない。",
            "c. have been": "× newsは単数扱いなのでhave beenは使わない。",
            "d. are": "× newsは単数扱いなのでareは使わない。"
          }
        },
        {
          num: "(3)",
          text: "I have never seen (   ) a beautiful sunset.【明治大】",
          choices: "a. so　b. such　c. very　d. too",
          vocab: [["sunset", "夕焼け"], ["such a + 形容詞 + 名詞", "とても～な..."]],
          hint: ["「とても美しい夕焼け」という感嘆の意味", "名詞（sunset）がある場合はsuchを使う", "so + 形容詞 vs such + 名詞"],
          answer: "b. such",
          translation: "こんなに美しい夕焼けを見たことがない。",
          explanation: "名詞がある場合は「such a + 形容詞 + 名詞」を使います。「so + 形容詞」は名詞がない場合に使います。",
          grammar: "such a + 形容詞 + 名詞 / so + 形容詞（名詞なし）",
          choiceExplanations: {
            "b. such": "○ 正解。名詞（sunset）があるのでsuchを使う。",
            "a. so": "× soは「so + 形容詞」の形で、名詞がある場合は使えない。",
            "c. very": "× veryは比較の文脈では不適切。",
            "d. too": "× tooは「～すぎる」で否定的な意味になる。"
          }
        },
        {
          num: "(4)",
          text: "(   ) student in this class has their own locker.【同志社大】",
          choices: "a. Each　b. All　c. Every　d. Some",
          vocab: [["locker", "ロッカー"], ["their own", "それぞれの"], ["each", "各々の（単数扱い）"]],
          hint: ["「各生徒が」という意味", "単数名詞（student）が続く", "each/everyは単数扱い"],
          answer: "a. Each",
          translation: "このクラスの各生徒がそれぞれロッカーを持っている。",
          explanation: "eachとeveryはどちらも単数扱いですが、eachは「個々の」を強調し、everyは「全体」を強調します。theirと共に使うのはeachが自然です。",
          grammar: "each + 単数名詞 = 各々の～（個々を強調）",
          choiceExplanations: {
            "a. Each": "○ 正解。「各々の生徒」という意味で個々を強調。",
            "b. All": "× allの後は複数名詞（all students）。",
            "c. Every": "× everyも可能だが、theirと組み合わせるとeachが自然。",
            "d. Some": "× 「何人かの」で意味が違う。"
          }
        },
        {
          num: "(5)",
          text: "There is (   ) water left in the bottle.【青山学院大】",
          choices: "a. few　b. a few　c. little　d. a little",
          vocab: [["water", "水（不可算名詞）"], ["left", "残っている"], ["a little", "少しの（肯定的）"]],
          hint: ["waterは不可算名詞", "「少し残っている」という肯定的な意味", "little vs a little の違い"],
          answer: "d. a little",
          translation: "ボトルには水が少し残っている。",
          explanation: "waterは不可算名詞なのでlittle/a littleを使います。a littleは「少しはある」という肯定的な意味、littleは「ほとんどない」という否定的な意味です。",
          grammar: "a little = 少しはある（肯定的）/ little = ほとんどない（否定的）",
          choiceExplanations: {
            "d. a little": "○ 正解。「少しある」という肯定的な意味。",
            "c. little": "× 「ほとんどない」という否定的な意味になる。",
            "a. few": "× fewは可算名詞に使う。waterは不可算名詞。",
            "b. a few": "× a fewも可算名詞に使う。waterは不可算名詞。"
          }
        }
      ]
    },
    {
      title: "[発展2] 誤り訂正 (1)～(3)",
      open: false,
      questions: [
        {
          num: "(1)",
          text: "The <u>a. number</u> of students <u>b. who</u> study abroad <u>c. are</u> <u>d. increasing</u>.【中央大】",
          vocab: [["the number of", "～の数"], ["study abroad", "留学する"], ["increase", "増加する"]],
          hint: ["「the number of + 複数名詞」は単数扱い", "「a number of」なら複数扱い", "動詞を単数形に直す"],
          answer: "c. are → is",
          translation: "海外で学ぶ学生の数は増えている。",
          explanation: "「the number of + 複数名詞」は「～の数」という意味で単数扱いです。「a number of」は「多くの」で複数扱いです。",
          grammar: "the number of + 複数名詞 = 単数扱い / a number of + 複数名詞 = 複数扱い"
        },
        {
          num: "(2)",
          text: "I bought <u>a. two</u> <u>b. breads</u> and <u>c. some</u> <u>d. butter</u> at the store.【日本大】",
          vocab: [["bread", "パン（不可算名詞）"], ["butter", "バター（不可算名詞）"]],
          hint: ["breadは不可算名詞で複数形にできない", "数える場合は「loaves of bread」を使う", "butterは正しく使われている"],
          answer: "b. breads → loaves of bread または pieces of bread",
          translation: "私は店でパンを2つとバターを買った。",
          explanation: "breadは不可算名詞なので複数形にできません。数える場合は「a loaf of bread」「two loaves of bread」のように表現します。",
          grammar: "bread = 不可算名詞（a loaf of bread で数える）"
        },
        {
          num: "(3)",
          text: "Can you give me <u>a. an</u> <u>b. information</u> about <u>c. the</u> <u>d. hotel</u>?【立教大】",
          vocab: [["information", "情報（不可算名詞）"], ["hotel", "ホテル"]],
          hint: ["informationは不可算名詞", "不可算名詞に不定冠詞anはつけない", "「some information」または「a piece of information」が正しい"],
          answer: "a. an → some または a piece of",
          translation: "そのホテルについての情報をいただけますか？",
          explanation: "informationは不可算名詞なので不定冠詞をつけられません。「some information」または「a piece of information」を使います。",
          grammar: "information = 不可算名詞（some/a piece of information）"
        }
      ]
    },
    {
      title: "[発展3] 英作文 (1)～(2)",
      open: false,
      questions: [
        {
          num: "(1)",
          text: "もう少し勇気があったら，彼女に話しかけていただろうに。【早稲田大】",
          vocab: [["a little more", "もう少しの"], ["courage", "勇気"], ["speak to", "話しかける"]],
          hint: ["仮定法過去完了の文", "「もう少し～があったら」という過去の仮定", "A little more + 名詞 + and ...の構文も可能"],
          answer: "If I had had a little more courage, I would have spoken to her. / With a little more courage, I would have spoken to her.",
          explanation: "過去の事実に反する仮定は仮定法過去完了を使います。「If + had + 過去分詞, would + have + 過去分詞」の形になります。",
          grammar: "仮定法過去完了 = If + had + 過去分詞, would + have + 過去分詞"
        },
        {
          num: "(2)",
          text: "誰かドアを開けっぱなしにしたのは誰だ。【慶應大】",
          vocab: [["leave ... open", "～を開けっぱなしにする"], ["Who is it that", "～なのは誰だ（強調構文）"]],
          hint: ["「誰が」を強調する構文", "強調構文「It is ... that」を疑問文に", "過去のことなので動詞は過去形"],
          answer: "Who is it that left the door open? / Who left the door open?",
          explanation: "「誰が～したのか」を強調する場合、「Who is it that + 過去形の動詞」という強調構文を使えます。単純に「Who left ...?」でも可能です。",
          grammar: "Who is it that + 動詞 ～? = ～したのは誰だ？（強調構文）"
        }
      ]
    }
  ]
};

// ===== NAVIGATION STATE =====
const NavState = {
  view: 'home',        // 'home' | 'overview' | 'question'
  category: 'basic',   // 'basic' | 'comm' | 'advanced'
  section: 0,          // 0-8 section index
  categoryMap: {
    basic: [0, 1, 2, 3, 4],    // 5 sections: 前置詞、名詞、冠詞、代名詞、並べかえ
    comm: [5],                  // 1 section
    advanced: [6, 7, 8]         // 3 sections
  }
};

// Category display info
const categoryInfo = {
  basic: { name: '基本問題', icon: '&#128218;', class: 'basic' },
  comm: { name: 'For Communication', icon: '&#128172;', class: 'comm' },
  advanced: { name: '発展問題', icon: '&#128640;', class: 'advanced' }
};

// ===== ROUTER =====
const Router = {
  navigate(view, category = null, section = null) {
    NavState.view = view;

    if (view === 'question') {
      if (category) NavState.category = category;
      if (section !== null) {
        NavState.section = section;
      } else {
        NavState.section = NavState.categoryMap[NavState.category][0];
      }
    }

    this.updateHash();
    this.render();
  },

  setCategory(category) {
    NavState.category = category;
    NavState.section = NavState.categoryMap[category][0];
    this.updateHash();
    this.render();
  },

  setSection(section) {
    NavState.section = section;
    this.updateHash();
    this.render();
  },

  updateHash() {
    let hash = '#' + NavState.view;
    if (NavState.view === 'question') {
      const localIndex = NavState.categoryMap[NavState.category].indexOf(NavState.section);
      hash += '/' + NavState.category + '/' + (localIndex + 1);
    }
    history.pushState(null, '', hash);
  },

  parseHash() {
    const hash = window.location.hash.slice(1) || 'home';
    const parts = hash.split('/');

    NavState.view = parts[0] || 'home';

    if (NavState.view === 'question' && parts.length >= 3) {
      NavState.category = parts[1] || 'basic';
      const localIndex = parseInt(parts[2], 10) - 1 || 0;
      const sections = NavState.categoryMap[NavState.category] || [0];
      NavState.section = sections[Math.min(localIndex, sections.length - 1)] || 0;
    }
  },

  render() {
    document.querySelectorAll('.top-nav-link').forEach(link => {
      link.classList.toggle('active', link.dataset.nav === NavState.view);
    });
    document.querySelectorAll('.mobile-nav-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.nav === NavState.view);
    });

    document.querySelectorAll('.view-home, .view-overview, .view-question').forEach(view => {
      view.classList.remove('active');
    });

    const mainContent = document.getElementById('mainContent');
    const subNav = document.getElementById('subNav');

    if (NavState.view === 'home') {
      document.getElementById('viewHome').classList.add('active');
      subNav.classList.remove('visible');
      mainContent.classList.remove('has-subnav');
    } else if (NavState.view === 'overview') {
      document.getElementById('viewOverview').classList.add('active');
      subNav.classList.remove('visible');
      mainContent.classList.remove('has-subnav');
      setTimeout(initTypeCardTilt, 100);
    } else if (NavState.view === 'question') {
      document.getElementById('viewQuestion').classList.add('active');
      if (navVisible) {
        subNav.classList.add('visible');
      }
      mainContent.classList.add('has-subnav');
      this.renderQuestionView();
    }

    invalidateCaches();
  },

  renderQuestionView() {
    document.querySelectorAll('.sub-nav-cat').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.cat === NavState.category);
    });

    const sections = NavState.categoryMap[NavState.category];
    const togglesContainer = document.getElementById('sectionToggles');
    togglesContainer.innerHTML = sections.map((sectionIndex, i) => {
      const isActive = NavState.section === sectionIndex;
      return `<button class="sub-nav-section ${isActive ? 'active' : ''}"
                      onclick="Router.setSection(${sectionIndex})">${i + 1}</button>`;
    }).join('');

    const info = categoryInfo[NavState.category];
    const badge = document.getElementById('categoryBadge');
    badge.className = 'question-category-badge ' + info.class;
    document.getElementById('categoryIcon').innerHTML = info.icon;
    document.getElementById('categoryName').textContent = info.name;

    const sectionData = grammarData.sections[NavState.section];
    document.getElementById('sectionTitle').textContent = sectionData.title;
    document.getElementById('sectionSubtitle').textContent =
      sectionData.questions.length + ' questions';

    renderQuestions(NavState.section);
    initCardReveal();

    const searchInput = document.getElementById('searchInput');
    if (searchInput) searchInput.value = '';

    updateProgress();
  }
};

// ===== RENDER FUNCTIONS =====
function renderQuestion(q) {
  let questionHtml = `<div class="qcard-question">
    <span class="qnum">${q.num}</span>
    <div class="qtext">${q.text}</div>`;
  if (q.choices) questionHtml += `<div class="choices">${q.choices}</div>`;
  if (q.scramble) questionHtml += `<div class="scramble">${q.scramble}</div>`;
  questionHtml += `</div>`;

  let btnHtml = `<div class="qcard-buttons">
    <button class="toggle-btn vocab" onclick="toggle(this,'vocab')">Words</button>`;
  if (q.hint) btnHtml += `<button class="toggle-btn hint" onclick="toggle(this,'hint')">Hint</button>`;
  btnHtml += `<button class="toggle-btn answer" onclick="toggle(this,'answer')">Answer</button></div>`;

  let leftHtml = `<div class="qcard-left">
    <div class="toggle-btn-row">
      <button class="toggle-btn vocab" onclick="toggle(this,'vocab')">Words</button>`;
  if (q.hint) leftHtml += `<button class="toggle-btn hint" onclick="toggle(this,'hint')">Hint</button>`;
  leftHtml += `</div>`;
  if (q.vocab) {
    leftHtml += `<div class="collapsible" data-type="vocab"><div class="box vocab-box">`;
    q.vocab.forEach(v => leftHtml += `<div class="vocab-item"><span class="vocab-word">${v[0]}</span>${v[1]}</div>`);
    leftHtml += `</div></div>`;
  }
  if (q.hint) {
    leftHtml += `<div class="collapsible" data-type="hint"><div class="box hint-box"><span class="box-label">Solution</span>`;
    q.hint.forEach(h => leftHtml += `<div class="hint-item">&#8594; ${h}</div>`);
    leftHtml += `</div></div>`;
  }
  leftHtml += `</div>`;

  let rightHtml = `<div class="qcard-right">
    <div class="toggle-btn-row">
      <button class="toggle-btn answer" onclick="toggle(this,'answer')">Answer</button>
    </div>
    <div class="collapsible" data-type="answer"><div class="box ans-box">
      <span class="box-label">正解: ${q.answer}</span>`;
  if (q.translation) rightHtml += `<div class="jp-text">${q.translation}</div>`;
  if (q.explanation) rightHtml += `<div class="jp-text">${q.explanation}</div>`;
  if (q.choiceExplanations) {
    rightHtml += `<div class="choice-explanations">`;
    for (const [choice, exp] of Object.entries(q.choiceExplanations)) {
      const isCorrect = q.answer.includes(choice);
      rightHtml += `<div class="choice-exp ${isCorrect ? 'correct' : 'wrong'}">${exp}</div>`;
    }
    rightHtml += `</div>`;
  }
  if (q.grammar) rightHtml += `<div class="grammar-ref">${q.grammar}</div>`;
  rightHtml += `</div></div></div>`;

  return `<div class="qcard">${questionHtml}${btnHtml}${leftHtml}${rightHtml}</div>`;
}

function renderQuestions(sectionIndex) {
  const section = grammarData.sections[sectionIndex];
  const container = document.getElementById('questionsList');
  container.innerHTML = section.questions.map(q => renderQuestion(q)).join('');
}

// ===== CARD REVEAL ANIMATION =====
let revealObserver = null;

function initCardReveal() {
  if (revealObserver) {
    revealObserver.disconnect();
  }

  if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
    document.querySelectorAll('.qcard').forEach(card => {
      card.classList.add('visible');
    });
    return;
  }

  const observerOptions = {
    root: null,
    rootMargin: '50px',
    threshold: 0.1
  };

  revealObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
        revealObserver.unobserve(entry.target);
      }
    });
  }, observerOptions);

  document.querySelectorAll('.qcard').forEach(card => {
    revealObserver.observe(card);
  });
}

// ===== EVENT HANDLERS =====
function toggle(btn, type) {
  const card = btn.closest('.qcard');
  const block = card.querySelector(`.collapsible[data-type="${type}"]`);
  if (block) {
    block.classList.toggle('open');
    updateProgress();
  }
}

function setView(view) {
  document.body.setAttribute('data-view', view);
  try { localStorage.setItem('viewMode', view); } catch(e) {}
  document.querySelectorAll('.view-btn-nav').forEach(btn => {
    btn.classList.toggle('active', btn.getAttribute('data-view') === view);
  });
}

// ===== PROGRESS =====
let progressBarEl = null;
let progressTextEl = null;

function updateProgress() {
  if (!progressBarEl) progressBarEl = document.getElementById('progressBar');
  if (!progressTextEl) progressTextEl = document.getElementById('progressText');

  const total = document.querySelectorAll('.collapsible[data-type="answer"]').length;
  const revealed = document.querySelectorAll('.collapsible[data-type="answer"].open').length;
  const pct = total > 0 ? Math.round((revealed / total) * 100) : 0;

  if (progressBarEl) progressBarEl.style.width = pct + '%';
  if (progressTextEl) progressTextEl.textContent = `${revealed} / ${total} answers revealed`;
}

// ===== SEARCH =====
let searchTimeout = null;
let searchIndex = null;

function invalidateCaches() {
  searchIndex = null;
  progressBarEl = null;
  progressTextEl = null;
}

function buildSearchIndex() {
  const section = grammarData.sections[NavState.section];
  searchIndex = section.questions.map((q, qi) => ({
    questionIndex: qi,
    searchText: [
      q.text || '',
      q.choices || '',
      q.scramble || '',
      q.answer || '',
      q.translation || '',
      q.grammar || '',
      (q.vocab || []).flat().join(' '),
      (q.hint || []).join(' ')
    ].join(' ').toLowerCase()
  }));
}

function debouncedSearch() {
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(handleSearch, 150);
}

function handleSearch() {
  const searchInput = document.getElementById('searchInput');
  if (!searchIndex) buildSearchIndex();

  const query = searchInput.value.toLowerCase().trim();
  const cards = document.querySelectorAll('.qcard');

  if (!query) {
    cards.forEach(card => card.classList.remove('no-match'));
    return;
  }

  searchIndex.forEach((q, qi) => {
    const card = cards[qi];
    if (!card) return;
    card.classList.toggle('no-match', !q.searchText.includes(query));
  });
}

// ===== THEME =====
function toggleTheme() {
  const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
  document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
  try { localStorage.setItem('theme', isDark ? 'light' : 'dark'); } catch(e) {}
  document.querySelector('.theme-icon').innerHTML = isDark ? '&#9728;&#65039;' : '&#127769;';
}

// ===== TILT EFFECT FOR OVERVIEW CARDS =====
function initTypeCardTilt() {
  const cards = document.querySelectorAll('.conj-card');
  if (!cards.length) return;

  cards.forEach(card => {
    let rafId = null;
    let targetX = 0, targetY = 0;
    let currentX = 0, currentY = 0;

    card.addEventListener('mouseenter', () => {
      card.style.transition = 'box-shadow 0.3s ease';
    });

    card.addEventListener('mousemove', (e) => {
      const rect = card.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      targetX = (y - centerY) / 80;
      targetY = (centerX - x) / 80;

      if (!rafId) {
        rafId = requestAnimationFrame(() => {
          currentX += (targetX - currentX) * 0.15;
          currentY += (targetY - currentY) * 0.15;
          card.style.transform = `perspective(1000px) rotateX(${currentX}deg) rotateY(${currentY}deg) translateY(-3px)`;
          card.style.boxShadow = 'var(--shadow-lg)';
          rafId = null;
        });
      }
    });

    card.addEventListener('mouseleave', () => {
      if (rafId) cancelAnimationFrame(rafId);
      rafId = null;
      card.style.transition = 'transform 0.4s cubic-bezier(0.23, 1, 0.32, 1), box-shadow 0.3s ease';
      card.style.transform = '';
      card.style.boxShadow = '';
      currentX = 0;
      currentY = 0;
      targetX = 0;
      targetY = 0;
    });
  });
}

// ===== AUTO-HIDE NAVIGATION =====
let navVisible = true;
let hideTimeout = null;
let hasScrolled = false;

function showNav() {
  clearTimeout(hideTimeout);
  navVisible = true;
  document.querySelector('.top-nav').classList.add('visible');
  if (NavState.view === 'question') {
    document.getElementById('subNav').classList.add('visible');
  }
}

function hideNav() {
  hideTimeout = setTimeout(() => {
    navVisible = false;
    document.querySelector('.top-nav').classList.remove('visible');
    document.getElementById('subNav').classList.remove('visible');
  }, 300);
}

function initAutoHideNav() {
  const topNav = document.querySelector('.top-nav');
  const subNav = document.getElementById('subNav');

  showNav();

  window.addEventListener('scroll', () => {
    if (!hasScrolled && window.scrollY > 50) {
      hasScrolled = true;
      hideNav();
    }
  }, { passive: true });

  document.addEventListener('mousemove', (e) => {
    if (!hasScrolled) return;
    if (e.clientY < 80) {
      showNav();
    } else if (e.clientY > 200 && navVisible) {
      hideNav();
    }
  });

  topNav.addEventListener('mouseenter', () => clearTimeout(hideTimeout));
  subNav.addEventListener('mouseenter', () => clearTimeout(hideTimeout));
  topNav.addEventListener('mouseleave', () => {
    if (hasScrolled) hideNav();
  });
  subNav.addEventListener('mouseleave', () => {
    if (hasScrolled) hideNav();
  });

  document.addEventListener('touchstart', (e) => {
    const touch = e.touches[0];
    if (touch.clientY < 100) {
      if (navVisible && hasScrolled) {
        hideNav();
      } else {
        showNav();
      }
    } else if (touch.clientY > 200 && navVisible && hasScrolled) {
      hideNav();
    }
  }, { passive: true });
}

// ===== INIT =====
window.addEventListener('DOMContentLoaded', () => {
  try {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
      document.documentElement.setAttribute('data-theme', 'dark');
      document.querySelector('.theme-icon').innerHTML = '&#127769;';
    }
    const savedView = localStorage.getItem('viewMode') || 'single';
    setView(savedView);
  } catch(e) {}

  Router.parseHash();
  Router.render();

  initAutoHideNav();
});

window.addEventListener('popstate', () => {
  Router.parseHash();
  Router.render();
});
</script>
</body>
</html>
