<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#007aff">
  <link rel="manifest" href="../../../manifest.json">
  <title>17 å½¢å®¹è©ãƒ»å‰¯è©ãƒ»ç¾¤å‹•è© | Adjectives, Adverbs & Phrasal Verbs</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600&family=Noto+Serif+JP:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="dualscope-lesson.css">
  <style>
    :root {
      --bg: #F5F0E6;
      --bg-warm: #EDE8DE;
      --card: #FFFFFF;
      --text: #1C1917;
      --text-secondary: #57534E;
      --text-muted: #7A7672;
      --accent: #e8725c;
      --border: rgba(28, 25, 23, 0.08);
      --border-visible: rgba(28, 25, 23, 0.12);
      --shadow-sm: 0 1px 2px rgba(61, 67, 64, 0.05),
                   0 4px 12px rgba(61, 67, 64, 0.08),
                   inset 0 1px 0 rgba(255, 255, 255, 0.5);
      --shadow: 0 2px 4px rgba(61, 67, 64, 0.06),
                0 8px 24px rgba(61, 67, 64, 0.12),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
      --shadow-lg: 0 4px 8px rgba(61, 67, 64, 0.06),
                   0 16px 48px rgba(61, 67, 64, 0.15),
                   inset 0 2px 0 rgba(255, 255, 255, 0.7);
      --radius: 20px;
      --radius-sm: 12px;
      --fs-qtext: clamp(17px, 1.3vw, 19px);
      --fs-base: clamp(15px, 1.1vw, 17px);
      --cat-basic: #5A8F65;
      --cat-basic-light: #EDF5EF;
      --cat-comm: #C28A2E;
      --cat-comm-light: #FBF6ED;
      --cat-advanced: #7E5A9E;
      --cat-advanced-light: #F5F0F8;
      /* Grammar type colors - CORAL/BLUE/GREEN/PURPLE for Lesson 17 */
      --adj: #e8725c;
      --adj-light: #fef4f2;
      --adv: #3d8bca;
      --adv-light: #f0f7fc;
      --phrasal: #5a9a6e;
      --phrasal-light: #f3f9f5;
      --quantity: #9b7fcf;
      --quantity-light: #f8f5fc;
    }

    [data-theme="dark"] {
      --bg: #141312;
      --bg-warm: #1e1c1a;
      --card: rgba(36, 34, 32, 0.92);
      --card-solid: #242220;
      --text: #F5F3F0;
      --text-secondary: #A3A09C;
      --text-muted: #8A8A8A;
      --accent: #F08872;
      --border: rgba(255, 255, 255, 0.06);
      --border-visible: rgba(255, 255, 255, 0.10);
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.35),
                   0 0 0 1px rgba(255, 255, 255, 0.03),
                   inset 0 1px 0 rgba(255, 255, 255, 0.05);
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(255, 255, 255, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 0.06);
      --shadow-lg: 0 12px 40px rgba(0, 0, 0, 0.6),
                   0 0 0 1px rgba(255, 255, 255, 0.05),
                   inset 0 1px 0 rgba(255, 255, 255, 0.08);
      --cat-basic: #6BA876;
      --cat-basic-light: rgba(90, 143, 101, 0.15);
      --cat-comm: #D9A043;
      --cat-comm-light: rgba(194, 138, 46, 0.15);
      --cat-advanced: #9A72B8;
      --cat-advanced-light: rgba(126, 90, 158, 0.15);
      --adj: #F08872;
      --adj-light: rgba(240, 136, 114, 0.12);
      --adv: #5BA3D9;
      --adv-light: rgba(91, 163, 217, 0.12);
      --phrasal: #6BAA7E;
      --phrasal-light: rgba(107, 170, 126, 0.12);
      --quantity: #B099DF;
      --quantity-light: rgba(176, 153, 223, 0.12);
    }

    [data-theme="dark"] body {
      background: var(--bg);
      background-image:
        radial-gradient(ellipse 100% 80% at 50% 0%, rgba(240, 136, 114, 0.06) 0%, transparent 50%),
        radial-gradient(ellipse 80% 60% at 20% 100%, rgba(176, 153, 223, 0.05) 0%, transparent 40%),
        radial-gradient(ellipse 60% 50% at 80% 80%, rgba(107, 170, 126, 0.04) 0%, transparent 40%),
        linear-gradient(135deg, #141312 0%, #1a1816 50%, #121110 100%);
      background-attachment: fixed;
    }

    .home-title em {
      font-style: normal;
      background: linear-gradient(135deg, var(--adj) 0%, var(--adv) 50%, var(--quantity) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .home-bg {
      position: absolute;
      inset: 0;
      background:
        radial-gradient(ellipse 80% 60% at 50% 20%, var(--cat-basic-light) 0%, transparent 50%),
        radial-gradient(ellipse 60% 50% at 20% 80%, var(--cat-comm-light) 0%, transparent 40%),
        radial-gradient(ellipse 50% 40% at 80% 70%, var(--cat-advanced-light) 0%, transparent 40%);
      opacity: 0.6;
    }

    .conj-section.adj .conj-section-icon { background: var(--adj-light); }
    .conj-section.adv .conj-section-icon { background: var(--adv-light); }
    .conj-section.phrasal .conj-section-icon { background: var(--phrasal-light); }
    .conj-section.quantity .conj-section-icon { background: var(--quantity-light); }

    .conj-section.adj .conj-card { --card-accent: var(--adj); }
    .conj-section.adv .conj-card { --card-accent: var(--adv); }
    .conj-section.phrasal .conj-card { --card-accent: var(--phrasal); }
    .conj-section.quantity .conj-card { --card-accent: var(--quantity); }

    .question-category-badge.basic { background: var(--cat-basic-light); color: var(--cat-basic); }
    .question-category-badge.comm { background: var(--cat-comm-light); color: var(--cat-comm); }
    .question-category-badge.advanced { background: var(--cat-advanced-light); color: var(--cat-advanced); }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--adj), var(--quantity));
      border-radius: 100px;
      width: 0%;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 4px var(--adj-light);
    }

    .toggle-btn.vocab { background: var(--quantity); color: white; }
    .toggle-btn.hint { background: var(--adj); color: white; }
    .toggle-btn.answer { background: var(--adv); color: white; }

    .qnum {
      display: inline-block;
      font-weight: 700;
      font-size: 12px;
      color: var(--accent);
      background: var(--adj-light);
      padding: 4px 12px;
      border-radius: 100px;
      margin-bottom: 12px;
    }

    .choices { background: var(--quantity-light); border-left: 3px solid var(--quantity); }
    .scramble { background: var(--adj-light); border-left: 3px solid var(--adj); font-family: 'JetBrains Mono', 'SF Mono', Monaco, monospace; }
    .vocab-box { background: var(--card); border-left: 3px solid var(--quantity); }
    .hint-box { background: var(--card); border-left: 3px solid var(--adj); }
    .hint-item { padding: 8px 0; border-bottom: 1px solid rgba(232, 114, 92, 0.15); }
    .ans-box { background: var(--card); border-left: 3px solid var(--phrasal); }
    .choice-explanations { border-top: 1px solid rgba(90, 154, 110, 0.2); }
    .choice-exp { padding: 8px 0; font-size: 16px; line-height: 1.6; border-bottom: 1px solid rgba(90, 154, 110, 0.12); }
    .choice-exp.correct { color: var(--adv); font-weight: 600; }
    .vocab-item { border-bottom: 1px solid rgba(155, 127, 207, 0.15); }
    .vocab-word { font-weight: 700; color: var(--quantity); margin-right: 8px; }
    .jp-text { color: var(--text-secondary); margin-top: 12px; padding-bottom: 12px; font-size: 16px; border-bottom: 1px solid rgba(90, 154, 110, 0.15); }
    .grammar-ref { background: var(--adj-light); border-left: 3px solid var(--adj); padding: 12px 14px; border-radius: var(--radius-sm); font-size: 15px; margin-top: 12px; }

    @media (max-width: 768px) {
      .mobile-nav-btn.active { color: var(--accent); background: var(--adj-light); }
    }
  </style>
</head>
<body data-exam-id="ds-lesson17-adjectives-adverbs">

  <!-- ===== TOP NAVIGATION BAR ===== -->
  <nav class="top-nav" id="topNav">
    <div class="top-nav-logo">DUAL SCOPE</div>
    <div class="top-nav-center" role="tablist">
      <button class="top-nav-link active" data-nav="home" onclick="Router.navigate('home')" role="tab" aria-selected="true">Home</button>
      <button class="top-nav-link" data-nav="overview" onclick="Router.navigate('overview')" role="tab" aria-selected="false">Overview</button>
      <button class="top-nav-link" data-nav="question" onclick="Router.navigate('question')" role="tab" aria-selected="false">Question</button>
    </div>
    <div class="top-nav-right">

      <button class="top-nav-theme" onclick="toggleTheme()" title="Toggle theme">
        <span class="theme-icon">&#9728;&#65039;</span>
      </button>
    </div>
  </nav>

  <!-- ===== SUB NAVIGATION (Question view only) ===== -->
  <nav class="sub-nav" id="subNav">
    <div class="sub-nav-categories">
      <button class="sub-nav-cat active" data-cat="basic" onclick="Router.setCategory('basic')">åŸºæœ¬å•é¡Œ</button>
      <button class="sub-nav-cat" data-cat="comm" onclick="Router.setCategory('comm')">For Communication</button>
      <button class="sub-nav-cat" data-cat="advanced" onclick="Router.setCategory('advanced')">ç™ºå±•å•é¡Œ</button>
    </div>
    <div class="sub-nav-sections" id="sectionToggles"></div>
  </nav>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="main-content" id="mainContent">

    <!-- HOME VIEW -->
    <section class="view-home active" id="viewHome">
      <div class="home-bg"></div>
      <div class="home-content">
        <p class="home-label">Lesson 17</p>
        <h1 class="home-title">å½¢å®¹è©ãƒ»å‰¯è©ãƒ»<em>ç¾¤å‹•è©</em></h1>
        <p class="home-subtitle">Master adjectives, adverbs and phrasal verbs in English.</p>
        <div class="home-cta">
          <button class="btn-primary" onclick="Router.navigate('question')">Start Learning</button>
          <button class="btn-secondary" onclick="Router.navigate('overview')">Overview</button>
          <button class="btn-secondary btn-print" onclick="printLesson()">Print</button>
        </div>
      </div>
    </section>

    <!-- OVERVIEW VIEW -->
    <section class="view-overview" id="viewOverview">
      <div class="overview-header">
        <p class="overview-label">Reference Guide</p>
        <h2 class="overview-title">Grammar Types</h2>
      </div>

      <!-- Adjectives -->
      <section class="conj-section adj">
        <div class="conj-section-header">
          <div class="conj-section-icon">ğŸ¨</div>
          <div>
            <h2 class="conj-section-title">Adjectives</h2>
            <p class="conj-section-title-jp">å½¢å®¹è©</p>
          </div>
        </div>
        <div class="conj-grid">
          <div class="conj-card">
            <div class="conj-card-word">é™å®šç”¨æ³•ã¨å™è¿°ç”¨æ³•</div>
            <div class="conj-card-meaning">å½¢å®¹è©ã®2ã¤ã®ä½¿ã„æ–¹</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">He is <strong>awake</strong>. (å™è¿°ã®ã¿)</p>
              <p class="conj-card-example-jp">å½¼ã¯ç›®ã‚’è¦šã¾ã—ã¦ã„ã‚‹ã€‚</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">ğŸ’¡</span>
              <span class="conj-card-tip-text">awake, asleep, alive ãªã©ã¯å™è¿°ç”¨æ³•ã®ã¿ã€‚late, certain ã¯ç”¨æ³•ã§æ„å‘³ãŒå¤‰ã‚ã‚‹</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">å½¢å®¹è©ã®å¾Œç½®</div>
            <div class="conj-card-meaning">åè©ã®å¾Œã‚ã«ç½®ãå½¢å®¹è©</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">Those <strong>present</strong> at the party enjoyed it.</p>
              <p class="conj-card-example-jp">ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã«å‡ºå¸­ã—ãŸäººãŸã¡ã¯æ¥½ã—ã‚“ã ã€‚</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">ğŸ’¡</span>
              <span class="conj-card-tip-text">presentï¼ˆå‡ºå¸­ã—ã¦ï¼‰ã¯å™è¿°ç”¨æ³•ã§å¾Œç½®ã€‚something strange ã®ã‚ˆã†ã«ä¸å®šä»£åè©ã‚‚å¾Œç½®</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">æ•°é‡å½¢å®¹è©</div>
            <div class="conj-card-meaning">little, few, much, many</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">There is <strong>little</strong> difference.</p>
              <p class="conj-card-example-jp">ã»ã¨ã‚“ã©é•ã„ãŒãªã„ã€‚</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">ğŸ’¡</span>
              <span class="conj-card-tip-text">little/much ã¯ä¸å¯ç®—ã€few/many ã¯å¯ç®—ã€‚a little/a few ã¯è‚¯å®šçš„ã€little/few ã¯å¦å®šçš„</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">æ„å‘³ãŒå¤‰ã‚ã‚‹å½¢å®¹è©</div>
            <div class="conj-card-meaning">late, certain ãªã©</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">My <strong>late</strong> mother loved cats.</p>
              <p class="conj-card-example-jp">äº¡ããªã£ãŸæ¯ã¯ãƒã‚³ãŒå¥½ãã ã£ãŸã€‚</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">ğŸ’¡</span>
              <span class="conj-card-tip-text">late: é™å®šç”¨æ³•â†’äº¡ããªã£ãŸã€å™è¿°ç”¨æ³•â†’é…åˆ»ã—ãŸã€‚certain: é™å®šç”¨æ³•â†’ã‚ã‚‹ã€å™è¿°ç”¨æ³•â†’ç¢ºã‹ãª</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Adverbs -->
      <section class="conj-section adv">
        <div class="conj-section-header">
          <div class="conj-section-icon">â±ï¸</div>
          <div>
            <h2 class="conj-section-title">Adverbs</h2>
            <p class="conj-section-title-jp">å‰¯è©</p>
          </div>
        </div>
        <div class="conj-grid">
          <div class="conj-card">
            <div class="conj-card-word">already / yet / still</div>
            <div class="conj-card-meaning">ã‚‚ã† / ã¾ã  / ã¾ã </div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">I haven't seen the movie <strong>yet</strong>.</p>
              <p class="conj-card-example-jp">ç§ã¯ã¾ã ãã®æ˜ ç”»ã‚’è¦‹ã¦ã„ãªã„ã€‚</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">ğŸ’¡</span>
              <span class="conj-card-tip-text">already: è‚¯å®šæ–‡ã€yet: å¦å®šæ–‡ãƒ»ç–‘å•æ–‡ã€still: ç¶™ç¶šã‚’å¼·èª¿</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">ago / before</div>
            <div class="conj-card-meaning">ã€œå‰ã«</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">She said she had seen him two days <strong>before</strong>.</p>
              <p class="conj-card-example-jp">å½¼å¥³ã¯2æ—¥å‰ã«å½¼ã‚’è¦‹ãŸã¨è¨€ã£ãŸã€‚</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">ğŸ’¡</span>
              <span class="conj-card-tip-text">ago: ç¾åœ¨ã‚’åŸºæº–ã€before: éå»ã®ã‚ã‚‹æ™‚ç‚¹ã‚’åŸºæº–</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">too / either</div>
            <div class="conj-card-meaning">ã€œã‚‚ã¾ãŸ</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">I won't join, <strong>either</strong>.</p>
              <p class="conj-card-example-jp">ç§ã‚‚å‚åŠ ã—ãªã„ã€‚</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">ğŸ’¡</span>
              <span class="conj-card-tip-text">too: è‚¯å®šæ–‡ã§ã€Œã€œã‚‚ã¾ãŸã€ã€either: å¦å®šæ–‡ã§ã€Œã€œã‚‚ã¾ãŸï¼ˆã€œãªã„ï¼‰ã€</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">abroad / overseas</div>
            <div class="conj-card-meaning">æµ·å¤–ã¸</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">Many people study <strong>abroad</strong>.</p>
              <p class="conj-card-example-jp">å¤šãã®äººã€…ãŒç•™å­¦ã™ã‚‹ã€‚</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">ğŸ’¡</span>
              <span class="conj-card-tip-text">abroad ã¯å‰¯è©ãªã®ã§å‰ã«å‰ç½®è©ã‚’ã¤ã‘ãªã„ï¼ˆÃ— to abroadï¼‰</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Phrasal Verbs -->
      <section class="conj-section phrasal">
        <div class="conj-section-header">
          <div class="conj-section-icon">ğŸ”—</div>
          <div>
            <h2 class="conj-section-title">Phrasal Verbs</h2>
            <p class="conj-section-title-jp">ç¾¤å‹•è©</p>
          </div>
        </div>
        <div class="conj-grid">
          <div class="conj-card">
            <div class="conj-card-word">å‹•è© + å‰ç½®è©</div>
            <div class="conj-card-meaning">look into, account for ãªã©</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">The police <strong>looked into</strong> the case.</p>
              <p class="conj-card-example-jp">è­¦å¯Ÿã¯ãã®äº‹ä»¶ã‚’èª¿ã¹ãŸã€‚</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">ğŸ’¡</span>
              <span class="conj-card-tip-text">look into = investigateã€account for = explainã€stand for = represent</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">å‹•è© + å‰¯è©</div>
            <div class="conj-card-meaning">give up, put off ãªã©</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">Please <strong>give it up</strong>.</p>
              <p class="conj-card-example-jp">ãã‚Œã‚’ã‚„ã‚ã¦ãã ã•ã„ã€‚</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">ğŸ’¡</span>
              <span class="conj-card-tip-text">ä»£åè©ã¯å‹•è©ã¨å‰¯è©ã®é–“ã«ç½®ã: give it upï¼ˆÃ— give up itï¼‰</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">å‹•è© + å‰¯è© + å‰ç½®è©</div>
            <div class="conj-card-meaning">put up with, look up to ãªã©</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">I can't <strong>put up with</strong> this noise.</p>
              <p class="conj-card-example-jp">ã“ã®é¨’éŸ³ã«ã¯æˆ‘æ…¢ã§ããªã„ã€‚</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">ğŸ’¡</span>
              <span class="conj-card-tip-text">put up with = endureã€look up to = respectã€do away with = abolish</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">make up for</div>
            <div class="conj-card-meaning">ã€œã®åŸ‹ã‚åˆã‚ã›ã‚’ã™ã‚‹</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">Work hard to <strong>make up for</strong> your lack of experience.</p>
              <p class="conj-card-example-jp">çµŒé¨“ä¸è¶³ã‚’åŸ‹ã‚åˆã‚ã›ã‚‹ãŸã‚ã«ç†±å¿ƒã«åƒããªã•ã„ã€‚</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">ğŸ’¡</span>
              <span class="conj-card-tip-text">make up for = compensate forï¼ˆåŸ‹ã‚åˆã‚ã›ã‚‹ï¼‰</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Quantity Expressions -->
      <section class="conj-section quantity">
        <div class="conj-section-header">
          <div class="conj-section-icon">ğŸ“Š</div>
          <div>
            <h2 class="conj-section-title">Quantity Expressions</h2>
            <p class="conj-section-title-jp">æ•°é‡è¡¨ç¾</p>
          </div>
        </div>
        <div class="conj-grid">
          <div class="conj-card">
            <div class="conj-card-word">quite a few</div>
            <div class="conj-card-meaning">ã‹ãªã‚Šå¤šãã®</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en"><strong>Quite a few</strong> people came.</p>
              <p class="conj-card-example-jp">ã‹ãªã‚Šå¤šãã®äººãŒæ¥ãŸã€‚</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">ğŸ’¡</span>
              <span class="conj-card-tip-text">quite a few = ã‹ãªã‚Šå¤šãã®ï¼ˆè‚¯å®šçš„ï¼‰ã€a few = å°‘ã—ã®ã€few = ã»ã¨ã‚“ã©ã€œãªã„</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">almost all / most of</div>
            <div class="conj-card-meaning">ã»ã¨ã‚“ã©ã®</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en"><strong>Almost all</strong> the students passed.</p>
              <p class="conj-card-example-jp">ã»ã¨ã‚“ã©ã®å­¦ç”ŸãŒåˆæ ¼ã—ãŸã€‚</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">ğŸ’¡</span>
              <span class="conj-card-tip-text">almost ã¯å‰¯è©ãªã®ã§åè©ã‚’ç›´æ¥ä¿®é£¾ã§ããªã„ã€‚almost all ã¾ãŸã¯ most of ã‚’ä½¿ã†</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">a large number of / amount of</div>
            <div class="conj-card-meaning">å¤šæ•°ã® / å¤šé‡ã®</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">We need a large <strong>amount of</strong> money.</p>
              <p class="conj-card-example-jp">ç§ãŸã¡ã¯å¤šé¡ã®ãŠé‡‘ãŒå¿…è¦ã ã€‚</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">ğŸ’¡</span>
              <span class="conj-card-tip-text">number of = å¯ç®—åè©ã€amount of = ä¸å¯ç®—åè©</span>
            </div>
          </div>
          <div class="conj-card">
            <div class="conj-card-word">åˆ†æ•°ã®è¡¨ã—æ–¹</div>
            <div class="conj-card-meaning">two-thirds ãªã©</div>
            <div class="conj-card-example">
              <p class="conj-card-example-en">The country is <strong>two-thirds</strong> the size of Japan.</p>
              <p class="conj-card-example-jp">ãã®å›½ã¯æ—¥æœ¬ã®3åˆ†ã®2ã®å¤§ãã•ã ã€‚</p>
            </div>
            <div class="conj-card-tip">
              <span class="conj-card-tip-icon">ğŸ’¡</span>
              <span class="conj-card-tip-text">åˆ†æ•°: åˆ†å­(åŸºæ•°)â†’åˆ†æ¯(åºæ•°)ã€‚åˆ†å­ãŒ2ä»¥ä¸Šãªã‚‰åˆ†æ¯ã¯è¤‡æ•°å½¢</span>
            </div>
          </div>
        </div>
      </section>
    </section>

    <!-- QUESTION VIEW -->
    <section class="view-question" id="viewQuestion">
      <div class="question-header">
        <div class="question-category-badge basic" id="categoryBadge">
          <span id="categoryIcon" role="img" aria-label="Basic problems">&#128218;</span>
          <span id="categoryName">åŸºæœ¬å•é¡Œ</span>
        </div>
        <h2 class="question-title" id="sectionTitle">[1] åŸºæœ¬å•é¡Œ 1</h2>
        <p class="question-subtitle" id="sectionSubtitle">14 questions</p>
      </div>

      <div class="progress-wrap">
        <div class="progress-bar-bg">
          <div class="progress-bar-fill" id="progressBar"></div>
        </div>
        <p class="progress-label" id="progressText">0 / 0 answers revealed</p>
      </div>

      <div class="search-wrap">
        <span class="search-icon">&#128269;</span>
        <input type="text" class="search-input" id="searchInput" placeholder="Search questions, grammar, vocabulary..." oninput="debouncedSearch()">
      </div>

      <div class="questions-list" id="questionsList"></div>
    </section>
  </main>

  <!-- Mobile Navigation -->
  <nav class="mobile-nav">
    <button class="mobile-nav-btn active" data-nav="home" onclick="Router.navigate('home')">
      <span class="mobile-nav-btn-icon">&#127968;</span>
      Home
    </button>
    <button class="mobile-nav-btn" data-nav="overview" onclick="Router.navigate('overview')">
      <span class="mobile-nav-btn-icon">&#128218;</span>
      Overview
    </button>
    <button class="mobile-nav-btn" data-nav="question" onclick="Router.navigate('question')">
      <span class="mobile-nav-btn-icon">&#10067;</span>
      Question
    </button>
  </nav>

  <footer>DUAL SCOPE English Grammar â€” Lesson 17: å½¢å®¹è©ãƒ»å‰¯è©ãƒ»ç¾¤å‹•è©</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
<script>
// ===== GSAP SETUP =====
if (typeof gsap !== 'undefined') {
  gsap.registerPlugin(ScrollTrigger);
}
let UV_REDUCED = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
window.matchMedia('(prefers-reduced-motion: reduce)').addEventListener('change', e => { UV_REDUCED = e.matches; });

const GSAP_CONFIG = {
  ease: {
    default: 'power3.out',
    smooth: 'power2.inOut',
    spring: 'back.out(1.7)',
    gentle: 'power1.out',
    nav: 'power2.out',
    elastic: 'elastic.out(1, 0.3)',
  },
  duration: {
    micro: 0.1,
    fast: 0.25,
    normal: 0.5,
    slow: 0.8,
    nav: 0.3,
    view: 0.4,
  },
  stagger: {
    tight: 0.03,
    normal: 0.08,
    relaxed: 0.15,
  },
  scroll: {
    start: 'top 85%',
    toggleActions: 'play none none none',
  },
  hover: {
    lift: -3,
    liftLarge: -4,
    scaleSmall: 1.05,
    scaleMedium: 1.08,
  },
};

// ===== GRAMMAR DATA =====
const grammarData = {
  sections: [
    {
      title: "[1] åŸºæœ¬å•é¡Œ 1ï½œèªå¥é¸æŠ (1)ï½(8)",
      open: true,
      questions: [
        {
          num: "(1)", type: "pair", correctAnswer: "awake",
          text: "Too much strong coffee kept me ( awake, wake ) last night.",
          vocab: [["keep + O + C", "Oã‚’Cã®çŠ¶æ…‹ã«ä¿ã¤"],["strong coffee", "æ¿ƒã„ã‚³ãƒ¼ãƒ’ãƒ¼"]],
          hint: ["ã€ˆkeep + O + Cã€‰ã®æ§‹æ–‡ã§ã€Cã«å…¥ã‚‹å“è©ã¯ï¼Ÿ","é¸æŠè‚¢ã®å“è©ã‚’ç¢ºèªï¼šå½¢å®¹è© or å‹•è©ï¼Ÿ","è£œèªã«ãªã‚Œã‚‹ã®ã¯ã©ã¡ã‚‰ï¼Ÿ"]},
        {
          num: "(2)", type: "pair", correctAnswer: "Those present",
          text: "( Present those, Those present ) at the party were fascinated by her.",
          vocab: [["be fascinated by", "ã€œã«é­…äº†ã•ã‚Œã‚‹"],["at the party", "ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã§"]],
          hint: ["present ã¯åè©ã®å‰ã«ç½®ãï¼Ÿå¾Œã«ç½®ãï¼Ÿ","å™è¿°ç”¨æ³•ã§ä½¿ã‚ã‚Œã‚‹å½¢å®¹è©ã®ä½ç½®ã«æ³¨ç›®","Those + å½¢å®¹è©ï¼ˆå¾Œç½®ï¼‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³"]},
        {
          num: "(3)", type: "pair", correctAnswer: "little",
          text: "There is ( few, little ) difference between the two.",
          vocab: [["difference", "é•ã„ã€ç›¸é•"],["between the two", "ä¸¡è€…ã®é–“ã«"]],
          hint: ["difference ã¯å¯ç®—åè©ï¼Ÿä¸å¯ç®—åè©ï¼Ÿ","ä¸å¯ç®—åè©ã«ä½¿ã†ã®ã¯ã©ã¡ã‚‰ï¼Ÿ","few = å¯ç®—ã€little = ä¸å¯ç®—"]},
        {
          num: "(4)", type: "pair", correctAnswer: "something strange",
          text: "There is ( something strange, strange something ) about her.",
          vocab: [["about her", "å½¼å¥³ã«ã¤ã„ã¦"],["ä¸å®šä»£åè©", "something, anything, nothing ãªã©"]],
          hint: ["something ã¯ä¸å®šä»£åè©","ä¸å®šä»£åè©ã‚’ä¿®é£¾ã™ã‚‹å½¢å®¹è©ã®ä½ç½®ã¯ï¼Ÿ","å‰ã«ç½®ãï¼Ÿå¾Œã«ç½®ãï¼Ÿ"]},
        {
          num: "(5)", type: "pair", correctAnswer: "much",
          text: "Ms. Ito was ( very, much ) loved by all the students.",
          vocab: [["be loved by", "ã€œã‹ã‚‰æ„›ã•ã‚Œã‚‹"],["all the students", "å…¨ã¦ã®ç”Ÿå¾’"]],
          hint: ["loved ã¯ä½•å½¢ï¼Ÿï¼ˆéå»åˆ†è©ï¼‰","éå»åˆ†è©ã‚’ä¿®é£¾ã§ãã‚‹å‰¯è©ã¯ã©ã¡ã‚‰ï¼Ÿ","very ã¯åŸç´šã®å½¢å®¹è©ã‚’ä¿®é£¾ã™ã‚‹"]},
        {
          num: "(6)", type: "pair", correctAnswer: "abroad",
          text: "A lot of people go ( abroad, to abroad ) to study English.",
          vocab: [["a lot of", "ãŸãã•ã‚“ã®"],["to study English", "è‹±èªã‚’å‹‰å¼·ã™ã‚‹ãŸã‚ã«"]],
          hint: ["abroad ã®å“è©ã¯ä½•ã‹ï¼Ÿï¼ˆåè©ï¼Ÿå‰¯è©ï¼Ÿï¼‰","å‰¯è©ã®å‰ã«å‰ç½®è©ã¯å¿…è¦ï¼Ÿä¸è¦ï¼Ÿ","go home ã¨åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã§è€ƒãˆã‚ˆã†"]},
        {
          num: "(7)", type: "pair", correctAnswer: "before",
          text: "She said she had seen the accident two days ( ago, before ).",
          vocab: [["had seen", "è¦‹ã¦ã„ãŸï¼ˆéå»å®Œäº†ï¼‰"],["accident", "äº‹æ•…"]],
          hint: ["said ã¯éå»å½¢ â†’ æ™‚é–“ã®åŸºæº–ã¯ã„ã¤ï¼Ÿ","ç¾åœ¨ãŒåŸºæº–ã®å ´åˆã¨éå»ãŒåŸºæº–ã®å ´åˆã§ä½¿ã„åˆ†ã‘ã‚‹","ago ã¯ç¾åœ¨ãŒåŸºæº–ã€ã‚‚ã†ä¸€æ–¹ã¯ï¼Ÿ"]},
        {
          num: "(8)", type: "pair", correctAnswer: "yet",
          text: "I haven't watched the movie on DVD ( already, yet ).",
          vocab: [["haven't watched", "è¦‹ã¦ã„ãªã„"],["on DVD", "DVDã§"]],
          hint: ["ã“ã®æ–‡ã¯å¦å®šæ–‡ï¼Ÿè‚¯å®šæ–‡ï¼Ÿ","å¦å®šæ–‡ã§ã€Œã¾ã ã€ã‚’è¡¨ã™å‰¯è©ã¯ã©ã¡ã‚‰ï¼Ÿ","è‚¯å®šæ–‡ã§ã€Œã‚‚ã†ã€ã‚’è¡¨ã™å‰¯è©ã¯ã©ã¡ã‚‰ï¼Ÿ"]}
      ]
    },
    {
      title: "[2] åŸºæœ¬å•é¡Œ 2ï½œç¾¤å‹•è© (1)ï½(9)",
      open: false,
      questions: [
        {
          num: "(1)", type: "choice", correctAnswer: "b",
          text: "Can you <u>account for</u> your absence from the meeting?",
          choices: "a. endureã€€b. explainã€€c. happenã€€d. investigateã€€e. postponeã€€f. representã€€g. resembleã€€h. respectã€€i. understand",
          vocab: [["absence", "æ¬ å¸­"],["meeting", "ä¼šè­°"]],
          hint: ["æ–‡è„ˆï¼šä¼šè­°ã‚’æ¬ å¸­ã—ãŸç†ç”±ã‚’æ±‚ã‚ã‚‰ã‚Œã¦ã„ã‚‹","account ã«ã¯ã€Œå ±å‘Šã€ã¨ã„ã†åè©ã®æ„å‘³ãŒã‚ã‚‹","aï½iã§ã€Œç†ç”±ã‚’è¿°ã¹ã‚‹ã€ã«è¿‘ã„å‹•è©ã¯ï¼Ÿ"]},
        {
          num: "(2)", type: "choice", correctAnswer: "d",
          text: "The police started to <u>look into</u> the murder case.",
          choices: "a. endureã€€b. explainã€€c. happenã€€d. investigateã€€e. postponeã€€f. representã€€g. resembleã€€h. respectã€€i. understand",
          vocab: [["murder case", "æ®ºäººäº‹ä»¶"],["the police", "è­¦å¯Ÿ"]],
          hint: ["æ–‡è„ˆï¼šè­¦å¯ŸãŒæ®ºäººäº‹ä»¶ã«å¯¾ã—ã¦è¡Œã†ã“ã¨","look into â†’ ã€Œä¸­ã‚’è¦‹ã‚‹ã€â†’ è©³ã—ãèª¿ã¹ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸","aï½iã§ã€Œè©³ã—ãèª¿ã¹ã‚‹ã€ã«è¿‘ã„å‹•è©ã¯ï¼Ÿ"]},
        {
          num: "(3)", type: "choice", correctAnswer: "f",
          text: "What does WHO <u>stand for</u>?",
          choices: "a. endureã€€b. explainã€€c. happenã€€d. investigateã€€e. postponeã€€f. representã€€g. resembleã€€h. respectã€€i. understand",
          vocab: [["WHO", "ä¸–ç•Œä¿å¥æ©Ÿé–¢ï¼ˆç•¥ç§°ï¼‰"]],
          hint: ["WHOã¯ä½•ã‹ã®ç•¥ç§°","ç•¥ç§°ãŒä½•ã‚’æ„å‘³ã™ã‚‹ã‹ã‚’èã„ã¦ã„ã‚‹","stand for â†’ ã€Œã€œã®ä»£ã‚ã‚Šã«ç«‹ã¤ã€â†’ ä½•ã‹ã‚’æ„å‘³ã™ã‚‹"]},
        {
          num: "(4)", type: "choice", correctAnswer: "g",
          text: "You don't <u>take after</u> your father, do you?",
          choices: "a. endureã€€b. explainã€€c. happenã€€d. investigateã€€e. postponeã€€f. representã€€g. resembleã€€h. respectã€€i. understand",
          vocab: [["do you?", "ã€œã§ã™ã‚ˆã­ï¼Ÿï¼ˆä»˜åŠ ç–‘å•ï¼‰"]],
          hint: ["æ–‡è„ˆï¼šçˆ¶è¦ªã¨ã®é–¢ä¿‚ã«ã¤ã„ã¦è¿°ã¹ã¦ã„ã‚‹","take after â†’ ã€Œã€œã®å¾Œã‚’è¿½ã†ã€â†’ ç‰¹å¾´ãŒä¼¼ã‚‹ã“ã¨","å®¶æ—ã®å¹´é•·è€…ã«å¯¾ã—ã¦ä½¿ã‚ã‚Œã‚‹è¡¨ç¾"]},
        {
          num: "(5)", type: "choice", correctAnswer: "i",
          text: "I couldn't <u>make out</u> what the foreigner was saying.",
          choices: "a. endureã€€b. explainã€€c. happenã€€d. investigateã€€e. postponeã€€f. representã€€g. resembleã€€h. respectã€€i. understand",
          vocab: [["foreigner", "å¤–å›½äºº"],["what ... was saying", "â€¦ãŒè¨€ã£ã¦ã„ãŸã“ã¨"]],
          hint: ["æ–‡è„ˆï¼šå¤–å›½äººã®è¨€è‘‰ãŒåˆ†ã‹ã‚‰ãªã‹ã£ãŸ","couldn't â†’ ã§ããªã‹ã£ãŸ","aï½iã§ã€Œå†…å®¹ã‚’æŠŠæ¡ã™ã‚‹ã€ã«è¿‘ã„å‹•è©ã¯ï¼Ÿ"]},
        {
          num: "(6)", type: "choice", correctAnswer: "e",
          text: "We had to <u>put off</u> the game till tomorrow.",
          choices: "a. endureã€€b. explainã€€c. happenã€€d. investigateã€€e. postponeã€€f. representã€€g. resembleã€€h. respectã€€i. understand",
          vocab: [["till tomorrow", "æ˜æ—¥ã¾ã§"],["had to", "ã€œã—ãªã‘ã‚Œã°ãªã‚‰ãªã‹ã£ãŸ"]],
          hint: ["è©¦åˆã‚’æ˜æ—¥ã¾ã§ã€Œã€œã€ã—ãªã‘ã‚Œã°ãªã‚‰ãªã‹ã£ãŸ","put off â†’ ã€Œå…ˆã«ç½®ãã€â†’ å¾Œæ—¥ã«å›ã™","aï½iã§ã€Œå¾Œæ—¥ã«å›ã™ã€ã«è¿‘ã„å‹•è©ã¯ï¼Ÿ"]},
        {
          num: "(7)", type: "choice", correctAnswer: "c",
          text: "How did the accident <u>come about</u>?",
          choices: "a. endureã€€b. explainã€€c. happenã€€d. investigateã€€e. postponeã€€f. representã€€g. resembleã€€h. respectã€€i. understand",
          vocab: [["How did ...?", "ã©ã®ã‚ˆã†ã«ã—ã¦ã€œï¼Ÿ"],["accident", "äº‹æ•…"]],
          hint: ["äº‹æ•…ãŒã©ã®ã‚ˆã†ã«ã—ã¦ã€Œã€œã€ã—ãŸã®ã‹","come about â†’ ã€Œã‚„ã£ã¦æ¥ã‚‹ã€â†’ å‡ºæ¥äº‹ãŒç”Ÿã˜ã‚‹","aï½iã§ã€Œç™ºç”Ÿã™ã‚‹ã€ã«è¿‘ã„å‹•è©ã¯ï¼Ÿ"]},
        {
          num: "(8)", type: "choice", correctAnswer: "h",
          text: "They <u>look up to</u> him because of his positive attitude.",
          choices: "a. endureã€€b. explainã€€c. happenã€€d. investigateã€€e. postponeã€€f. representã€€g. resembleã€€h. respectã€€i. understand",
          vocab: [["positive attitude", "å‰å‘ããªæ…‹åº¦"],["because of", "ã€œã®ãŸã‚ã«"]],
          hint: ["å‰å‘ããªæ…‹åº¦ã®ãŸã‚ã«å½¼ã‚’ã€Œã€œã€ã—ã¦ã„ã‚‹","look up to â†’ ã€Œè¦‹ä¸Šã’ã‚‹ã€â†’ æ•¬ã†æ°—æŒã¡","aï½iã§ã€Œæ•¬æ„ã‚’æŒã¤ã€ã«è¿‘ã„å‹•è©ã¯ï¼Ÿ"]},
        {
          num: "(9)", type: "choice", correctAnswer: "a",
          text: "I can't <u>put up with</u> their bad manners.",
          choices: "a. endureã€€b. explainã€€c. happenã€€d. investigateã€€e. postponeã€€f. representã€€g. resembleã€€h. respectã€€i. understand",
          vocab: [["bad manners", "ä¸ä½œæ³•"],["can't", "ã€œã§ããªã„"]],
          hint: ["ä¸ä½œæ³•ã«ã€Œã€œã€ã§ããªã„","put up with â†’ ã€Œæˆ‘æ…¢ã—ã¦ä»˜ãåˆã†ã€","aï½iã§ã€Œè€ãˆå¿ã¶ã€ã«è¿‘ã„å‹•è©ã¯ï¼Ÿ"]}
      ]
    },
    {
      title: "[3] åŸºæœ¬å•é¡Œ 3ï½œèª¤ã‚Šè¨‚æ­£ (1)ï½(5)",
      open: false,
      questions: [
        {
          num: "(1)", type: "correction", correctText: "either",
          text: "If you don't join in the project, I won't, <u>too</u>.",
          vocab: [["join in", "ã€œã«å‚åŠ ã™ã‚‹"],["project", "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ"]],
          hint: ["ã“ã®æ–‡ã¯è‚¯å®šæ–‡ï¼Ÿå¦å®šæ–‡ï¼Ÿ","I won't ã®éƒ¨åˆ†ã«æ³¨ç›®","ã€Œã€œã‚‚ã¾ãŸã€ã‚’å¦å®šæ–‡ã§ä½¿ã†å ´åˆã¯ï¼Ÿ"]},
        {
          num: "(2)", type: "correction", correctText: ["Almost all", "Most of"],
          text: "<u>Almost</u> the people agreed to his proposal.",
          vocab: [["agree to", "ã€œã«åŒæ„ã™ã‚‹"],["proposal", "ææ¡ˆ"]],
          hint: ["almost ã®å“è©ã¯ä½•ã‹ï¼Ÿï¼ˆåè©ï¼Ÿå‰¯è©ï¼Ÿï¼‰","å‰¯è©ã¯åè©ã‚’ç›´æ¥ä¿®é£¾ã§ãã‚‹ã‹ï¼Ÿ","ã€Œã»ã¨ã‚“ã©ã®ã€œã€ã‚’æ­£ã—ãè¡¨ã™ã«ã¯ï¼Ÿ"]},
        {
          num: "(3)", type: "correction", correctText: "amount",
          text: "A large <u>number</u> of money is needed to carry out this project.",
          vocab: [["carry out", "å®Ÿè¡Œã™ã‚‹"],["project", "ä¼ç”»"]],
          hint: ["money ã¯å¯ç®—åè©ï¼Ÿä¸å¯ç®—åè©ï¼Ÿ","a large number of ã¯å¯ç®—åè©ã«ä½¿ã†è¡¨ç¾","ä¸å¯ç®—åè©ã«ä½¿ã†ã€Œå¤šé‡ã®ã€ã®è¡¨ç¾ã¯ï¼Ÿ"]},
        {
          num: "(4)", type: "correction", correctText: "latter",
          text: "He scored a goal in the <u>later</u> half of the game.",
          vocab: [["score a goal", "ã‚´ãƒ¼ãƒ«ã‚’æ±ºã‚ã‚‹"],["half", "åŠåˆ†"]],
          hint: ["ã€Œå¾ŒåŠã€ã‚’è‹±èªã§è¡¨ã™ã«ã¯ï¼Ÿ","later ã¨ä¼¼ãŸåˆ¥ã®ã‚¹ãƒšãƒ«ã®å½¢å®¹è©ãŒã‚ã‚‹","é™å®šç”¨æ³•ã§ã€Œå¾Œã®ã€å¾ŒåŠã®ã€ã‚’æ„å‘³ã™ã‚‹å½¢å®¹è©ã¯ï¼Ÿ"]},
        {
          num: "(5)", type: "correction", correctText: "give it up",
          text: "Since smoking is bad for your health, you should <u>give up it</u>.",
          vocab: [["since", "ã€œãªã®ã§"],["be bad for", "ã€œã«æ‚ªã„"]],
          hint: ["give up ã¯å‹•è©ï¼‹å‰¯è©ã®ç¾¤å‹•è©","ç›®çš„èª it ã¯ä»£åè©","ä»£åè©ãŒç›®çš„èªã®ã¨ãã€èªé †ã¯ã©ã†ãªã‚‹ï¼Ÿ"]}
      ]
    },
    {
      title: "[4] åŸºæœ¬å•é¡Œ 4ï½œå’Œè¨³ (1)ï½(5)",
      open: false,
      questions: [
        {
          num: "(1)", type: "compose", correctAnswer: "å½¼å¥³ãŒãã®äº‹å®Ÿã‚’çŸ¥ã£ã¦ã„ã‚‹ã®ã¯ç¢ºã‹ã ã€‚",
          text: "It is certain that she knows the fact.",
          vocab: [["it is certain that", "ã€œã¨ã„ã†ã“ã¨ã¯ç¢ºã‹ã "],["fact", "äº‹å®Ÿ"]]},
        {
          num: "(2)", type: "compose", correctAnswer: "æ£®ã•ã‚“ã¯ãã®æ—¥ã€ã‚ã‚‹å ´æ‰€ã‚’è¨ªã‚Œãªã‘ã‚Œã°ãªã‚‰ãªã‹ã£ãŸã€‚",
          text: "Mr. Mori had to visit a certain place on that day.",
          vocab: [["certain", "ã‚ã‚‹ï¼ˆé™å®šç”¨æ³•ï¼‰"],["place", "å ´æ‰€"]]},
        {
          num: "(3)", type: "compose", correctAnswer: "ã‹ãªã‚Šå¤šãã®äººãŒãã®ãŠç¥­ã‚Šã«å‚åŠ ã—ãŸã€‚",
          text: "Quite a few people took part in the festival.",
          vocab: [["quite a few", "ã‹ãªã‚Šå¤šãã®"],["take part in", "ã€œã«å‚åŠ ã™ã‚‹"],["festival", "ç¥­ã‚Š"]]},
        {
          num: "(4)", type: "compose", correctAnswer: "ä¸€ç”Ÿæ‡¸å‘½åƒã„ã¦ã€çµŒé¨“ä¸è¶³ã‚’è£œã„ãªã•ã„ã€‚",
          text: "Work hard and make up for your lack of experience.",
          vocab: [["make up for", "ã€œã®åŸ‹ã‚åˆã‚ã›ã‚’ã™ã‚‹"],["lack of", "ã€œã®ä¸è¶³"]]},
        {
          num: "(5)", type: "compose", correctAnswer: "æ®‹å¿µãªãŒã‚‰ã€é«˜çŸ¥ã§ã¯ã‚¯ã‚¸ãƒ©ã‚’1é ­ã‚‚è¦‹ã‚‹ã“ã¨ãŒã§ããªã‹ã£ãŸã€‚",
          text: "Unfortunately, I wasn't able to see any whales in Kochi.",
          vocab: [["unfortunately", "é‹æ‚ªã"],["whale", "ã‚¯ã‚¸ãƒ©"]]}
      ]
    },
    {
      title: "[5] åŸºæœ¬å•é¡Œ 5ï½œä¸¦ã¹ã‹ãˆ (1)ï½(4)",
      open: false,
      questions: [
        {
          num: "(1)", type: "scramble", correctAnswer: "should be done away with",
          text: "ã“ã‚Œã‚‰ã®å¤ã„è¦å‰‡ã¯ã™ãã«å»ƒæ­¢ã•ã‚Œã‚‹ã¹ãã ã€‚",
          scramble: "These old rules [ away, be, with, done, should ] soon.",
          vocab: [["these old rules", "ã“ã‚Œã‚‰ã®å¤ã„è¦å‰‡"],["soon", "ã™ãã«"]],
          hint: ["ã€Œã€œã‚’å»ƒæ­¢ã™ã‚‹ã€ã¯3èªã‚»ãƒƒãƒˆã®ç¾¤å‹•è©","å—å‹•æ…‹ã®èªé †ã‚’è€ƒãˆã‚ˆã†","å—å‹•æ…‹ã§ã‚‚3èªã®ã‚»ãƒƒãƒˆã¯å´©ã•ãªã„"]},
        {
          num: "(2)", type: "scramble", correctAnswer: "don't have to feel ashamed of yourself",
          text: "å›ã¯è‡ªåˆ†è‡ªèº«ã‚’æ¥ãšã‹ã—ã„ã¨æ€ã†å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚",
          scramble: "You [ of, to, yourself, don't, feel, have, ashamed ].",
          vocab: [["yourself", "ã‚ãªãŸè‡ªèº«"]],
          hint: ["å™è¿°ç”¨æ³•ã®ã¿ã®å½¢å®¹è©ãŒã‚ã‚‹","ã€Œã€œã™ã‚‹å¿…è¦ã¯ãªã„ã€ã®è¡¨ç¾ã‚’ä½œã‚ã†","å‰ç½®è© of ã®ç›®çš„èªã¯ä½•ï¼Ÿ"]},
        {
          num: "(3)", type: "scramble", correctAnswer: "She was carrying a basket full of apples",
          text: "å½¼å¥³ã¯ãƒªãƒ³ã‚´ã¨ã‚ªãƒ¬ãƒ³ã‚¸ã§ã„ã£ã±ã„ã®ã‹ã”ã‚’é‹ã‚“ã§ã„ãŸã€‚",
          scramble: "[ a, apples, basket, carrying, full, of, she, was ] and oranges.",
          vocab: [["carry", "é‹ã¶"],["basket", "ã‹ã”"],["oranges", "ã‚ªãƒ¬ãƒ³ã‚¸"]],
          hint: ["ã¾ãšä¸»èªã¨å‹•è©ã®èªé †ã‚’æ±ºã‚ã‚ˆã†","å½¢å®¹è©å¥ãŒåè©ã‚’ä¿®é£¾â†’å‰ã«ç½®ãï¼Ÿå¾Œã‚ã«ç½®ãï¼Ÿ","ä¿®é£¾èªå¥ã‚’ä¼´ã†å½¢å®¹è©ã¯å¾Œç½®ä¿®é£¾"]},
        {
          num: "(4)", type: "scramble", correctAnswer: "had too many problems that she had to",
          text: "ã‚¨ãƒªã«ã¯è§£æ±ºã—ãªã‘ã‚Œã°ãªã‚‰ãªã„å•é¡ŒãŒãŸãã•ã‚“ã‚ã‚Šã™ããŸã€‚",
          scramble: "Eri [ to, too, she, had, had, that, problems, many ] solve.",
          vocab: [["solve", "è§£æ±ºã™ã‚‹"],["problem", "å•é¡Œ"]],
          hint: ["ã€Œã€œã™ãã‚‹ã€ã‚’è¡¨ã™èªã¯ã©ã‚Œï¼Ÿ","è‚¯å®šæ–‡ã§ã‚‚ too/so/as ã®å¾Œã¯ many ãŒä½¿ãˆã‚‹","é–¢ä¿‚ä»£åè©ã§ problems ã‚’ä¿®é£¾ã™ã‚‹æ§‹é€ ã‚’ä½œã‚ã†"]}
      ]
    },
    {
      title: "[6] FOR COMMUNICATION (1)ï½(3)",
      open: false,
      questions: [
        {
          num: "(1)", type: "choice", correctAnswer: "c",
          text: "A: Is Ann here (   )?<br>B: No, I'm afraid she is delayed by the heavy traffic.",
          choices: "a. soonã€€b. stillã€€c. yetã€€d. later",
          vocab: [["delayed", "é…ã‚ŒãŸ"],["heavy traffic", "ã²ã©ã„äº¤é€šæ¸‹æ»"]],
          hint: ["è‚¯å®šã®ç–‘å•æ–‡ã§ã€Œã‚‚ã†ã€ã‚’è¡¨ã™å‰¯è©ã¯ï¼Ÿ","still ã¯ã€Œã¾ã ã€ã‚ã„ã‹ã‚ã‚‰ãšã€ã§ç¶™ç¶šã®æ„å‘³","soon ã¯ã€Œã‚‚ã†ã™ãã€ã§æ„å‘³ãŒé•ã†"]},
        {
          num: "(2)", type: "choice", correctAnswer: "d",
          text: "A: Why do you leave so early?<br>B: Just (   ).",
          choices: "a. between usã€€b. on timeã€€c. in timeã€€d. in case",
          vocab: [["leave early", "æ—©ãå‡ºç™ºã™ã‚‹"]],
          hint: ["Just + ï¼Ÿ ã§æ…£ç”¨è¡¨ç¾ã«ãªã‚‹","ã€Œå¿µã®ãŸã‚ã«ã€ã¨ã„ã†æ„å‘³ã®çµ„ã¿åˆã‚ã›ã¯ï¼Ÿ","just + å‰ç½®è©å¥ã®å®šå‹è¡¨ç¾ã‚’è€ƒãˆã‚ˆã†"]},
        {
          num: "(3)", type: "choice", correctAnswer: "c",
          text: "A: Hello, this is Kenta. I'd like to speak to Ms. Lin, please.<br>B: I'm afraid you have the (   ) number.",
          choices: "a. differentã€€b. mistakenã€€c. wrongã€€d. another",
          vocab: [["I'd like to speak to", "ã€œã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼ˆä¸å¯§ï¼‰"],["I'm afraid", "æ®‹å¿µãªãŒã‚‰"]],
          hint: ["é›»è©±ã®ã‹ã‘é–“é•ã„ã‚’ä¼ãˆã‚‹å®šå‹è¡¨ç¾","You have the ___ number.","ã€Œï¼ˆäº‹å®ŸãŒï¼‰é–“é•ã£ãŸã€ã‚’è¡¨ã™å½¢å®¹è©ã‚’é¸ã¼ã†"]}
      ]
    },
    {
      title: "[ç™ºå±•1] èªå¥é¸æŠ (1)ï½(8)",
      open: false,
      questions: [
        {
          num: "(1)", type: "choice", correctAnswer: "b",
          text: "Ten kilometers (   ) a long way if you have to walk.",
          choices: "a. areã€€b. isã€€c. wasã€€d. were",
          vocab: [["kilometer", "ã‚­ãƒ­ãƒ¡ãƒ¼ãƒˆãƒ«"],["a long way", "é ã„é“ã®ã‚Š"]],
          hint: ["è·é›¢ãƒ»æ™‚é–“ãƒ»é‡‘é¡ã¯1ã¤ã®ã¾ã¨ã¾ã‚Š","è¤‡æ•°å½¢ã§ã‚‚å˜æ•°æ‰±ã„ã«ãªã‚‹å ´åˆãŒã‚ã‚‹","ä¸€èˆ¬è«–ãªã®ã§æ™‚åˆ¶ã¯ç¾åœ¨å½¢"]},
        {
          num: "(2)", type: "choice", correctAnswer: "b",
          text: "My (   ) mother left us a lot of jewelry when she died.",
          choices: "a. latestã€€b. lateã€€c. laterã€€d. last",
          vocab: [["jewelry", "å®çŸ³é¡"],["die", "æ­»ã¬ã€äº¡ããªã‚‹"]],
          hint: ["é™å®šç”¨æ³•ã¨å™è¿°ç”¨æ³•ã§æ„å‘³ãŒå¤‰ã‚ã‚‹å½¢å®¹è©ã«æ³¨ç›®","åè©ã®å‰ï¼ˆé™å®šç”¨æ³•ï¼‰ã§ç‰¹åˆ¥ãªæ„å‘³ã‚’æŒã¤èªã¯ï¼Ÿ","æ–‡è„ˆã‹ã‚‰ã€Œæ¯ã€ã‚’ã©ã†ä¿®é£¾ã—ã¦ã„ã‚‹ã‹è€ƒãˆã‚ˆã†"]},
        {
          num: "(3)", type: "choice", correctAnswer: "d",
          text: "He is very famous in Europe, but his name is (   ) known in Japan.",
          choices: "a. hardã€€b. nearlyã€€c. nearã€€d. hardly",
          vocab: [["famous", "æœ‰åãª"],["Europe", "ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘"]],
          hint: ["ã€Œã»ã¨ã‚“ã©ã€œãªã„ã€ã‚’è¡¨ã™å‰¯è©ã¯ã©ã‚Œï¼Ÿ","hard ã®å‰¯è©å½¢ã«ã¯2ã¤ã®å½¢ãŒã‚ã‚‹","-ly ãŒã¤ãã¨æ„å‘³ãŒå¤‰ã‚ã‚‹å‰¯è©ã«æ³¨æ„"]},
        {
          num: "(4)", type: "choice", correctAnswer: "a",
          text: "On some days there were as (   ) as three or four students in his lectures.",
          choices: "a. fewã€€b. littleã€€c. moreã€€d. much",
          vocab: [["lecture", "è¬›ç¾©"],["as ... as", "ã€œã¨åŒã˜ãã‚‰ã„"]],
          hint: ["as ___ as + æ•° ã§ã€Œã‚ãšã‹ã€œã—ã‹ã€ã‚’è¡¨ã™","students ã¯å¯ç®—åè©ã‹ä¸å¯ç®—åè©ã‹ï¼Ÿ","åŸç´šã®æ§‹æ–‡ã§æ•°ã‚’è¡¨ã™èªã‚’é¸ã¼ã†"]},
        {
          num: "(5)", type: "choice", correctAnswer: "c",
          text: "(   ) everybody in my class attended the ceremony.",
          choices: "a. Allã€€b. Anyã€€c. Almostã€€d. Each",
          vocab: [["attend", "å‡ºå¸­ã™ã‚‹"],["ceremony", "å¼å…¸"],["everybody", "ã¿ã‚“ãª"]],
          hint: ["ä»£åè© everybody ã‚’ä¿®é£¾ã§ãã‚‹ã®ã¯å‰¯è©","ã€Œã»ã¼å…¨å“¡ã€ã‚’è¡¨ã™èªã¯ã©ã‚Œï¼Ÿ","å½¢å®¹è©ã¯ä»£åè©ã‚’ç›´æ¥ä¿®é£¾ã§ããªã„"]},
        {
          num: "(6)", type: "choice", correctAnswer: "d",
          text: "It is not fair to take (   ) of others' weaknesses.",
          choices: "a. accountã€€b. careã€€c. adviceã€€d. advantage",
          vocab: [["fair", "å…¬æ­£ãª"],["weakness", "å¼±ã¿"],["others'", "ä»–äººã®"]],
          hint: ["take ___ of ã§ç†Ÿèªã‚’ä½œã‚‹","ã€Œä»–äººã®å¼±ã¿ã‚’åˆ©ç”¨ã™ã‚‹ã€ã¨ã„ã†æ„å‘³ã«åˆã†èªã¯ï¼Ÿ","å„é¸æŠè‚¢ã¨ take/of ã®çµ„ã¿åˆã‚ã›ã§æ„å‘³ã‚’è€ƒãˆã‚ˆã†"]},
        {
          num: "(7)", type: "choice", correctAnswer: "c",
          text: "It will be (   ) easier to move a heavy load if you use a lever.",
          choices: "a. veryã€€b. tooã€€c. muchã€€d. so",
          vocab: [["lever", "ã¦ã“"],["heavy load", "é‡ã„è·ç‰©"]],
          hint: ["æ¯”è¼ƒç´š easier ã‚’å¼·èª¿ã™ã‚‹å‰¯è©ã¯ï¼Ÿ","very ã¯åŸç´šã‚’ä¿®é£¾ã—ã€æ¯”è¼ƒç´šã«ã¯ä½¿ã‚ãªã„","æ¯”è¼ƒç´šã‚’å¼·èª¿ã§ãã‚‹å‰¯è©ã‚’è€ƒãˆã‚ˆã†"]},
        {
          num: "(8)", type: "choice", correctAnswer: "c",
          text: "We have just been to the airport to (   ) my daughter off to Chicago.",
          choices: "a. driveã€€b. escortã€€c. seeã€€d. take",
          vocab: [["airport", "ç©ºæ¸¯"]],
          hint: ["ç©ºæ¸¯ã«è¡Œã£ãŸç›®çš„ã‚’è€ƒãˆã‚ˆã†","___ ã€œ off ã®å½¢ã«ãªã‚‹ç¾¤å‹•è©","ã€Œè¦‹é€ã‚‹ã€ã‚’æ„å‘³ã™ã‚‹å‹•è©ã¯ã©ã‚Œï¼Ÿ"]}
      ]
    },
    {
      title: "[ç™ºå±•2] èª¤ã‚Šè¨‚æ­£ (1)ï½(3)",
      open: false,
      questions: [
        {
          num: "(1)", type: "error", correctAnswer: "b", correctText: "two-thirds",
          text: "The country I <u>a. visited</u> last year is <u>b. two-third</u> <u>c. as</u> <u>d. large</u> as Japan.",
          vocab: [["as ... as", "ã€œã¨åŒã˜ãã‚‰ã„"],["last year", "æ˜¨å¹´"]],
          hint: ["åˆ†æ•°ã®è¡¨ã—æ–¹ã«æ³¨ç›®","åˆ†å­ãŒ2ä»¥ä¸Šã®ã¨ãã€åˆ†æ¯ã¯ã©ã†ãªã‚‹ï¼Ÿ","ä¸‹ç·šéƒ¨ã®å„èªã®å½¢ã‚’ç¢ºèªã—ã‚ˆã†"]},
        {
          num: "(2)", type: "error", correctAnswer: "c", correctText: "strictly",
          text: "<u>a. Taking photographs</u> inside the art museum <u>b. is</u> <u>c. strict</u> <u>d. forbidden</u>.",
          vocab: [["taking photographs", "å†™çœŸæ’®å½±"],["art museum", "ç¾è¡“é¤¨"],["forbidden", "ç¦æ­¢ã•ã‚Œã¦ã„ã‚‹"]],
          hint: ["is forbidden ã‚’ä¿®é£¾ã—ã¦ã„ã‚‹ã®ã¯ã©ã®èªï¼Ÿ","å‹•è©ï¼ˆå¥ï¼‰ã‚’ä¿®é£¾ã™ã‚‹ã®ã¯å½¢å®¹è©ï¼Ÿå‰¯è©ï¼Ÿ","å“è©ã®å½¢ã‚’æ­£ã—ãã—ã‚ˆã†"]},
        {
          num: "(3)", type: "error", correctAnswer: "b", correctText: "turn it off",
          text: "<u>a. If you have a cell phone with you</u>, <u>b. turn off it</u> before <u>c. you enter</u> the classroom <u>d. so that you don't</u> disturb your classmates.",
          vocab: [["turn off", "é›»æºã‚’åˆ‡ã‚‹"],["so that", "ã€œã™ã‚‹ã‚ˆã†ã«"],["disturb", "é‚ªé­”ã‚’ã™ã‚‹"]],
          hint: ["å‹•è© + å‰¯è©ã®ç¾¤å‹•è©ã«æ³¨ç›®","ç›®çš„èªãŒä»£åè©ã®ã¨ãã€èªé †ã¯ã©ã†ãªã‚‹ï¼Ÿ","ä»£åè©ã®ä½ç½®ã«æ³¨æ„ã—ã‚ˆã†"]}
      ]
    },
    {
      title: "[ç™ºå±•3] è‹±ä½œæ–‡ (1)ï½(2)",
      open: false,
      questions: [
        {
          num: "(1)", type: "compose", correctAnswer: "It is necessary for you to see a doctor.",
          text: "ã‚ãªãŸã¯åŒ»è€…ã«è¨ºã¦ã‚‚ã‚‰ã†å¿…è¦ãŒã‚ã‚‹ã€‚<br>It is (   ) you (   ) a doctor.",
          vocab: [["necessary", "å¿…è¦ãª"]],
          hint: ["necessary ã¯äººã‚’ä¸»èªã«ã§ããªã„","It is necessary that S (should) V ã®å½¢ã‚’è€ƒãˆã‚ˆã†","ã¾ãŸã¯ It is necessary for A to do ã®å½¢ã‚‚å¯"]},
        {
          num: "(2)", type: "compose", correctAnswer: "This house is large enough for us to live in.",
          text: "ã“ã®å®¶ã¯ç§ãŸã¡ãŒä½ã‚€ã«ã¯ååˆ†å¤§ãã„ã€‚<br>This house is (      ).",
          vocab: [["large enough", "ååˆ†å¤§ãã„"],["enough for A to do", "AãŒã€œã™ã‚‹ã®ã«ååˆ†"]],
          hint: ["enough ã¯å½¢å®¹è©ãƒ»å‰¯è©ã®å¾Œã‚ã«ç½®ã","å½¢å®¹è© + enough + for A to do","live in ã® in ã‚’å¿˜ã‚Œãšã«"]}
      ]
    }
  ]
};

// ===== NAVIGATION STATE =====
const NavState = {
  view: 'home',        // 'home' | 'overview' | 'question'
  category: 'basic',   // 'basic' | 'comm' | 'advanced'
  section: 0,          // 0-9 section index
  categoryMap: {
    basic: [0, 1, 2, 3, 4],    // 5 sections: èªå¥é¸æŠã€ç¾¤å‹•è©ã€èª¤ã‚Šè¨‚æ­£ã€å’Œè¨³ã€ä¸¦ã¹ã‹ãˆ
    comm: [5],                  // 1 section: FOR COMMUNICATION
    advanced: [6, 7, 8]         // 3 sections: èªå¥é¸æŠã€èª¤ã‚Šè¨‚æ­£ã€è‹±ä½œæ–‡
  }
};

// Category display info
const categoryInfo = {
  basic: { name: 'åŸºæœ¬å•é¡Œ', iconText: '\u{1F4DA}', iconLabel: 'Basic problems', class: 'basic' },
  comm: { name: 'For Communication', iconText: '\u{1F4AC}', iconLabel: 'Communication', class: 'comm' },
  advanced: { name: 'ç™ºå±•å•é¡Œ', iconText: '\u{1F680}', iconLabel: 'Advanced problems', class: 'advanced' }
};

// ===== ROUTER =====
const Router = {
  navigate(view, category = null, section = null) {
    NavState.view = view;

    if (view === 'question') {
      if (category) NavState.category = category;
      if (section !== null) {
        NavState.section = section;
      } else {
        NavState.section = NavState.categoryMap[NavState.category][0];
      }
    }

    this.updateHash();
    this.render();
  },

  setCategory(category) {
    NavState.category = category;
    NavState.section = NavState.categoryMap[category][0];
    this.updateHash();
    this.render();
  },

  setSection(section) {
    NavState.section = section;
    this.updateHash();
    this.render();
  },

  updateHash() {
    let hash = '#' + NavState.view;
    if (NavState.view === 'question') {
      const localIndex = NavState.categoryMap[NavState.category].indexOf(NavState.section);
      hash += '/' + NavState.category + '/' + (localIndex + 1);
    }
    history.pushState(null, '', hash);
  },

  parseHash() {
    const hash = window.location.hash.slice(1) || 'home';
    const parts = hash.split('/');

    NavState.view = parts[0] || 'home';
    if (!['home', 'overview', 'question'].includes(NavState.view)) NavState.view = 'home';

    if (NavState.view === 'question' && parts.length >= 3) {
      NavState.category = parts[1] || 'basic';
      if (!NavState.categoryMap[NavState.category]) NavState.category = 'basic';
      const localIndex = parseInt(parts[2], 10) - 1 || 0;
      const sections = NavState.categoryMap[NavState.category] || [0];
      NavState.section = sections[Math.min(localIndex, sections.length - 1)] || 0;
    }
  },

  render() {
    const prevView = this._currentView || null;
    this._currentView = NavState.view;
    if (prevView === 'home' && NavState.view !== 'home') {
      document._homeEntrancePlayed = false;
    }

    // -- Animation: Update nav active states --
    document.querySelectorAll('.top-nav-link').forEach(link => {
      const isActive = link.dataset.nav === NavState.view;
      link.classList.toggle('active', isActive);
      link.setAttribute('aria-selected', isActive ? 'true' : 'false');
    });
    document.querySelectorAll('.mobile-nav-btn').forEach(btn => {
      const isActive = btn.dataset.nav === NavState.view;
      btn.classList.toggle('active', isActive);
      // -- Animation: C11 Mobile nav bounce --
      if (isActive && prevView && prevView !== NavState.view && typeof gsap !== 'undefined' && !UV_REDUCED) {
        gsap.fromTo(btn, { scale: 0.9 }, { scale: 1, duration: 0.3, ease: GSAP_CONFIG.ease.elastic });
      }
    });

    const viewMap = { home: 'viewHome', overview: 'viewOverview', question: 'viewQuestion' };
    const mainContent = document.getElementById('mainContent');
    const subNav = document.getElementById('subNav');

    // -- Animation: C1 View transition --
    const oldViewEl = prevView ? document.getElementById(viewMap[prevView]) : null;
    const newViewEl = document.getElementById(viewMap[NavState.view]);

    if (typeof gsap !== 'undefined' && prevView && prevView !== NavState.view && !UV_REDUCED) {
      // Animate old view out
      if (oldViewEl) {
        gsap.to(oldViewEl, {
          opacity: 0, y: -20,
          duration: GSAP_CONFIG.duration.fast,
          ease: GSAP_CONFIG.ease.default,
          onComplete: () => { oldViewEl.classList.remove('active'); gsap.set(oldViewEl, { clearProps: 'all' }); }
        });
      }
      // Show new view with entrance
      setTimeout(() => {
        document.querySelectorAll('.view-home, .view-overview, .view-question').forEach(v => {
          if (v !== oldViewEl) v.classList.remove('active');
        });
        // Pre-hide entrance elements to prevent flash
        if (NavState.view === 'home') {
          gsap.set('.home-label, .home-title, .home-subtitle, .home-cta', { opacity: 0, y: 24 });
        } else if (NavState.view === 'overview') {
          gsap.set('.conj-section-header, .conj-card', { opacity: 0 });
        }
        newViewEl.classList.add('active');
        gsap.fromTo(newViewEl, { opacity: 0, y: 20 }, {
          opacity: 1, y: 0,
          duration: GSAP_CONFIG.duration.view,
          ease: GSAP_CONFIG.ease.default,
          onComplete: () => this._postRender(NavState.view, mainContent, subNav)
        });
      }, UV_REDUCED ? 0 : 200);
    } else {
      // First render or reduced motion: instant
      document.querySelectorAll('.view-home, .view-overview, .view-question').forEach(v => v.classList.remove('active'));
      newViewEl.classList.add('active');
      this._postRender(NavState.view, mainContent, subNav);
    }

    invalidateCaches();
  },

  _postRender(view, mainContent, subNav) {
    window.scrollTo(0, 0);
    if (view === 'home') {
      mainContent.classList.remove('has-subnav');
      initHomeEntrance();
    } else if (view === 'overview') {
      mainContent.classList.remove('has-subnav');
      setTimeout(() => { initTypeCardTilt(); initOverviewScrollReveals(); }, 50);
    } else if (view === 'question') {
      if (navVisible) {
        gsap.to('#subNav', { y: 0, opacity: 1, pointerEvents: 'auto', visibility: 'visible', duration: GSAP_CONFIG.duration.nav, ease: GSAP_CONFIG.ease.nav });
      }
      mainContent.classList.add('has-subnav');
      this.renderQuestionView();
    }
    // Re-init hover after view change
    setTimeout(initHoverAnimations, 100);
  },

  renderQuestionView() {
    // Update sub-nav categories
    document.querySelectorAll('.sub-nav-cat').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.cat === NavState.category);
    });

    // Render section toggles
    const sections = NavState.categoryMap[NavState.category];
    const togglesContainer = document.getElementById('sectionToggles');
    togglesContainer.textContent = '';
    sections.forEach((sectionIndex, i) => {
      const isActive = NavState.section === sectionIndex;
      const btn = document.createElement('button');
      btn.className = 'sub-nav-section' + (isActive ? ' active' : '');
      btn.onclick = () => Router.setSection(sectionIndex);
      btn.textContent = i + 1;
      togglesContainer.appendChild(btn);
    });

    // -- Animation: C10 Section number stagger --
    if (typeof gsap !== 'undefined' && !UV_REDUCED) {
      gsap.from('.sub-nav-section', { scale: 0, opacity: 0, stagger: 0.04, duration: 0.3, ease: GSAP_CONFIG.ease.spring });
    }

    // Update header
    const info = categoryInfo[NavState.category];
    const badge = document.getElementById('categoryBadge');
    badge.className = 'question-category-badge ' + info.class;
    const iconEl = document.getElementById('categoryIcon');
    iconEl.textContent = info.iconText || '';
    iconEl.setAttribute('aria-label', info.iconLabel || '');
    document.getElementById('categoryName').textContent = info.name;

    const sectionData = grammarData.sections[NavState.section];
    document.getElementById('sectionTitle').textContent = sectionData.title;
    document.getElementById('sectionSubtitle').textContent =
      sectionData.questions.length + ' questions';

    // -- Animation: C9 Badge entrance --
    if (typeof gsap !== 'undefined' && !UV_REDUCED) {
      gsap.from('#categoryBadge', { scale: 0.8, opacity: 0, duration: 0.4, ease: GSAP_CONFIG.ease.spring });
      gsap.from('#sectionTitle', { opacity: 0, y: 10, duration: 0.4, delay: 0.1, ease: GSAP_CONFIG.ease.default });
    }

    // Render questions
    renderQuestions(NavState.section);
    if (window.prefetchAnswers) window.prefetchAnswers(NavState.section);

    // Initialize card reveal
    initCardReveal();

    // Notify interactive-quiz.js that new section DOM is ready (focus mode cross-section nav)
    document.dispatchEvent(new Event('iq:section-rendered'));

    // Reset search
    const searchInput = document.getElementById('searchInput');
    if (searchInput) searchInput.value = '';

    // Update progress
    updateProgress();
  }
};

// Expose for interactive-quiz.js cross-section navigation
window.NavState = NavState;
window.Router = Router;

// ===== B6: COLLAPSIBLE TOGGLE (GSAP) + C4: CHILD STAGGER + C5: ANSWER CELEBRATION =====
function printLesson() {
  var withAnswers = confirm('Include answers? (OK = yes, Cancel = questions only)');
  if (withAnswers) document.body.classList.add('print-answers');

  // Render ALL sections (trusted grammarData only â€” no user input in innerHTML)
  var container = document.getElementById('questionsList');
  var allHtml = '';
  grammarData.sections.forEach(function(section, si) {
    allHtml += '<div class="print-section-title">' + section.title + '</div>';
    allHtml += section.questions.map(function(q, qi) { return renderQuestion(q, si, qi); }).join('');
  });
  container.innerHTML = allHtml;

  // Force question view visible and override GSAP inline styles
  var questionView = document.querySelector('.view-question');
  var prevDisplay = questionView ? questionView.style.display : '';
  if (questionView) questionView.style.display = 'block';

  var header = document.querySelector('.question-header');
  var prevHeaderDisplay = header ? header.style.display : '';
  if (header) header.style.display = 'none';

  var cards = document.querySelectorAll('.qcard');
  cards.forEach(function(card) {
    card.style.opacity = '1';
    card.style.transform = 'none';
  });

  setTimeout(function() {
    window.print();
    document.body.classList.remove('print-answers');
    // Restore: re-render current section
    if (questionView) questionView.style.display = prevDisplay;
    if (header) header.style.display = prevHeaderDisplay;
    renderQuestions(NavState.section);
    initCardReveal();
  }, 100);
}

function toggle(btn, type) {
  const card = btn.closest('.qcard');
  if (!card) return;
  const block = card.querySelector(`.collapsible[data-type="${type}"]`);
  if (!block) return;
  if (typeof gsap !== 'undefined') gsap.killTweensOf(block);
  btn.setAttribute('aria-expanded', block.classList.contains('open') ? 'false' : 'true');

  const isOpen = block.classList.contains('open');

  if (typeof gsap !== 'undefined' && !UV_REDUCED) {
    if (isOpen) {
      gsap.to(block, {
        opacity: 0, y: -10,
        duration: GSAP_CONFIG.duration.fast,
        ease: GSAP_CONFIG.ease.default,
        onComplete: () => { block.classList.remove('open'); gsap.set(block, { clearProps: 'all' }); }
      });
    } else {
      block.classList.add('open');
      gsap.fromTo(block, { opacity: 0, y: -10 }, {
        opacity: 1, y: 0,
        duration: 0.35,
        ease: 'power2.out'
      });

      // -- C4: Stagger child elements --
      const items = block.querySelectorAll('.vocab-item, .hint-item, .ans-box > *');
      if (items.length > 1) {
        gsap.from(items, { opacity: 0, x: -10, stagger: 0.05, duration: 0.3, ease: 'power2.out', delay: 0.1 });
      }

      // -- C5: Answer celebration --
      if (type === 'answer') {
        const ansBox = block.querySelector('.ans-box');
        if (ansBox) {
          gsap.fromTo(ansBox, { scale: 0.97 }, { scale: 1, duration: 0.4, ease: 'elastic.out(1, 0.5)' });
        }
      }
    }
  } else {
    block.classList.toggle('open');
  }

  updateProgress();
}

// ===== RENDER FUNCTIONS =====
function renderQuestion(q, si, qi) {
  let questionHtml = `<div class="qcard-question">
    <span class="qnum">${q.num}</span>
    <div class="qtext">${q.text}</div>`;
  if (q.choices) questionHtml += `<div class="choices">${q.choices}</div>`;
  if (q.scramble) questionHtml += `<div class="scramble">${q.scramble}</div>`;
  questionHtml += `</div>`;

  let leftHtml = `<div class="qcard-left">
    <div class="toggle-btn-row">
      <button class="toggle-btn vocab" onclick="toggle(this,'vocab')" aria-expanded="false">Words<span class="iq-kbd-hint">W</span></button>`;
  if (q.hint) leftHtml += `<button class="toggle-btn hint" onclick="toggle(this,'hint')" aria-expanded="false">Hint<span class="iq-kbd-hint">H</span></button>`;
  leftHtml += `</div>`;
  if (q.vocab) {
    leftHtml += `<div class="collapsible" data-type="vocab"><div class="box vocab-box">`;
    q.vocab.forEach(v => leftHtml += `<div class="vocab-item"><span class="vocab-word">${v[0]}</span>${v[1]}</div>`);
    leftHtml += `</div></div>`;
  }
  if (q.hint) {
    leftHtml += `<div class="collapsible" data-type="hint"><div class="box hint-box"><span class="box-label">Solution</span>`;
    q.hint.forEach(h => leftHtml += `<div class="hint-item">&#8594; ${h}</div>`);
    leftHtml += `</div></div>`;
  }
  leftHtml += `</div>`;

  let rightHtml = `<div class="qcard-right">
    <div class="toggle-btn-row">
      <button class="toggle-btn answer" onclick="toggle(this,'answer')" aria-expanded="false">Answer<span class="iq-kbd-hint">A</span></button>
    </div>
    <div class="collapsible" data-type="answer"><div class="box ans-box">
    </div></div></div>`;

  return `<div class="qcard" data-si="${si}" data-qi="${qi}">${questionHtml}${leftHtml}${rightHtml}</div>`;
}

function renderQuestions(sectionIndex) {
  const section = grammarData.sections[sectionIndex];
  const container = document.getElementById('questionsList');
  container.innerHTML = section.questions.map((q, qi) => renderQuestion(q, sectionIndex, qi)).join('');
}

// ===== B4: CARD REVEAL (GSAP + IntersectionObserver) =====
let revealObserver = null;

function initCardReveal() {
  if (revealObserver) revealObserver.disconnect();
  if (typeof gsap === 'undefined') return;

  const cards = document.querySelectorAll('.qcard');
  if (!cards.length) return;

  if (UV_REDUCED) {
    gsap.set(cards, { opacity: 1, y: 0 });
    return;
  }

  gsap.set(cards, { opacity: 0, y: 20 });

  revealObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        gsap.to(entry.target, {
          opacity: 1, y: 0,
          duration: GSAP_CONFIG.duration.normal,
          ease: GSAP_CONFIG.ease.default
        });
        revealObserver.unobserve(entry.target);
      }
    });
  }, { root: null, rootMargin: '50px', threshold: 0.1 });

  cards.forEach(card => revealObserver.observe(card));
}

// ===== B7: PROGRESS BAR (GSAP) + C6: GLOW ON 100% =====
let progressBarEl = null;
let progressTextEl = null;

function updateProgress() {
  if (!progressBarEl) progressBarEl = document.getElementById('progressBar');
  if (!progressTextEl) progressTextEl = document.getElementById('progressText');

  const total = document.querySelectorAll('.collapsible[data-type="answer"]').length;
  const revealed = document.querySelectorAll('.collapsible[data-type="answer"].open').length;
  const pct = total > 0 ? Math.round((revealed / total) * 100) : 0;

  if (progressBarEl) {
    if (typeof gsap !== 'undefined') {
      gsap.to(progressBarEl, { width: pct + '%', duration: GSAP_CONFIG.duration.nav, ease: GSAP_CONFIG.ease.default });
      // -- C6: Glow on 100% --
      if (pct === 100 && !UV_REDUCED) {
        gsap.fromTo(progressBarEl,
          { boxShadow: '0 0 0px var(--accent)' },
          { boxShadow: '0 0 20px var(--accent)', duration: 0.6, yoyo: true, repeat: 1, ease: 'power2.inOut' }
        );
      }
    } else {
      progressBarEl.style.width = pct + '%';
    }
  }
  if (progressTextEl) progressTextEl.textContent = `${revealed} / ${total} answers revealed`;
}

// ===== SEARCH =====
let searchTimeout = null;
let searchIndex = null;

function invalidateCaches() {
  searchIndex = null;
  progressBarEl = null;
  progressTextEl = null;
}

function buildSearchIndex() {
  const section = grammarData.sections[NavState.section];
  searchIndex = section.questions.map((q, qi) => ({
    questionIndex: qi,
    searchText: [
      q.text || '',
      q.choices || '',
      q.scramble || '',
      q.answer || '',
      q.translation || '',
      q.grammar || '',
      (q.vocab || []).flat().join(' '),
      (q.hint || []).join(' ')
    ].join(' ').toLowerCase()
  }));
}

function debouncedSearch() {
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(handleSearch, 150);
}

function handleSearch() {
  const searchInput = document.getElementById('searchInput');
  if (!searchIndex) buildSearchIndex();

  const query = searchInput.value.toLowerCase().trim();
  const cards = document.querySelectorAll('.qcard');

  if (!query) {
    cards.forEach(card => card.classList.remove('no-match'));
    return;
  }

  searchIndex.forEach((q, qi) => {
    const card = cards[qi];
    if (!card) return;
    card.classList.toggle('no-match', !q.searchText.includes(query));
  });
}

// ===== C7: THEME TOGGLE WITH ICON SPIN =====
function toggleTheme() {
  const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
  const icon = document.querySelector('.theme-icon');

  document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
  try { localStorage.setItem('theme', isDark ? 'light' : 'dark'); } catch(e) {}

  if (typeof gsap !== 'undefined' && !UV_REDUCED) {
    gsap.to(icon, {
      rotation: 180, scale: 0.5, opacity: 0, duration: 0.2,
      onComplete: () => {
        icon.textContent = isDark ? '\u2600\uFE0F' : '\u{1F319}';
        gsap.fromTo(icon,
          { rotation: -180, scale: 0.5, opacity: 0 },
          { rotation: 0, scale: 1, opacity: 1, duration: 0.3, ease: GSAP_CONFIG.ease.spring }
        );
      }
    });
  } else {
    icon.textContent = isDark ? '\u2600\uFE0F' : '\u{1F319}';
  }
}

// ===== B3: 3D TILT EFFECT (GSAP quickTo) =====
function initTypeCardTilt() {
  if (typeof gsap === 'undefined' || UV_REDUCED) return;
  const cards = document.querySelectorAll('.conj-card');
  if (!cards.length || 'ontouchstart' in window) return;

  cards.forEach(card => {
    if (card._tiltInit) return;
    card._tiltInit = true;

    gsap.set(card, { transformPerspective: 1000 });

    const xTo = gsap.quickTo(card, 'rotationX', { duration: GSAP_CONFIG.duration.fast, ease: GSAP_CONFIG.ease.gentle });
    const yTo = gsap.quickTo(card, 'rotationY', { duration: GSAP_CONFIG.duration.fast, ease: GSAP_CONFIG.ease.gentle });

    let cachedRect = null;
    let tiltRafId = 0;

    card.addEventListener('mouseenter', () => {
      cachedRect = card.getBoundingClientRect();
      gsap.to(card, { y: GSAP_CONFIG.hover.liftLarge, boxShadow: 'var(--shadow-lg)', duration: 0.3 });
    });

    card.addEventListener('mousemove', (e) => {
      if (!cachedRect || tiltRafId) return;
      tiltRafId = requestAnimationFrame(() => {
        tiltRafId = 0;
        xTo((e.clientY - cachedRect.top - cachedRect.height / 2) / 80);
        yTo((cachedRect.width / 2 - (e.clientX - cachedRect.left)) / 80);
      });
    });

    card.addEventListener('mouseleave', () => {
      cachedRect = null;
      if (tiltRafId) { cancelAnimationFrame(tiltRafId); tiltRafId = 0; }
      xTo(0);
      yTo(0);
      gsap.to(card, { y: 0, boxShadow: '', duration: 0.4, ease: GSAP_CONFIG.ease.default });
    });
  });
}

// ===== B1: HOME ENTRANCE (GSAP timeline) =====
function initHomeEntrance() {
  if (typeof gsap === 'undefined') return;
  if (document._homeEntrancePlayed) return;
  document._homeEntrancePlayed = true;
  const els = ['.home-label', '.home-title', '.home-subtitle', '.home-cta'];

  if (UV_REDUCED) {
    gsap.set(els.join(','), { opacity: 1, y: 0 });
    return;
  }

  const tl = gsap.timeline({ defaults: { ease: GSAP_CONFIG.ease.default, duration: GSAP_CONFIG.duration.slow } });
  tl.fromTo('.home-label', { opacity: 0, y: 24 }, { opacity: 1, y: 0 })
    .fromTo('.home-title', { opacity: 0, y: 24 }, { opacity: 1, y: 0 }, '-=0.4')
    .fromTo('.home-subtitle', { opacity: 0, y: 24 }, { opacity: 1, y: 0 }, '-=0.3')
    .fromTo('.home-cta', { opacity: 0, y: 24 }, { opacity: 1, y: 0 }, '-=0.2');
}

// ===== C2: OVERVIEW SECTION SCROLL REVEALS + C3: CARD CONTENT STAGGER =====
function initOverviewScrollReveals() {
  if (typeof gsap === 'undefined' || UV_REDUCED) return;

  // Kill previous overview ScrollTriggers to prevent accumulation
  ScrollTrigger.getAll().forEach(t => {
    if (t.vars.id && t.vars.id.startsWith('overview-')) t.kill();
  });

  gsap.utils.toArray('.conj-section').forEach((section, si) => {
    const header = section.querySelector('.conj-section-header');
    const cards = section.querySelectorAll('.conj-card');

    if (!header || !cards.length) return;

    const tl = gsap.timeline({
      scrollTrigger: {
        id: `overview-${si}`,
        trigger: section,
        start: GSAP_CONFIG.scroll.start,
        toggleActions: GSAP_CONFIG.scroll.toggleActions
      }
    });

    tl.fromTo(header, { opacity: 0, x: -20 }, { opacity: 1, x: 0, duration: 0.4, ease: GSAP_CONFIG.ease.default });

    cards.forEach((card, i) => {
      tl.fromTo(card, { opacity: 0, y: 10 }, { opacity: 1, y: 0, duration: 0.3, ease: GSAP_CONFIG.ease.default }, i === 0 ? '-=0.2' : '-=0.25');
    });
  });
}

// ===== B8: HOVER ANIMATIONS (GSAP) =====
function initHoverAnimations() {
  if (typeof gsap === 'undefined' || UV_REDUCED || 'ontouchstart' in window) return;
  if (document._hoverDelegateInit) return;
  document._hoverDelegateInit = true;

  const hoverRules = [
    { sel: '.top-nav-link:not(.active)', enter: { y: -1, color: 'var(--text)' }, leave: { y: 0, clearProps: 'color' } },
    { sel: '.top-nav-theme', enter: { scale: GSAP_CONFIG.hover.scaleSmall, boxShadow: 'var(--shadow-sm)' }, leave: { scale: 1, boxShadow: '' } },
    { sel: '.sub-nav-cat', enter: { y: -2, borderColor: 'var(--cat-color)', color: 'var(--cat-color)' }, leave: { y: 0, clearProps: 'borderColor,color' } },
    { sel: '.sub-nav-section:not(.active)', enter: { scale: GSAP_CONFIG.hover.scaleMedium, borderColor: 'var(--text)', color: 'var(--text)' }, leave: { scale: 1, clearProps: 'borderColor,color' } },
    { sel: '.btn-primary', enter: { y: GSAP_CONFIG.hover.lift, boxShadow: 'var(--shadow-lg)' }, leave: { y: 0, boxShadow: '' }, dur: GSAP_CONFIG.duration.fast, ease: GSAP_CONFIG.ease.spring },
    { sel: '.btn-secondary', enter: { borderColor: 'var(--text)', backgroundColor: 'var(--card)', boxShadow: 'var(--shadow)' }, leave: { clearProps: 'borderColor,backgroundColor,boxShadow' } },
    { sel: '.box', enter: { y: -2, boxShadow: 'var(--shadow)', borderColor: 'var(--border-visible)' }, leave: { y: 0, boxShadow: 'var(--shadow-sm)', clearProps: 'borderColor' } },
    { sel: '.toggle-btn', enter: { y: GSAP_CONFIG.hover.lift, boxShadow: '0 6px 20px rgba(0,0,0,0.15)' }, leave: { y: 0, scale: 1, boxShadow: '0 2px 8px rgba(0,0,0,0.12), 0 4px 12px rgba(0,0,0,0.08)' }, ease: GSAP_CONFIG.ease.spring },
    { sel: '.qcard', enter: { y: GSAP_CONFIG.hover.lift, boxShadow: 'var(--shadow-lg)' }, leave: { y: 0, boxShadow: 'var(--shadow)' } },
  ];

  function findRule(el) {
    if (!el.matches) return null;
    for (const r of hoverRules) { if (el.matches(r.sel)) return r; }
    return null;
  }

  document.addEventListener('mouseenter', (e) => {
    const r = findRule(e.target);
    if (!r) return;
    gsap.to(e.target, { ...r.enter, duration: r.dur || GSAP_CONFIG.duration.micro, ease: r.ease, overwrite: true });
  }, true);

  document.addEventListener('mouseleave', (e) => {
    const r = findRule(e.target);
    if (!r) return;
    gsap.to(e.target, { ...r.leave, duration: r.dur || GSAP_CONFIG.duration.micro, overwrite: true });
  }, true);

  document.addEventListener('mousedown', (e) => {
    if (e.target.matches && e.target.matches('.toggle-btn')) gsap.to(e.target, { y: 0, scale: 0.96, duration: 0.1 });
  }, true);
  document.addEventListener('mouseup', (e) => {
    if (e.target.matches && e.target.matches('.toggle-btn')) gsap.to(e.target, { scale: 1, duration: 0.15, ease: GSAP_CONFIG.ease.spring });
  }, true);
}

// ===== C8: SEARCH FOCUS ANIMATION =====
function initSearchFocus() {
  if (typeof gsap === 'undefined' || UV_REDUCED) return;
  const input = document.getElementById('searchInput');
  if (!input || input._focusInit) return;
  input._focusInit = true;

  input.addEventListener('focus', () => {
    gsap.to(input, { scale: 1.02, boxShadow: '0 0 0 4px var(--adj-light)', duration: GSAP_CONFIG.duration.fast });
  });
  input.addEventListener('blur', () => {
    gsap.to(input, { scale: 1, boxShadow: 'none', duration: 0.2 });
  });
}

// ===== B5: AUTO-HIDE NAVIGATION (GSAP) =====
let navVisible = true;
let hideTimeout = null;
let hasScrolled = false;

function showNav() {
  clearTimeout(hideTimeout);
  navVisible = true;
  if (typeof gsap !== 'undefined') {
    gsap.to('.top-nav', { y: 0, visibility: 'visible', duration: GSAP_CONFIG.duration.nav, ease: GSAP_CONFIG.ease.nav });
    gsap.to('.mobile-nav', { y: 0, visibility: 'visible', duration: GSAP_CONFIG.duration.nav, ease: GSAP_CONFIG.ease.nav });
    if (NavState.view === 'question') {
      gsap.to('#subNav', { y: 0, opacity: 1, pointerEvents: 'auto', visibility: 'visible', duration: GSAP_CONFIG.duration.nav, ease: GSAP_CONFIG.ease.nav });
    }
  }
}

function hideNav() {
  hideTimeout = setTimeout(() => {
    navVisible = false;
    if (typeof gsap !== 'undefined') {
      gsap.to('.top-nav', { y: '-100%', visibility: 'hidden', duration: GSAP_CONFIG.duration.nav, ease: GSAP_CONFIG.ease.nav });
      gsap.to('#subNav', { y: '-100%', opacity: 0, pointerEvents: 'none', visibility: 'hidden', duration: GSAP_CONFIG.duration.nav, ease: GSAP_CONFIG.ease.nav });
      gsap.to('.mobile-nav', { y: '100%', visibility: 'hidden', duration: GSAP_CONFIG.duration.nav, ease: GSAP_CONFIG.ease.nav });
    }
  }, 300);
}

function initAutoHideNav() {
  const topNav = document.querySelector('.top-nav');
  const subNav = document.getElementById('subNav');

  showNav();

  window.addEventListener('scroll', () => {
    if (!hasScrolled && window.scrollY > 50) {
      hasScrolled = true;
      hideNav();
    }
  }, { passive: true });

  let navRafId = 0;
  document.addEventListener('mousemove', (e) => {
    if (!hasScrolled) return;
    if (e.target.closest && e.target.closest('.iq-progress-panel, .iq-progress-backdrop')) return;
    if (navRafId) return;
    const clientY = e.clientY;
    const clientX = e.clientX;
    navRafId = requestAnimationFrame(() => {
      navRafId = 0;
      var vw = window.innerWidth;
      var inCenter = clientX > vw * 0.35 && clientX < vw * 0.65;
      if (clientY < 80 && inCenter) {
        if (!navVisible) showNav();
      } else if (clientY > 200 && navVisible) {
        hideNav();
      }
    });
  }, { passive: true });

  topNav.addEventListener('mouseenter', () => clearTimeout(hideTimeout));
  subNav.addEventListener('mouseenter', () => clearTimeout(hideTimeout));
  topNav.addEventListener('mouseleave', () => { if (hasScrolled) hideNav(); });
  subNav.addEventListener('mouseleave', () => { if (hasScrolled) hideNav(); });

  document.addEventListener('touchstart', (e) => {
    const touch = e.touches[0];
    if (touch.clientY < 100) {
      if (navVisible && hasScrolled) hideNav();
      else showNav();
    } else if (touch.clientY > 200 && navVisible && hasScrolled) {
      hideNav();
    }
  }, { passive: true });
}

// ===== INIT =====
window.addEventListener('DOMContentLoaded', () => {
  // Load saved preferences
  try {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
      document.documentElement.setAttribute('data-theme', 'dark');
      document.querySelector('.theme-icon').textContent = '\u{1F319}';
    }

  } catch(e) {}

  // Parse initial hash and render
  Router.parseHash();
  Router.render();

  // Initialize GSAP-powered features
  initAutoHideNav();
  initHoverAnimations();
  initSearchFocus();
});

// Handle browser back/forward
window.addEventListener('popstate', () => {
  Router.parseHash();
  Router.render();
});
</script>
<link rel="stylesheet" href="../../../interactive-quiz.css">
<link rel="stylesheet" href="../../../teacher-reveal.css">
<script src="https://cdn.jsdelivr.net/gh/snd-lib/snd-lib@v1.2.4/dist/browser/snd.js" defer></script>
<script src="../../../ui-sounds.js" defer></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js" defer></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth-compat.js" defer></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database-compat.js" defer></script>
<script src="../../../firebase-config.js" defer></script>
<script src="../../../answer-fetch.js" defer></script>
<script src="../../../teacher-reveal.js" defer></script>
<script src="../../../interactive-quiz.js" defer></script>
<script src="../../../student-responses.js" defer></script>
<script src="../../../leaderboard.js" defer></script>
<script src="../../../spaced-review.js" defer></script>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('../../../sw.js', { scope: '/English-Resources/' })
    .catch(function() {});
}
</script>
</body>
</html>
